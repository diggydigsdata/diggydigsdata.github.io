<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.28">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-12-21">
<meta name="description" content="A penalty-won-adjusted goals metric, a demo Power BI dashboard, and a roadmap toward a refreshable data pipeline.">

<title>The Winner Takes It All (Project Map with Power BI Dashboard) ‚Äì Diggy Digs Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/img/favicons/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-013882879a21c3ca3416aac467d3c23f.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-013882879a21c3ca3416aac467d3c23f.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-013882879a21c3ca3416aac467d3c23f.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6f54ce9af9dcb4054d4614137579ee5d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-b7dfd321930551f38f4d773270eb8bab.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-6f54ce9af9dcb4054d4614137579ee5d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-HNQKPVKC29"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-HNQKPVKC29', { 'anonymize_ip': true});
</script>
<meta name="quarto:status" content="draft">


<meta property="og:title" content="The Winner Takes It All (Project Map with Power BI Dashboard) ‚Äì Diggy Digs Data">
<meta property="og:description" content="A penalty-won-adjusted goals metric, a demo Power BI dashboard, and a roadmap toward a refreshable data pipeline.">
<meta property="og:image" content="https://diggydigsdata.github.io/posts/vignettes/winner-takes-it-all.png">
<meta property="og:site_name" content="Diggy Digs Data">
<meta property="og:image:alt" content="Screenshot of Power BI dashboard showing player rankings based on adjusted goalscoring metrics">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    window.setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      window.setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    window.hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(darkModeDefault) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const darkModeDefault = false;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !window.hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
    };
    // Switch to dark mode if need be
    if (window.hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../assets\img\brand.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Diggy Digs Data</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/diggydigsdata"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:diggydigsdata@gmail.com"> <i class="bi bi-envelope" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/eoindignan1989/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The Winner Takes It All (Project Map with Power BI Dashboard)</h1>
                  <div>
        <div class="description">
          A penalty-won-adjusted goals metric, a demo Power BI dashboard, and a roadmap toward a refreshable data pipeline.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Football</div>
                <div class="quarto-category">Analytics</div>
                <div class="quarto-category">Python</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">Penalties</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 21, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-question" id="toc-the-question" class="nav-link active" data-scroll-target="#the-question">The question</a></li>
  <li><a href="#a-simple-metric-xpwg" id="toc-a-simple-metric-xpwg" class="nav-link" data-scroll-target="#a-simple-metric-xpwg">A simple metric: xPwG</a></li>
  <li><a href="#quick-example-sterling-vs-vardy" id="toc-quick-example-sterling-vs-vardy" class="nav-link" data-scroll-target="#quick-example-sterling-vs-vardy">Quick example: Sterling vs Vardy</a></li>
  <li><a href="#methodology-short-readable" id="toc-methodology-short-readable" class="nav-link" data-scroll-target="#methodology-short-readable">Methodology (short, readable)</a>
  <ul class="collapse">
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#penalty-conversion-assumptions" id="toc-penalty-conversion-assumptions" class="nav-link" data-scroll-target="#penalty-conversion-assumptions">Penalty conversion assumptions</a></li>
  <li><a href="#why-not-just-give-them-the-full-goals" id="toc-why-not-just-give-them-the-full-goals" class="nav-link" data-scroll-target="#why-not-just-give-them-the-full-goals">Why not just give them the full goals?</a></li>
  </ul></li>
  <li><a href="#dashboard-prototype" id="toc-dashboard-prototype" class="nav-link" data-scroll-target="#dashboard-prototype">Dashboard (prototype)</a></li>
  <li><a href="#roadmap-pipeline-reliability" id="toc-roadmap-pipeline-reliability" class="nav-link" data-scroll-target="#roadmap-pipeline-reliability">Roadmap (pipeline + reliability)</a>
  <ul class="collapse">
  <li><a href="#phase-1-extend-coverage-data-completeness" id="toc-phase-1-extend-coverage-data-completeness" class="nav-link" data-scroll-target="#phase-1-extend-coverage-data-completeness">Phase 1 ‚Äî Extend coverage (data completeness)</a></li>
  <li><a href="#phase-2-validation-repeatability-data-trust" id="toc-phase-2-validation-repeatability-data-trust" class="nav-link" data-scroll-target="#phase-2-validation-repeatability-data-trust">Phase 2 ‚Äî Validation + repeatability (data trust)</a></li>
  <li><a href="#phase-3-refresh-product-layer-usable-outputs" id="toc-phase-3-refresh-product-layer-usable-outputs" class="nav-link" data-scroll-target="#phase-3-refresh-product-layer-usable-outputs">Phase 3 ‚Äî Refresh + product layer (usable outputs)</a></li>
  </ul></li>
  <li><a href="#notes-limitations" id="toc-notes-limitations" class="nav-link" data-scroll-target="#notes-limitations">Notes / limitations</a></li>
  <li><a href="#methodology" id="toc-methodology" class="nav-link" data-scroll-target="#methodology">Methodology</a>
  <ul class="collapse">
  <li><a href="#xpwg" id="toc-xpwg" class="nav-link" data-scroll-target="#xpwg"><strong><code>xPwG</code></strong></a></li>
  <li><a href="#g-pkxpwg" id="toc-g-pkxpwg" class="nav-link" data-scroll-target="#g-pkxpwg"><strong><code>G-PK+xPwg</code></strong></a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/diggydigsdata/blob/main/posts/vignettes/index.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">






<p>Football credits the <em>taker</em> of a penalty, not the player who <em>won</em> it. That‚Äôs why we end up with nicknames like Penaldo. In fact, the BBC even stirred the pot when they captioned him ‚ÄòMisstiano Penaldo‚Äô after he missed a penalty against Slovenia in 2024.</p>
<p>In this post, I look back in time to see: <strong>what would goal totals look like if penalties were ‚Äúallocated‚Äù back to the players who won them?</strong>. And I also plan to build out a pipeline for current season statistics, so every penalty winner gets their fair share of the credit.</p>
<p>What‚Äôs the justification for this? There are a few.</p>
<p>One is that specialist penalty takers don‚Äôt actually have penalty success ratios that are significantly above the average player. [point on roadmap - hypothesis testing this claim] This rebutes the argument that penalty takers deserve their goals because they are exceptional at taking penalties. No, most players are between</p>
<p>Second is that penalties are taking over the game, and it drives me crazy. If we look back through the history backs, we can see how inflated this has made goalscoring stats. For example, the average penalty ratio for the Pichici, Golden Boot and Capocannoniere follows this trendline. The influence of penalties has completely exploded statlines. There are vastly more penalties in the game today. See plot below. And I don‚Äôt see that changing with VAR in the picture and the murkiness of handball rules.</p>
<p>The least we can do is to start giving credit where it‚Äôs due. Timo Wener is a case in point. Much-maligned throughout his Chelsea career, his debut season‚Äôs 2020-21 statline is actually pretty impressive when you peel back the penalties. He won 5 penalties in the Premier League and scored 6 non-penalty goals. He also racked up 8 assists. If he took the penalties he won at a rate of 0.757 success (the historical average), then he‚Äôd have 9.79 goals. Add in his 8 assists (I will discuss expected assists but let‚Äôs park that for now) and he‚Äôs up to 17.79 goal contributions from 2602 minutes, which is a goal contribution every 146.2 minutes. That‚Äôs better than Chelsea‚Äôs talisman and FIFA Team of the Year inclusion Cole Palmer during the 2024/25 season. Palmer notched 11 non-penalty goals and won 1 penalty, so we give him another 0.757. With 8 assists that makes 19.757 goal contributions in 3191 minutes of play, which is 161.5. Of course, these are my metrics. Their ‚Äòreal‚Äô metrics are actually 138.7 for Palmer and 185.9 for Werner.</p>
<p>Third, I would genuinely like to see penalty winners have to take the penalties they won. It‚Äôs complicated in football because you have to assign the winner of the penalty. Though I have proposals for this. Nevertheless, it works in basketball.</p>
<p>Did you know Raheem Sterling and Shaquille O‚ÄôNeal have a lot in common?</p>
<p>Raheem is the PL‚Äôs greatest ever winner of penalties - with 26. Raheem is also one of the PL‚Äôs greatest ever goalscorers; with 123 goals, he ranks 20th all-time. Meanwhile, Shaq is one of basketball‚Äôs greatest ever free throw foul-drawers. He ranks 4th all-time:</p>
<ol type="1">
<li>Karl Malone 13188</li>
<li>Wilt Chamberlain 11862</li>
<li>LeBron James 11735</li>
<li>Shaquille O‚ÄôNeal 11252</li>
</ol>
<p>Source: <a href="https://www.basketball-reference.com/leaders/fta_career.html">https://www.basketball-reference.com/leaders/fta_career.html</a></p>
<p>But Shaq and Raheem are also historically bad at converting the chances their drawn fouls create. O‚ÄôNeal only succeeded with 52% of his attempts. In Premier League play, Sterling has converted 43%. That is abysmal considering the average success rate in the Premier League era is 78.9%.</p>
<p>Despite Shaq‚Äôs poor shooting from the free throw line, those points nevertheless helped him rack up the points. He is the 9th-highest scoring player in NBA history. Where would he rank if Kobe Bryant got to take all of Shaq‚Äôs fouls?</p>
<p>Shaq wouldn‚Äôt fall quite as far as you might think because he was so terrible at converting free throws. Neverthelss, if Kobe took all his fouls, people would foul him less but it would also make NBA scoring contests very dull. The same players would always top the statlines. Just like in football. Harry Kane has been excellent for Bayern Munich. But some of the hyperbole around his goalscoring is overblown. When you have Leroy Sane and Jamal Musiala dribbling at defenders, you will win an extraordinary volume of penalties. And sure enough, Harry ended 2024/25 way out in front of the Bundesliga scoring charts with 26 goals. But he‚Äôs not first if you take away everyone‚Äôs penalties. That would be Patrick Schick (20), then Serhou Guirassy (18), then Harry (17), just ahead of Jonathan Burkardt (16) - who most people outside Germany have never heard of.</p>
<p>Despite Sterling winning lots of penalties, he very rarely gets to take them. He has only taken 7 in the Premier League; typically, the ball was whipped away from him by Steven Gerrard (33 PL penalties converted at a rate of 80.5%), or Sergio Aguero (27 PL penalties scored for 81.82% success). Raheem currently ranks 30 in the all-time PL scoring charts with 123 goals. If he took all those penalties, where would he rank? And why stop there? Unfortunately, I don‚Äôt have PkWon data further back than 2016/17; otherwise, Alan Shearer‚Äôs PL goals record would be under threat from Andy Cole. Only 1 of Cole‚Äôs 187 PL goals came from the spot. Whereas 58 of Shearer‚Äôs 260 came from the spot. That‚Äôs a 15 goal buffer. But Cole won a lot of penalties. Nevertheless, we‚Äôre going to rewrite the record books as much as possible.</p>
<p>If we use Raheem‚Äôs non-penalty goals as a base (120) then add the only penalties he would be entitled to take - 26 - then work out his <code>PwxG</code>, or Penalties won to expected goals, he‚Äôd have scored 26 * 0.43 more goals or 11.18. Now on 131, he‚Äôd jump above Son, Anelka, Robbie Keane and Jimmy Floyd Hasselbaink (all of whom took their fair share of penalties) and he‚Äôd sit in 16th on 134 PL goals, just behind Jamie Vardy. Oh wait, hasn‚Äôt Jamie Vardy scored 27 penalties? But he only won 23 of them. So shouldn‚Äôt his <code>G-PK+xPwg</code> be 27 * 0.82 based on his PL penalty success rate? He‚Äôs only <em>entitled</em> to 22 penalty goals. So he loses 4 and he‚Äôs down to 139 PL goals.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 24%">
<col style="width: 16%">
<col style="width: 8%">
<col style="width: 18%">
<col style="width: 7%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th>Player</th>
<th>PL goals incl.&nbsp;pens</th>
<th>Non-pen goals</th>
<th><code>PkWon</code></th>
<th>PK Conversion %</th>
<th><code>xPwG</code></th>
<th><code>G-PK+xPwG</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Vardy</td>
<td>143</td>
<td>116</td>
<td>23</td>
<td>82</td>
<td>18.81</td>
<td>134.81</td>
</tr>
<tr class="even">
<td>Sterling</td>
<td>123</td>
<td>120</td>
<td>26</td>
<td>43</td>
<td>11.18</td>
<td>131.18</td>
</tr>
</tbody>
</table>
<blockquote class="blockquote">
<p><strong>Key:</strong> - <code>PkWon</code> = penalty kicks won<br>
- <code>xPwG</code> = expected penalties won goals, which is simply conversion % * <code>PkWon</code><br>
- <code>G-PK+xPwG</code> = non-penalty goals + <code>xPwG</code></p>
</blockquote>
<p>It‚Äôs enough for Vardy to hang onto 15th place, but you can see where this is going.</p>
<p>Unfortunately, I don‚Äôt have <code>PkWon</code> data further than 2016/17; otherwise, Alan Shearer‚Äôs PL goals record would be under serious threat from Andy Cole. Only 1 of Cole‚Äôs 187 PL goals came from the spot. Whereas 58 of Shearer‚Äôs 260 came from the spot. And Cole won a lot of penalties. Nevertheless, we‚Äôre going to rewrite the record books as much as possible.</p>
<p>So what is this? - For now it‚Äôs a Power BI demo dashboard that uses scraped data (see my guide to the ScraperFC pacakage) to let you explore the effects of PKWon at a single-season, single-comp level. But there‚Äôs a lot more to come.</p>
<p>Roadmap: - Add an API source for missing competitions (e.g., Champions League) and use cross-source checks. This is also necessary because FBref data is not designed for public projects. - Make the pipeline refreshable (weekly cadence) with validation + documentation - Rebuild the dashboard layer (likely Tableau later via MSc module or Streamlit or Shiny for Python)</p>
<p>This is both:</p>
<hr>
<hr>
<section id="the-question" class="level2">
<h2 class="anchored" data-anchor-id="the-question">The question</h2>
<p>If penalties were <em>allocated</em> to the player who won them, how much would goal totals and rankings change?</p>
<p>I focus on Premier League-era data where <code>PkWon</code> is tracked: - <strong>Penalty kicks won (<code>PkWon</code>)</strong> comes from FBref. - For this first version, the goal is not ‚Äúperfect truth‚Äù‚Äîit‚Äôs a <strong>transparent, testable metric</strong> you can disagree with.</p>
<hr>
</section>
<section id="a-simple-metric-xpwg" class="level2">
<h2 class="anchored" data-anchor-id="a-simple-metric-xpwg">A simple metric: xPwG</h2>
<p>I use two quantities:</p>
<ul>
<li><code>PkWon</code> = penalties won</li>
<li><code>xPwG</code> = expected goals from penalties a player won (allocated back to them)</li>
</ul>
<p>Then: - <code>G - PK + xPwG</code> = non-penalty goals + expected goals from penalties won</p>
<p>In the simplest version, <code>xPwG = PkWon √ó conversion_rate</code>.</p>
<p>I also use a slightly more nuanced approach later (positional assumptions / bootstrapped league averages), but the key idea stays the same:<br>
<strong>reward the player who generated the penalty with an expected-goals value rather than giving them the full ‚Äúgoal‚Äù automatically.</strong></p>
<hr>
</section>
<section id="quick-example-sterling-vs-vardy" class="level2">
<h2 class="anchored" data-anchor-id="quick-example-sterling-vs-vardy">Quick example: Sterling vs Vardy</h2>
<p>(Keep your table here.)</p>
<blockquote class="blockquote">
<p><strong>Key</strong> - <code>PkWon</code> = penalty kicks won<br>
- <code>xPwG</code> = expected goals from those penalties<br>
- <code>G - PK + xPwG</code> = non-penalty goals + <code>xPwG</code></p>
</blockquote>
<p>This already hints at the broader point: some players ‚Äúfeast‚Äù on penalties others created, while some creators don‚Äôt get the credit.</p>
<hr>
</section>
<section id="methodology-short-readable" class="level2">
<h2 class="anchored" data-anchor-id="methodology-short-readable">Methodology (short, readable)</h2>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">Data</h3>
<ul>
<li>Source: FBref</li>
<li>Scope: PL seasons where <code>PkWon</code> exists (FBref only goes back to 2016/17 for PL <code>PkWon</code>)</li>
</ul>
</section>
<section id="penalty-conversion-assumptions" class="level3">
<h3 class="anchored" data-anchor-id="penalty-conversion-assumptions">Penalty conversion assumptions</h3>
<p>To estimate <code>xPwG</code>, I use competition-level conversion rates from my penalty dataset (PL, La Liga, UCL, international shootouts).<br>
(Keep your conversion-rate tables here.)</p>
</section>
<section id="why-not-just-give-them-the-full-goals" class="level3">
<h3 class="anchored" data-anchor-id="why-not-just-give-them-the-full-goals">Why not just give them the full goals?</h3>
<p>Because this is a counterfactual allocation problem: - we don‚Äôt know who would take penalties under a different rule - so <code>xPwG</code> is a conservative way to allocate credit while acknowledging uncertainty</p>
<hr>
</section>
</section>
<section id="dashboard-prototype" class="level2">
<h2 class="anchored" data-anchor-id="dashboard-prototype">Dashboard (prototype)</h2>
<p>This dashboard is a <strong>demo layer</strong> over the current dataset and metric definitions.<br>
Known limitations today: - currently scoped to a single season/competition in places - some interactions are still being tuned (cross-filter behaviour)</p>
<p class="pbi-wrap">
<iframe title="fbref" src="https://app.powerbi.com/view?r=eyJrIjoiNzY3ZGJmOWYtN2ZkYS00NzkxLWE4YzctN2U3ZmUyZTNhMjlkIiwidCI6ImE1MmIxMmI5LTdkYzktNGE3MS05YzQ5LTliZTkyOTIwNzAyZiJ9&amp;pageName=7ac0fd6edc0a07143511" frameborder="0" allowfullscreen="true">
</iframe>
</p>
<style>
.pbi-wrap { position: relative; padding-top: 56.25%; }
.pbi-wrap iframe { position: absolute; inset: 0; width: 100%; height: 100%; border: 0; }
</style>
<hr>
</section>
<section id="roadmap-pipeline-reliability" class="level2">
<h2 class="anchored" data-anchor-id="roadmap-pipeline-reliability">Roadmap (pipeline + reliability)</h2>
<p>I‚Äôm treating this as a pipeline project, not just a one-off analysis. Here‚Äôs the plan:</p>
<section id="phase-1-extend-coverage-data-completeness" class="level3">
<h3 class="anchored" data-anchor-id="phase-1-extend-coverage-data-completeness">Phase 1 ‚Äî Extend coverage (data completeness)</h3>
<ul>
<li>Add missing competitions (e.g., UCL) via a football API</li>
<li>Standardize competition + season keys</li>
<li>Create consistent ‚Äúfact‚Äù grains (player√óteam√ócomp√óseason)</li>
</ul>
</section>
<section id="phase-2-validation-repeatability-data-trust" class="level3">
<h3 class="anchored" data-anchor-id="phase-2-validation-repeatability-data-trust">Phase 2 ‚Äî Validation + repeatability (data trust)</h3>
<ul>
<li>Cross-source checks (API vs scrape): row counts, key uniqueness, spot checks</li>
<li>Data freshness and completeness checks</li>
<li>Document metric logic + assumptions clearly (so it‚Äôs reviewable)</li>
</ul>
</section>
<section id="phase-3-refresh-product-layer-usable-outputs" class="level3">
<h3 class="anchored" data-anchor-id="phase-3-refresh-product-layer-usable-outputs">Phase 3 ‚Äî Refresh + product layer (usable outputs)</h3>
<ul>
<li>Scheduled refresh (weekly)</li>
<li>Publish outputs through:
<ul>
<li>a dashboard layer (Power BI now; Tableau rebuild planned later), and/or</li>
<li>a lightweight Streamlit explorer for exports</li>
</ul></li>
</ul>
<hr>
</section>
</section>
<section id="notes-limitations" class="level2">
<h2 class="anchored" data-anchor-id="notes-limitations">Notes / limitations</h2>
<ul>
<li><code>PkWon</code> availability limits historical scope.</li>
<li>Metric choices (e.g., conversion rates by position) are assumptions, not facts.</li>
<li>This is meant to be transparent: you can see the logic and disagree with it.</li>
</ul>
</section>
<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology">Methodology</h2>
<p>The methods for calculating conversion rates for each player and allocating an <code>xPwG</code> get a little more exacting for my actual analysis. All of that awaits in the methodology. And then we‚Äôll be ee who the best players really were from a goal contributions perspective seeing who the best goalscorers really are if if we get rid of ball-snatching penalty-takers.</p>
<p>Not much to say on the data. It‚Äôs the 200 highest-scoring players in the Premier League for 2022/23 and a bunch of goalscoring metrics. It all comes from FBref, and this project is possible because they have a PKwon metric - they log who is responsible for winning each penalty. FBref only has this data for the Premier League as far back as the 2016/17 season. My tally from Raheem Sterling includes earlier years - I guess that data exists somewhere because Opta has an article about it. But I don‚Äôt have those numbers. Anyway, for La Liga, FBref have it untl 2015/16.</p>
<p>I‚Äôve created a metric for this. It‚Äôs not catchy, so bear with me.</p>
<section id="xpwg" class="level3">
<h3 class="anchored" data-anchor-id="xpwg"><strong><code>xPwG</code></strong></h3>
<p><code>xPwG</code>, or Expected penalties won leading to goals, needs some unpacking. I have assigned a value of 0.75% to each penalty. Why?</p>
<section id="penalty-conversion-rates" class="level4">
<h4 class="anchored" data-anchor-id="penalty-conversion-rates">Penalty Conversion Rates</h4>
<p>For another project - No Fear At That Age - I compiled penalty data from:</p>
<ul>
<li>Every normal time penalty taken in the Premier League - in other words, since the 1992/1993 season</li>
<li>Every normal time penalty taken in the Champions League since the 1999/2000 season</li>
<li>Every normal time penalty taken in La Liga since the 1999/2000 season</li>
</ul>
<p>For this project, I am adding: - Every penalty taken in the shootout of a major international tournament.</p>
<p>Interesting that I have 7 less years from La Liga than the Premier League, but 64 more penalties.</p>
<ul>
<li>The club data was taken from FBref while the international shootout data comes from <a href="https://www.rsssf.org/miscellaneous/penaltiestour.html">RSSSF</a></li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>League</strong></th>
<th><strong>Total Penalties</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Premier League</td>
<td>2892</td>
</tr>
<tr class="even">
<td>La Liga</td>
<td>2956</td>
</tr>
<tr class="odd">
<td>Champions League</td>
<td>925</td>
</tr>
<tr class="even">
<td>Int. Shootouts</td>
<td>1907</td>
</tr>
<tr class="odd">
<td><strong>Total</strong></td>
<td><strong>6773</strong></td>
</tr>
</tbody>
</table>
<p>And when it comes to conversion rates, all three leagues are roughly equivalent:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Competition</th>
<th>Conversion Rate (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Club Comps</td>
<td>77.99</td>
</tr>
<tr class="even">
<td>Champions League</td>
<td>77.19</td>
</tr>
<tr class="odd">
<td>Premier League</td>
<td>78.84</td>
</tr>
<tr class="even">
<td>La Liga</td>
<td>77.40</td>
</tr>
<tr class="odd">
<td>Int. Shootouts</td>
<td>73.52</td>
</tr>
</tbody>
</table>
<p>Unsurprisingly, the international shootouts have worse conversion. Players are more nervous <em>and</em> many penalty takers are non-specialist; i.e.&nbsp;they don‚Äôt take penalties for their club sides.</p>
<p>Hypothetically, if this new rule really came into place, then the specialist penalty takers would necessarily be the players who are most likely to win penalties - that is, attacking players. The data backs this up.</p>
<p>Those players could assume they will win their fair share, whereas defensive players wouldn‚Äôt. Specialisation would have to fall in line accordingly. Therefore, I will propose assigning a conversion rate based on player positions. <em>To Do: Get this into SQL so I can join datasets for each year and group by position. In addition, I need to group by position for penalty taking success</em>. Note: I will do a mini dashboard piece about success rate by position.</p>
<p>Unfortunately, I haven‚Äôt added positional data for the datasets I downloaded. For wingers and forwards I will assign a value based on the specialists‚Äô average: - 78%. For everyone else the value will be based on a middle ground between specialists in club comps and the pressure cooker penalty shootout success rate - that middle ground is roughly 75.75%.</p>
<p>This means that an attacking midfield or forward player who wins a penalty will be treated a specialist and assigned 0.78 expected goals. Everyone else will get 0.7575 expected goals.</p>
<p>Let‚Äôs take an example. In 2023/24 Anthony Gordon won an extraordinary 6 penalties for Newcastle. As a winger, he gets a 0.78 expected goals value. That means his <code>xPwG</code> is 0.78*6, or 4.68 goals.</p>
<p>On the other hand, Jarrad Branthwaite won 1 penalty for Everton. He is a defender, so he gets 0.7575*1 for an <code>xPwG</code> of 0.7575 goals.</p>
</section>
</section>
<section id="g-pkxpwg" class="level3">
<h3 class="anchored" data-anchor-id="g-pkxpwg"><strong><code>G-PK+xPwg</code></strong></h3>
<p>If we now take Anthony Gordon‚Äôs non-penalty goals - 11 - and add his <code>xPwG</code> we get his <code>G-PK+xPwg</code>: 11+4.68. If Anthony Gordon took the penalties he won in 2023/24 we could expect him to score 15.68 goals.</p>
<p>In my analysis to come, I will also deploy <code>xAG</code> - expected Assists Leading to Goals. This is not a stat of my own invention and it‚Äôs a close cousin of expected assists. I will quote the <a href="https://www.nytimes.com/athletic/6214991/2025/03/20/erling-haaland-assists-premier-league/">NY Times</a> on this: &gt;‚ÄúWhere expected assists (xA) considers all passes and the probability that they may ultimately lead to a scoring chance, xAG solely focuses on the passes that directly contribute to an expected goal.‚Äù</p>
<p>make sidebar: Shaq was so bad at shooting when 15 feet from the basket - a little over two Shaq‚Äôs laid head to toe to head to toe - that a new tactic was invented: ‚ÄòHack-a-Shaq‚Äô. The idea was that if you simply fouled Shaq and put him at the free throw line, he would likely score less points - 1 from his 2 free throw attempts - than if you took the risk of letting the play continue because he‚Äôd probably manage to pivot and dunk for 2 points. So, if teams knew Kobe was stepping up with his 83.7% shooting then Shaq would have been hacked a heck of a lot less.</p>
<p class="pbi-wrap">
<iframe title="fbref" width="600" height="373.5" src="https://app.powerbi.com/view?r=eyJrIjoiNzY3ZGJmOWYtN2ZkYS00NzkxLWE4YzctN2U3ZmUyZTNhMjlkIiwidCI6ImE1MmIxMmI5LTdkYzktNGE3MS05YzQ5LTliZTkyOTIwNzAyZiJ9&amp;pageName=7ac0fd6edc0a07143511" frameborder="0" allowfullscreen="true">
</iframe>
</p>
<style>
.pbi-wrap {
  position: relative;
  padding-top: 56.25%;  /* 16:9 aspect ratio */
}
.pbi-wrap iframe {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  border: 0;
}
</style>
<p>‚öôÔ∏è Upcoming Table Fixes # Feature Description / Action Priority 1 Minutes-weighted fairness rule for unattributed penalties Use player-minutes share to distribute team-level unattributed penalties fairly across players. üî¥ High 2 Revert to assists (no xAG) for 2016/17 Replace xAG values with raw assists in Hall of Fame tables for 2016/17 (xAG not tracked that year). üü† Medium 3 SQL short_name column for teams Add short_name field in dimteam to prevent text wrapping for long team names (e.g., ‚ÄúBorussia M√∂nchengladbach‚Äù). üî¥ High 4 Adaptive PKW weighting by conversion rate Weight PKW by player conversion rate (pens_scored / pens_attempted), default 0.757 if no attempts exist. üü† Medium</p>
<p>üöÄ Upcoming Features # Feature Description / Action Priority 5 Add UEFA Champions League 24/25 scraping feature Extend scraper to include UCL 2024/25 data and integrate into the main pipeline. üî¥ High 6 Tooltip linking unattributed PKWon info Add hover tooltips linking to unattributed PKWon reference table (superseded by standalone visual). üü¢ Low 7 Reset bookmark (unfiltered state) Configure a Reset button to restore default slicers via bookmarks. üî¥ High 8 Fix Hall of Fame visuals‚Äô row-click response Adjust interactions / DAX filters so Hall of Fame cards ignore table-row selections. üü† Medium 9 Conditional formatting for awards Add Ballon d‚ÄôOr üü° and Golden Boy üë¶ flags with icon-based formatting (superseded by dedicated award page). üü¢ Low 10 Create and integrate SQL views for Power BI Create 4 SQL views (v_player_team_comp_season, v_player_team_comp, v_player_comp_season, v_player_overall) and link them into Power BI. üî¥ High 11 Standalone visualisations (outside dashboards) Build exportable visuals (trend lines, scatter plots, radar charts) for blog / static use. üü† Medium 12 Ballon d‚ÄôOr comparison page Add a Power BI page comparing Ballon d‚ÄôOr-winning seasons ‚Äî metrics for winners, runners-up, and non-winners. üî¥ High 13 Scrape current season data for all comps (CL, PL, La Liga, Serie A, Bundesliga, Ligue 1) üü† High 13 Live build for current season (CI/CD) GitHub Actions workflow to run scraper daily, clean / load into DB, and refresh Power BI dataset automatically. üü† Medium 14 Fully automated Plotly Dash + embed Long-term goal: Dash app that fetches live data and regenerates visuals automatically ‚Äî no Power BI refresh needed. üü† Medium 15 Re-scrape FBref for np expected goals data and add ratio of npgoals to npxg as calculated column üü† High</p>
<p>üß≠ Upcoming Documentation # Feature Description / Action Priority 15 Documentation &amp; rationale layer Add detailed project docs (weighting rules, schema design, analytical logic, Power BI implementation, reproducibility). Includes sections A‚ÄìE (Weighting Logic, Data Model, Analytical Design, Power BI Implementation, Reproducibility). üî¥ High 16 Pull Request: scraperfc (CL 24/25) Submit a PR to the scraperfc package adding UCL 24/25 support and update documentation accordingly (public-facing technical note). üü¢ Low</p>
<ol type="1">
<li>v_player_team_comp_season</li>
</ol>
<p>Grain: one row per Player √ó Team √ó Competition √ó Season (atomic fact). Columns (typical):</p>
<p>Keys: player_id, team_id, comp_id, season_id</p>
<p>Additives: minutes, goals, non_penalty_goals, penalties_won, pens_scored, pens_attempted, xAG, assists ‚Ä¶</p>
<p>Optionally: starts, subs_on, cards_y/r</p>
<p>No pre-aggregation other than data cleaning.</p>
<p>Use in Power BI (pages it facilitates):</p>
<p>Player Season Detail (drill-through from any summary): season-by-season line/table for a player within a team+comp.</p>
<p>Ballon d‚ÄôOr Comparison page (winner vs runners-up vs notable seasons ‚Üí needs true per-season rows).</p>
<p>League Defaults Reference (join by comp_id, season_id to show league-season constants).</p>
<p>Any time series visual (season on X-axis).</p>
<p>Typical visuals: season table; season KPI strip; per-season trend lines (NPG, PKWon, xAG). Example measures: per-90 (divide by minutes/90), season ranks within comp.</p>
<ol start="2" type="1">
<li>v_player_team_comp</li>
</ol>
<p>Grain: one row per Player √ó Team √ó Competition (aggregated across all seasons). Columns: same additive metrics summed across seasons: SUM(minutes) AS minutes, SUM(goals) AS goals, SUM(non_penalty_goals) AS npg, SUM(penalties_won) AS pkwon, SUM(pens_scored) AS pens_scored, ‚Ä¶</p>
<p>Use in Power BI (pages it facilitates):</p>
<p>Club Career by Competition (e.g., Aubameyang at Arsenal in EPL vs UCL totals).</p>
<p>Roll of Honour / ‚ÄúBest Stints‚Äù (top multi-season stints by comp).</p>
<p>Table of Player‚ÄìTeam‚ÄìComp combos (clean 1 line per combo; prevents duplicate seasons).</p>
<p>Typical visuals: tables ranked by NPG, PKWon, Goals; bar charts comparing comps for a player‚Äôs stint at a club. Example measures: %GoalsFromPens, NPG + PKWon*rate at stint level.</p>
<ol start="3" type="1">
<li>v_player_comp_season</li>
</ol>
<p>Grain: one row per Player √ó Competition √ó Season (aggregated across teams). Columns: additives summed across teams in that season (handles mid-season transfers): SUM(minutes), SUM(goals), SUM(npg), SUM(pkwon), SUM(pens_scored), ‚Ä¶</p>
<p>Use in Power BI (pages it facilitates):</p>
<p>Season Dossiers by Competition (e.g., ‚ÄúMessi in 2018/19 UCL‚Äù even if multiple teams; common for players changing clubs).</p>
<p>Ballon d‚ÄôOr Comparison (winner + runners-up often compared at competition-season level).</p>
<p>League Tables of a Season (top scorers/creators in EPL 2021/22).</p>
<p>Typical visuals: year slicer + comp slicer ‚Üí ranked season table; season radar for a single comp. Example measures: season ranks within comp, league-specific unattributed share lookups.</p>
<ol start="4" type="1">
<li>v_player_overall</li>
</ol>
<p>Grain: one row per Player (career totals across all teams, competitions, seasons). Columns: global sums: SUM(minutes), SUM(goals), SUM(npg), SUM(pkwon), SUM(pens_scored), SUM(xAG), SUM(assists) ‚Ä¶</p>
<p>Use in Power BI (pages it facilitates):</p>
<p>Career Leaderboards (global top lists).</p>
<p>Player Finder / Similarity starting point (overall vectors).</p>
<p>Award Winners Overview (career totals side-by-side).</p>
<p>Typical visuals: top-N tables, scatter (career NPG vs xAG), profile cards. Example measures: career per-90, career penalty reliance, career conversion.</p>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    window.setColorSchemeToggle(window.hasAlternateSentinel())
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/diggydigsdata\.github\.io");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>This page is built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/diggydigsdata/blob/main/posts/vignettes/index.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="../../LICENSE">
<p>License</p>
</a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>