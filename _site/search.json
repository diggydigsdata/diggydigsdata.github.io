[
  {
    "objectID": "posts/too-messy-to-melt/index.html",
    "href": "posts/too-messy-to-melt/index.html",
    "title": "Too Messy to Melt",
    "section": "",
    "text": "In pandas (and tidy-data workflows), melt() is the standard tool for reshaping a wide table into a long one.\nIn this project, the original spreadsheet (see below) wasn’t just wide — it was inconsistent across season formats, team naming conventions, and placeholder values (e.g., COVID). A naive pd.melt() would have produced incorrect joins and silent errors.\n\n\n\nUnusably messy attendance spreadsheet\n\n\nThis page documents the reproducible reshaping pipeline used to build the final open dataset.\nThe final output of this process is the perfect_tidy_data.csv file. Read on to learn more about its structure, contents and composition or simply Download perfect_tidy_data.csv. The CSV becomes an analysis-ready Python DataFrame after some further enrichment - see the final code block for details."
  },
  {
    "objectID": "posts/scraper-fc-api-doc/index.html",
    "href": "posts/scraper-fc-api-doc/index.html",
    "title": "ScraperFC API Documentation",
    "section": "",
    "text": "Copyright 2022 Owen Seymour. Use of this source code is governed by the GPL 3.0 license."
  },
  {
    "objectID": "posts/scraper-fc-api-doc/index.html#scrape_stats",
    "href": "posts/scraper-fc-api-doc/index.html#scrape_stats",
    "title": "ScraperFC API Documentation",
    "section": "scrape_stats()",
    "text": "scrape_stats()\n\nClass: ScraperFC.fbref.FBref\nMethod: scrape_stats()\nReturns: A tuple of DataFrames\n\n\n\n\n\n\n\nUsage considerations\n\n\n\n\nBefore using this scraper on FBref data, review the Sports Reference Terms of Service.\n\nSection 5 of their Site Terms of Use\nSR and Data Use policy\nBot/Scraping/Crawler Traffic policies\n\nData usage: FBref permits scraping only under certain use cases (e.g., personal or educational). It is not permitted for competing analytics services or for public hosting.\nRate limiting: FBref requests no more than 10 site requests per minute. This scraper uses wait_time=7 to pause between requests. Always check the current terms of service before scraping.\n\n\n\nscrape_stats() allows you to download FBref season-level Squad Stats, Opponent Stats, and Player Stats for a chosen statistics collection such as “Advanced Goalkeeping”.\nYou can reference the available statistics collections through this FBref navigation:\nCompetition &gt; ‘Squad & Player Stats’ dropdown &gt; Statistical Collection &gt; Toggle between ‘Squad & Opponent Stats’ or scroll for ‘Player Stats’\nYou can find an example of Premier League 2024/25 ‘Player Stats’ from the ‘Standard’ stats collection here."
  },
  {
    "objectID": "posts/scraper-fc-api-doc/index.html#prerequisites",
    "href": "posts/scraper-fc-api-doc/index.html#prerequisites",
    "title": "ScraperFC API Documentation",
    "section": "Prerequisites",
    "text": "Prerequisites\n\nInstall the ScraperFC package:\n\npip install ScraperFC\n(The package is not currently available on conda or conda-forge.)\n\nLoad the fbref module:\n\nfrom ScraperFC.fbref import FBref\n\nInitialize the scraper object:\n\nfb_scraper = FBref()"
  },
  {
    "objectID": "posts/scraper-fc-api-doc/index.html#parameters",
    "href": "posts/scraper-fc-api-doc/index.html#parameters",
    "title": "ScraperFC API Documentation",
    "section": "Parameters",
    "text": "Parameters\n\nyear (str, required)\n\nSeason to scrape.\nFormat: match the season strings on the Competition History page of the target league (e.g., Big 5 Leagues).\nYou can check accepted year inputs with get_valid_seasons():\n\n\nvalid_seasons = fb_scraper.get_valid_seasons(\"La Liga\")\nseason_list = list(valid_seasons.keys())\nprint(season_list)\n\n\n\n\n\n\nOutput\n\n\n\n['2025-2026', '2024-2025', '2023-2024', '2022-2023', ...]\n\n\n\nleague (str, required)\n\nLeague to scrape (usually the long name, e.g., “Bundesliga”, “Ligue 1”; some exceptions like “EPL”).\nCheck accepted values with comps.keys():\n\n\nvalid_league_names = list(fb_scraper.comps.keys())\nprint(valid_league_names)\n\n\n\n\n\n\nOutput\n\n\n\n['Copa Libertadores', 'Champions League', 'Europa League', ...]\n\n\n\nstat_category (str, required)\n\nStat category to scrape; use the full names except “miscellaneous”, which should be \"misc\".\nCheck accepted values with stats_categories.keys():\n\n\nstat_categories = list(fb_scraper.stats_categories.keys())\nprint(stat_categories)\n\n\n\n\n\n\nOutput\n\n\n\n['standard', 'goalkeeping', 'advanced goalkeeping', ...]"
  },
  {
    "objectID": "posts/scraper-fc-api-doc/index.html#returns",
    "href": "posts/scraper-fc-api-doc/index.html#returns",
    "title": "ScraperFC API Documentation",
    "section": "Returns",
    "text": "Returns\nA tuple of three pd.DataFrame objects: (squad_stats, opponent_stats, player_stats)\n\nsquad_stats: Aggregated stats for all squads in the league and season.\nopponent_stats: Aggregated opponent stats for all squads.\nplayer_stats: Player-level stats for the league and season."
  },
  {
    "objectID": "posts/scraper-fc-api-doc/index.html#error-handling",
    "href": "posts/scraper-fc-api-doc/index.html#error-handling",
    "title": "ScraperFC API Documentation",
    "section": "Error handling",
    "text": "Error handling\nIf an invalid league name is passed, an error message will print the accepted entries:\nseasons = [\"2025-2026\"]\nleagues = [\"not a league\"]\n\n\n\n\n\n\nOutput\n\n\n\nScraping not a league 2025-2026...\nFailed scraping not a league 2025-2026: not a league is not a valid league for FBref. Valid leagues are ['Copa Libertadores', 'Champions League', 'Europa League', 'Europa Conference League', ...]"
  },
  {
    "objectID": "posts/scraper-fc-api-doc/index.html#full-workflow-example",
    "href": "posts/scraper-fc-api-doc/index.html#full-workflow-example",
    "title": "ScraperFC API Documentation",
    "section": "Full workflow example",
    "text": "Full workflow example\nThis example loops through multiple leagues and seasons, retrieves the standard and misc stat categories, and stores only the player_stats DataFrames.\nfrom ScraperFC.fbref import FBref\nimport pandas as pd\n\n# Initialize scraper object\nfb_scraper = FBref()\n\n# Select desired seasons and leagues\nseasons = [\"2022-2023\", \"2023-2024\"]\nleagues = [\"EPL\", \"La Liga\"]\n\n# Capture the DataFrames during the loop\nall_player_dfs = []\n\n# Loop through all desired seasons and leagues\nfor season in seasons:\n    for league in leagues:\n        try:\n            print(f\"Scraping {league} {season}...\")\n\n            # Scrape 'standard' stats and omit squad/opponent stats\n            _, _, df_standard = fb_scraper.scrape_stats(season, league, \"standard\")\n\n            # Scrape 'misc' stats and omit squad/opponent stats\n            _, _, df_misc = fb_scraper.scrape_stats(season, league, \"misc\")\n\n            # Populate the list\n            all_player_dfs.append(df_standard)\n            all_player_dfs.append(df_misc)\n        except Exception as e:\n            print(f\"Failed scraping {league} {season}: {e}\")\n\nprint(\"Scraping complete.\")"
  },
  {
    "objectID": "posts/scraper-fc-api-doc/index.html#versioning",
    "href": "posts/scraper-fc-api-doc/index.html#versioning",
    "title": "ScraperFC API Documentation",
    "section": "Versioning",
    "text": "Versioning\nThis documentation applies to ScraperFC v3.4.0 (current stable release).\nTo check your installed version:\nfrom importlib.metadata import version\n\ninstalled_version = version(\"ScraperFC\")\nprint(f\"ScraperFC Version: {installed_version}\")\n\n\n\n\n\n\nWarning\n\n\n\nA major overhaul to the league-names parameter is planned for v4.0. Upgrading may break existing code. To preview upcoming changes, switch the documentation dropdown (bottom-right) from “stable” to “latest”."
  },
  {
    "objectID": "posts/scraper-fc-api-doc/index.html#sources",
    "href": "posts/scraper-fc-api-doc/index.html#sources",
    "title": "ScraperFC API Documentation",
    "section": "Sources",
    "text": "Sources\n\nScraperFC’s official docs\nPackage page on PyPi\nCreator’s GitHub\nCreator’s Buy Me a Coffee"
  },
  {
    "objectID": "posts/no-fear-at-that-age/index.html",
    "href": "posts/no-fear-at-that-age/index.html",
    "title": "No Fear At That Age",
    "section": "",
    "text": "‘There’s no fear at that age’ is a familiar refrain from pundits. The idea goes that young players are naive, innocent; they take risks, they express themselves, and in an ‘ignorance is bliss way’ they don’t show nerves the way older players do - or something.\nI guess the fearlessness theory rests on the presumption that young players think they have all the time in the world so a few blunders early on in their career won’t be the end of it. Or, there is so little pressure applied on them relative to senior players that they play with freedom and can ‘express themselves’. I can understand that to a certain extent, although young players could easily go in the other, overawed direction. 18 year old me would definitely have fallen into the shitting myself camp. But then, it could be argued that I don’t have the mentality of an elite athlete.\nNevertheless, I’ve always been skeptical. They are young adults, not toddlers. And loads of promising young careers go up in smoke; the consequences for these players’ lives are devastating. Look at Jose Baxter, for example. I would imagine most young players have seen enough academy cohort colleagues fall by the wayside that they are acutely aware of their vulnerability. So I wanted to dig into this throwaway comment from pundits and find some way to interrogate it statistically.\nThe metric that is the easiest to isolate as a corollary for fear is the penalty. That’s because another fairly common idea is that every elite player should be able to tuck away a penalty. And that, 12 yards from goal, it is nerves rather than technique which undoes the pro player. While the best way to explore fear would be penalty shootout data - where every single kick is critical - I haven’t got that and will normal-time penalties as a proxy. Of course, these don’t have quite the same almighty importance but they still tell us something about the effects of nerves.\nThis is part of a series of analyses I’m doing where I fixate on penalties. It just drives me crazy how prevalent they are. It increasingly like every final is decided on penalties and every match a penalty is awarded. And it’s not just because of VAR. These increases have been ongoing for some time. See Figure 1. Or the interactive version Figure 2, though I haven’t added many leagues so there’s not much to play around with. At time of writing, Harry Kane is having the season of his life - so the story goes - with 14 goals in 7 games. Astonishing, yes, but 6 of those have been penalties… Without penalties he’s at 8 in 7, which is still very good but well short of his current Dixie Dean trajectory. Anyway, I digress. If you’re interested, my main project is this one:\n\nWhat would happen if players who won the penalties were the only ones who got to take them? https://eoind.github.io/analytics/football/penalty_takers/\nAnd now for… are young players really fearless? What does the penalty data say? (read on to find out!)\n\n\n\n\n\n\n\n\n\nFigure 1: Average penalties per match over time, by league (with global trend)\n\n\n\n\n\n\n\n\n\n\n\n\n        \n        \n        \n\n\n(a)\n\n\n\n\n\n\n                            \n                                            \n\n\n(b)\n\n\n\n\n\nFigure 2"
  },
  {
    "objectID": "posts/no-fear-at-that-age/index.html#penalty-sampling",
    "href": "posts/no-fear-at-that-age/index.html#penalty-sampling",
    "title": "No Fear At That Age",
    "section": "Penalty sampling",
    "text": "Penalty sampling\nI have whipped up the following (courtesy of Stathead / FBref):\n\nEvery normal time penalty taken in the Premier League - in other words, since the 1992/1993 season\nEvery normal time penalty taken in the Champions League since the 1999/2000 season\nEvery normal time penalty taken in La Liga since the 1999/2000 season\n\n\n\n\nLeague\nTotal Penalties\n\n\n\n\nPremier League\n2892\n\n\nLa Liga\n2956\n\n\nChampions League\n925\n\n\nTotal\n6773"
  },
  {
    "objectID": "posts/no-fear-at-that-age/index.html#age-bands",
    "href": "posts/no-fear-at-that-age/index.html#age-bands",
    "title": "No Fear At That Age",
    "section": "Age bands",
    "text": "Age bands\nFinally, I have constructed some age groupings. See . This is in order to prevent small samples for different ages giving unreliable values. For example, there is a 20% difference in the success rate for La Liga 19 year-olds compared 20 year-olds. However, given these age groups have relatively few attempts it’s easy for the data to get a little wild.\nI think the groups I have created are fairly logical. At the top and bottom end we’ve got open intervals - we can have players from 0 to 20; though the youngest penalty taker in this data is 17. And our 33+ group can go to infinity. Though the oldest penalty taker is .. This group are called No Fear At That Age? Because it’s the age when expectations are minimal, you are at your most naive, innocent, etc. And the elder statesmen are called Cherry on Top. I would theorise that they also have a bit less pressure, because they have already had a good career, and nobody is looking at their performance as a measure of their potential. They are a known quantity by this point.\nThey sandwich 3-year age bands. 21-23 could be the most pressurised age. That’s the point at which many wonderkid careers have gone awry - think Bojan Krkic. It’s the moment when you need to step up, mature, realise your potential and be consistent. Otherwise, a journeyman career in the lower leagues could await you. Then 24-26 could constitute the beginning of a player’s peak years. 27-29 would often be considered, depending a little on position, the absolute peak years of the average player. 30-32 has proven very fruitful for many players too. However, the perspective on these players definitely shifts. At this point, pressure amplifies because pundits and fans are often questioning whether you are ‘past it’, whether you should get a multi-year contract renewal or not. Just look at Mo Salah. In 2024/2025 he has having a career year but, at the age of 32, Liverpool have spent all season agonising about whether to give him a commensurate contract because of his age.\n\nCaveat\nOne enormous caveat, however, is that the ages provided by Stathead simply use the player’s age at the commencement of the season, not their age at the time of taking a penalty. Consequently, the oldest penalty taker in the dataset is Teddy Sheringham. He appears as 39 in my dataset, but he had recently turned 40 when he missed a final-day penalty for West Ham against Tottenham in the 2005/06 season. Jorge Molina also appears as 39 in my dataset, but he was 40 when he missed against Espanyol on the final day of the 2021/22 season, effectively relegating Granada from La Liga.\nSimilarly, the dataset indicates a 17 year-old - Bojan Krkic. But he was 18 by the time he took his penalty for Barcelona against Manchester United in the Champions League. This is all rather annoying, but it would be more trouble than it’s worth to separate out every single penalty from each player’s season statistics and dial in the taker’s age on a specific date. It just means there is a +/- of 9 months (i.e. the length of a season) for each player’s age."
  },
  {
    "objectID": "posts/no-fear-at-that-age/index.html#averages",
    "href": "posts/no-fear-at-that-age/index.html#averages",
    "title": "No Fear At That Age",
    "section": "Averages",
    "text": "Averages\nIn this analysis I calculate conversion rates in two different ways, which reflect slightly different questions:\n\nWeighted (overall) mean: This is the percentage of all penalties scored divided by the total penalties attempted within a group (e.g. a competition). Every penalty counts equally, so players who take more penalties have more influence. This measure tells us the true success rate of the group as a whole.\nUnweighted (player) mean: This is the simple average of individual players’ conversion rates. Each player counts equally, no matter how many penalties they have taken. This measure answers the question: what does the “average player” in this group look like?\n\nIn the charts shown here, the main benchmark (red dashed line) is the weighted overall mean, because it reflects the actual outcome of all penalties taken across the dataset."
  },
  {
    "objectID": "posts/no-fear-at-that-age/index.html#analysis",
    "href": "posts/no-fear-at-that-age/index.html#analysis",
    "title": "No Fear At That Age",
    "section": "Analysis",
    "text": "Analysis\nFirst off, when it comes to conversion rates across the leagues, there are no differences whatsoever. Which is boring but convenient that we don’t need to worry too much about league effects.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPKatt\nPK\nPKm\nconversion_rate\n\n\nComp\n\n\n\n\n\n\n\n\nCL\n925\n714\n211\n77.189189\n\n\nEPL\n2892\n2280\n612\n78.838174\n\n\nLa Liga\n2956\n2288\n668\n77.401894\n\n\n\n\n\n\n\nOr do we? Any differences when we break the leagues down by age group?\nThere’s maybe a trend towards improved penalty conversion as you accumulate experience. The ‘no fear’ players are slightly more clinical than the players aged 21-23 who may be coming under pressure to make the next step as more mature and consistent players.\nBut this is the smallest dataset - only 925 penalties.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAge Group Penalty Data (Premier League)\n\n\n\n\n\n\n\n\n\nAge Group\nPenalty Attempts\nPenalty Conversions\nConversion Rate (%)\n\n\n\n\n&lt;=20: No Fear At That Age?\n80\n60\n75.00\n\n\n21-23: Not A Kid Anymore\n503\n398\n79.13\n\n\n24-26: Early Peak\n834\n654\n78.42\n\n\n27-29: Peak Peak\n793\n624\n78.69\n\n\n30-32: Over The Hill?\n495\n387\n78.18\n\n\n33+: Cherry On Top\n187\n157\n83.96\n\n\nGrand Total\n2892\n2280\n78.84\n\n\n\nIn the Premier League, things level out a bit more, although there still seems to be a mild advantage for experience.\n\n\nAge Group Penalty Data (La Liga)\n\n\n\n\n\n\n\n\n\nAge Group\nPenalty Attempts\nPenalty Conversions\nConversion Rate (%)\n\n\n\n\n&lt;=20: No Fear At That Age?\n81\n63\n77.78\n\n\n21-23: Not A Kid Anymore\n405\n307\n75.80\n\n\n24-26: Early Peak\n829\n653\n78.77\n\n\n27-29: Peak Peak\n833\n644\n77.31\n\n\n30-32: Over The Hill?\n511\n400\n78.28\n\n\n33+: Cherry On Top\n297\n221\n74.41\n\n\nGrand Total\n2956\n2288\n77.40\n\n\n\nThings get flipped on their head a little bit in La Liga. For the first time, the Cherry on Top vets aren’t the most effective penalty takers. In fact, in La Liga they are the worst. Meanwhile, the 20s and under are right up there near the top. And if we drill down into that age group, we can really appreciate how precocious those La Liga teens are.\n\n\n\n\n\n\n\n\n\nAge Group\nPenalty Attempts\nPenalty Conversions\nConversion Rate (%)\n\n\n\n\n&lt;=20: No Fear At That Age?\n81\n63\n77.78\n\n\n18\n10\n8\n80.00\n\n\n19\n27\n24\n88.89\n\n\n20\n44\n31\n70.45\n\n\n\nLet’s remove the 20 year olds. Now, La Liga teens have a success rate of 86%! Of course, there’s a caveat… That’s a population size of just 37. Ezequiel Garay - one of history’s great centre-back penalty takers and a stalwart of my FC Atlas team in Football Manager - accounts for 22% of the entire La Liga teenage penalty taking population. And Jose Antonio Reyes accounts for another 19%. All together, those two players - and their combined 92% success rate - represent 41% of the whole group.\nSo let’s bundle everything together and see what we get…\n\n\n\n\n\n\n\n\n\nAge Group\nPenalty Attempts\nPenalty Conversions\nConversion Rate (%)\n\n\n\n\n&lt;=20: No Fear At That Age\n202\n153\n75.74\n\n\n21-23: Not A Kid Anymore\n1047\n804\n76.79\n\n\n24-26: Early Peak\n1901\n1491\n78.43\n\n\n27-29: Peak Peak\n1898\n1485\n78.24\n\n\n30-32: Over The Hill?\n1164\n909\n78.09\n\n\n33+: Cherry On Top\n561\n440\n78.43\n\n\nGrand Total\n6773\n5282\n77.99\n\n\n\nThere is a very mild indication that more experienced players do better than younger players. Considering the lowest success rates are 20 and under, and 21-23 are 2nd-lowest, there is some indication that young players are not totally fearless. I think this could be particularly noteworthy because, players who are designated penalty takers at such a young are rare and they are, in all likelihood, technically gifted. Therefore, is it a psychological vulnerability that causes their penalty-taking to dip a little compared to their older peers? And that maybe they aren’t so impervious to fear as pundits may casually claim?\nLet’s see if this stands up to statistical scrutiny.\n\n\nLogistic Regression\n\nMethod\nEach penalty in the dataset is tied to a player, season, and league. Since some players take penalties in multiple seasons (or even in multiple leagues), the raw data contained repeated rows for the same player. To avoid overweighting those players, we collapsed the dataset to one row per player × age group × league, summing up penalties scored and attempted within each cell. This way, every player contributes fairly to the analysis.\nI used a logistic regression model because the outcome of interest—scoring or missing a penalty—is binary. Logistic regression lets us model the probability of success while accounting for the number of attempts in each cell. We tested age group, league, and their interaction to see if any of them had an effect on conversion rates. Confidence intervals were estimated around the predicted probabilities to judge how much overlap there was between groups.\n\n\nResults\nTo test whether penalty conversion varies by age or by league, I fit a logistic regression with both predictors and their interaction. The likelihood-ratio tests showed no evidence that either factor—or their combination—improves model fit (all p &gt; .4). In other words, neither age group nor league explains variation in conversion odds.\nPredicted probabilities were remarkably consistent across groups, generally hovering between 73% and 84%. For instance:\n\n≤20 years: 73–78% across leagues\n\n21–23 years: 71–79%\n\n27–29 years (peak): 77–79%\n\n33+ years: 74–84%\n\nConfidence intervals overlapped substantially, indicating no systematic age or league effect.\nNote: Bars show predicted conversion probabilities with 95% confidence intervals. The dashed line indicates the overall average (~78%).\n\n\n\n\n\n\nconversion by age\n\n\n\nage_group\nComp\npred_prob\nci_low\nci_high\n\n\n\n\n720\n&lt;=20: No Fear At That Age?\nCL\n0.731707\n0.577484\n0.844769\n\n\n721\n&lt;=20: No Fear At That Age?\nEPL\n0.750000\n0.643950\n0.832670\n\n\n452\n&lt;=20: No Fear At That Age?\nLa Liga\n0.777778\n0.674573\n0.855275\n\n\n309\n21-23: Not A Kid Anymore\nCL\n0.712230\n0.631588\n0.781332\n\n\n94\n21-23: Not A Kid Anymore\nEPL\n0.791252\n0.753518\n0.824555\n\n\n41\n21-23: Not A Kid Anymore\nLa Liga\n0.758025\n0.713916\n0.797264\n\n\n258\n24-26: Early Peak\nCL\n0.773109\n0.715574\n0.821903\n\n\n7\n24-26: Early Peak\nEPL\n0.784173\n0.754948\n0.810785\n\n\n26\n24-26: Early Peak\nLa Liga\n0.787696\n0.758529\n0.814203\n\n\n333\n27-29: Peak Peak\nCL\n0.797794\n0.745865\n0.841369\n\n\n10\n27-29: Peak Peak\nEPL\n0.786885\n0.756998\n0.814000\n\n\n83\n27-29: Peak Peak\nLa Liga\n0.773109\n0.743418\n0.800288\n\n\n498\n30-32: Over The Hill?\nCL\n0.772152\n0.700306\n0.830932\n\n\n517\n30-32: Over The Hill?\nEPL\n0.781818\n0.743263\n0.816017\n\n\n68\n30-32: Over The Hill?\nLa Liga\n0.782779\n0.744914\n0.816408\n\n\n807\n33+: Cherry On Top\nCL\n0.805195\n0.701640\n0.879006\n\n\n520\n33+: Cherry On Top\nEPL\n0.839572\n0.779802\n0.885500\n\n\n773\n33+: Cherry On Top\nLa Liga\n0.744108\n0.691427\n0.790519\n\n\n\n\n\n\n\n\n\n\nSources\n\nImage: 中国新闻社, CC BY 3.0 https://creativecommons.org/licenses/by/3.0, via Wikimedia Commons\n\nData assembled from: Stathead"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Diggy Digs Data",
    "section": "",
    "text": "Too Messy to Melt\n\n21 min\n\nDownloadable attendance churn dataset and walkthrough of its creation - from messy and manual Excel to a tidy and reproducible Python pipeline.\n\n\n\nDec 22, 2025\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe Winner Takes Them All (Project Map with Power BI Dashboard)\n\n2 min\n\nA penalty-won-adjusted goals metric, a demo Power BI dashboard, and a roadmap toward a refreshable data pipeline.\n\n\n\nDec 21, 2025\n\n\n\n\n\n\n\n\n\n\n\n\n\nGrade Adjusted Pace (GAP)\n\n8 min\n\nGrade Adjusted Pace estimates how fast you would have run on a flat route even if your run was on varied grades.\n\n\n\nNov 17, 2025\n\n\n\n\n\n\n\n\n\n\n\n\n\nFair-Weather Fans?\n\n17 min\n\nDishing the data dirt on post-relegation loyalty.\n\n\n\nNov 1, 2025\n\n\n\n\n\n\n\n\n\n\n\n\n\nScraperFC API Documentation\n\n5 min\n\nAn example of API technical writing. Documents a method from the ScraperFC package (Python). Covers parameters, return types, workflow examples, error handling, versioning…\n\n\n\nNov 1, 2025\n\n\n\n\n\n\n\n\n\n\n\n\n\nNo Fear At That Age\n\n30 min\n\nTesting if there’s merit to the claim that young players are fearless.\n\n\n\nSep 29, 2025\n\n\n\n\n\n\n\n\n\n\n\n\n\nCurrys\n\n1 min\n\nWriting samples from my days as a copywriter at tech retailer Currys.\n\n\n\nSep 30, 2024\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "assets/notebooks/Main notebook.html",
    "href": "assets/notebooks/Main notebook.html",
    "title": "No Fear At That Age",
    "section": "",
    "text": "‘There’s no fear at that age’ is a familiar refrain from pundits. The idea goes that young players are naive, innocent; they take risks, they express themselves, and in an ‘ignorance is bliss way’ they don’t show nerves the way older players do - or something.\nI guess the fearlessness theory rests on the presumption that young players think they have all the time in the world so a few blunders early on in their career won’t be the end of it. Or, there is so little pressure applied on them relative to senior players that they play with freedom and can ‘express themselves’. I can understand that to a certain extent, although young players could easily go in the other, overawed direction. 18 year old me would definitely have fallen into the shitting myself camp. But then, it could be argued that I don’t have the mentality of an elite athlete.\nNevertheless, I’ve always been skeptical. They are young adults, not toddlers. And loads of promising young careers go up in smoke; the consequences for these players’ lives are devastating. Look at Jose Baxter, for example. I would imagine most young players have seen enough academy cohort colleagues fall by the wayside that they are acutely aware of their vulnerability. So I wanted to dig into this throwaway comment from pundits and find some way to interrogate it statistically.\nThe metric that is the easiest to isolate as a corollary for fear is the penalty. That’s because another fairly common idea is that every elite player should be able to tuck away a penalty. And that, 12 yards from goal, it is nerves rather than technique which undoes the pro player. While the best way to explore fear would be penalty shootout data - where every single kick is critical - I haven’t got that and will normal-time penalties as a proxy. Of course, these don’t have quite the same almighty importance but they still tell us something about the effects of nerves.\nThis is part of a series of analyses I’m doing where I fixate on penalties. It just drives me crazy how prevalent they are. It increasingly like every final is decided on penalties and every match a penalty is awarded. And it’s not just because of VAR. These increases have been ongoing for some time. See Figure 1. Or the interactive version Figure 2, though I haven’t added many leagues so there’s not much to play around with. At time of writing, Harry Kane is having the season of his life - so the story goes - with 14 goals in 7 games. Astonishing, yes, but 6 of those have been penalties… Without penalties he’s at 8 in 7, which is still very good but well short of his current Dixie Dean trajectory. Anyway, I digress. If you’re interested, my main project is this one:\n\nWhat would happen if players who won the penalties were the only ones who got to take them? https://eoind.github.io/analytics/football/penalty_takers/\nAnd now for… are young players really fearless? What does the penalty data say? (read on to find out!)\n\n\n\n\n\n\n\n\n\nFigure 1: Average penalties per match over time, by league (with global trend)\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 2"
  },
  {
    "objectID": "assets/notebooks/Main notebook.html#penalty-sampling",
    "href": "assets/notebooks/Main notebook.html#penalty-sampling",
    "title": "No Fear At That Age",
    "section": "Penalty sampling",
    "text": "Penalty sampling\nI have whipped up the following (courtesy of Stathead / FBref):\n\nEvery normal time penalty taken in the Premier League - in other words, since the 1992/1993 season\nEvery normal time penalty taken in the Champions League since the 1999/2000 season\nEvery normal time penalty taken in La Liga since the 1999/2000 season\n\n\n\n\nLeague\nTotal Penalties\n\n\n\n\nPremier League\n2892\n\n\nLa Liga\n2956\n\n\nChampions League\n925\n\n\nTotal\n6773"
  },
  {
    "objectID": "assets/notebooks/Main notebook.html#age-bands",
    "href": "assets/notebooks/Main notebook.html#age-bands",
    "title": "No Fear At That Age",
    "section": "Age bands",
    "text": "Age bands\nFinally, I have constructed some age groupings. See . This is in order to prevent small samples for different ages giving unreliable values. For example, there is a 20% difference in the success rate for La Liga 19 year-olds compared 20 year-olds. However, given these age groups have relatively few attempts it’s easy for the data to get a little wild.\nI think the groups I have created are fairly logical. At the top and bottom end we’ve got open intervals - we can have players from 0 to 20; though the youngest penalty taker in this data is 17. And our 33+ group can go to infinity. Though the oldest penalty taker is .. This group are called No Fear At That Age? Because it’s the age when expectations are minimal, you are at your most naive, innocent, etc. And the elder statesmen are called Cherry on Top. I would theorise that they also have a bit less pressure, because they have already had a good career, and nobody is looking at their performance as a measure of their potential. They are a known quantity by this point.\nThey sandwich 3-year age bands. 21-23 could be the most pressurised age. That’s the point at which many wonderkid careers have gone awry - think Bojan Krkic. It’s the moment when you need to step up, mature, realise your potential and be consistent. Otherwise, a journeyman career in the lower leagues could await you. Then 24-26 could constitute the beginning of a player’s peak years. 27-29 would often be considered, depending a little on position, the absolute peak years of the average player. 30-32 has proven very fruitful for many players too. However, the perspective on these players definitely shifts. At this point, pressure amplifies because pundits and fans are often questioning whether you are ‘past it’, whether you should get a multi-year contract renewal or not. Just look at Mo Salah. In 2024/2025 he has having a career year but, at the age of 32, Liverpool have spent all season agonising about whether to give him a commensurate contract because of his age.\n\nCaveat\nOne enormous caveat, however, is that the ages provided by Stathead simply use the player’s age at the commencement of the season, not their age at the time of taking a penalty. Consequently, the oldest penalty taker in the dataset is Teddy Sheringham. He appears as 39 in my dataset, but he had recently turned 40 when he missed a final-day penalty for West Ham against Tottenham in the 2005/06 season. Jorge Molina also appears as 39 in my dataset, but he was 40 when he missed against Espanyol on the final day of the 2021/22 season, effectively relegating Granada from La Liga.\nSimilarly, the dataset indicates a 17 year-old - Bojan Krkic. But he was 18 by the time he took his penalty for Barcelona against Manchester United in the Champions League. This is all rather annoying, but it would be more trouble than it’s worth to separate out every single penalty from each player’s season statistics and dial in the taker’s age on a specific date. It just means there is a +/- of 9 months (i.e. the length of a season) for each player’s age."
  },
  {
    "objectID": "assets/notebooks/Main notebook.html#averages",
    "href": "assets/notebooks/Main notebook.html#averages",
    "title": "No Fear At That Age",
    "section": "Averages",
    "text": "Averages\nIn this analysis I calculate conversion rates in two different ways, which reflect slightly different questions:\n\nWeighted (overall) mean: This is the percentage of all penalties scored divided by the total penalties attempted within a group (e.g. a competition). Every penalty counts equally, so players who take more penalties have more influence. This measure tells us the true success rate of the group as a whole.\nUnweighted (player) mean: This is the simple average of individual players’ conversion rates. Each player counts equally, no matter how many penalties they have taken. This measure answers the question: what does the “average player” in this group look like?\n\nIn the charts shown here, the main benchmark (red dashed line) is the weighted overall mean, because it reflects the actual outcome of all penalties taken across the dataset."
  },
  {
    "objectID": "assets/notebooks/Main notebook.html#analysis",
    "href": "assets/notebooks/Main notebook.html#analysis",
    "title": "No Fear At That Age",
    "section": "Analysis",
    "text": "Analysis\nFirst off, when it comes to conversion rates across the leagues, there are no differences whatsoever. Which is boring but convenient that we don’t need to worry too much about league effects.\n\n\n\n\n\n\n\n\n\n         PKatt    PK  PKm  conversion_rate\nComp                                      \nCL         925   714  211        77.189189\nEPL       2892  2280  612        78.838174\nLa Liga   2956  2288  668        77.401894\n\n\nOr do we? Any differences when we break the leagues down by age group?\nThere’s maybe a trend towards improved penalty conversion as you accumulate experience. The ‘no fear’ players are slightly more clinical than the players aged 21-23 who may be coming under pressure to make the next step as more mature and consistent players.\nBut this is the smallest dataset - only 925 penalties.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nAge Group Penalty Data (Premier League)\n\n\n\n\n\n\n\n\n\nAge Group\nPenalty Attempts\nPenalty Conversions\nConversion Rate (%)\n\n\n\n\n&lt;=20: No Fear At That Age?\n80\n60\n75.00\n\n\n21-23: Not A Kid Anymore\n503\n398\n79.13\n\n\n24-26: Early Peak\n834\n654\n78.42\n\n\n27-29: Peak Peak\n793\n624\n78.69\n\n\n30-32: Over The Hill?\n495\n387\n78.18\n\n\n33+: Cherry On Top\n187\n157\n83.96\n\n\nGrand Total\n2892\n2280\n78.84\n\n\n\nIn the Premier League, things level out a bit more, although there still seems to be a mild advantage for experience.\n\n\nAge Group Penalty Data (La Liga)\n\n\n\n\n\n\n\n\n\nAge Group\nPenalty Attempts\nPenalty Conversions\nConversion Rate (%)\n\n\n\n\n&lt;=20: No Fear At That Age?\n81\n63\n77.78\n\n\n21-23: Not A Kid Anymore\n405\n307\n75.80\n\n\n24-26: Early Peak\n829\n653\n78.77\n\n\n27-29: Peak Peak\n833\n644\n77.31\n\n\n30-32: Over The Hill?\n511\n400\n78.28\n\n\n33+: Cherry On Top\n297\n221\n74.41\n\n\nGrand Total\n2956\n2288\n77.40\n\n\n\nThings get flipped on their head a little bit in La Liga. For the first time, the Cherry on Top vets aren’t the most effective penalty takers. In fact, in La Liga they are the worst. Meanwhile, the 20s and under are right up there near the top. And if we drill down into that age group, we can really appreciate how precocious those La Liga teens are.\n\n\n\n\n\n\n\n\n\nAge Group\nPenalty Attempts\nPenalty Conversions\nConversion Rate (%)\n\n\n\n\n&lt;=20: No Fear At That Age?\n81\n63\n77.78\n\n\n18\n10\n8\n80.00\n\n\n19\n27\n24\n88.89\n\n\n20\n44\n31\n70.45\n\n\n\nLet’s remove the 20 year olds. Now, La Liga teens have a success rate of 86%! Of course, there’s a caveat… That’s a population size of just 37. Ezequiel Garay - one of history’s great centre-back penalty takers and a stalwart of my FC Atlas team in Football Manager - accounts for 22% of the entire La Liga teenage penalty taking population. And Jose Antonio Reyes accounts for another 19%. All together, those two players - and their combined 92% success rate - represent 41% of the whole group.\nSo let’s bundle everything together and see what we get…\n\n\n\n\n\n\n\n\n\nAge Group\nPenalty Attempts\nPenalty Conversions\nConversion Rate (%)\n\n\n\n\n&lt;=20: No Fear At That Age\n202\n153\n75.74\n\n\n21-23: Not A Kid Anymore\n1047\n804\n76.79\n\n\n24-26: Early Peak\n1901\n1491\n78.43\n\n\n27-29: Peak Peak\n1898\n1485\n78.24\n\n\n30-32: Over The Hill?\n1164\n909\n78.09\n\n\n33+: Cherry On Top\n561\n440\n78.43\n\n\nGrand Total\n6773\n5282\n77.99\n\n\n\nThere is a very mild indication that more experienced players do better than younger players. Considering the lowest success rates are 20 and under, and 21-23 are 2nd-lowest, there is some indication that young players are not totally fearless. I think this could be particularly noteworthy because, players who are designated penalty takers at such a young are rare and they are, in all likelihood, technically gifted. Therefore, is it a psychological vulnerability that causes their penalty-taking to dip a little compared to their older peers? And that maybe they aren’t so impervious to fear as pundits may casually claim?\nLet’s see if this stands up to statistical scrutiny.\nData assembled from: Stathead\n\n\nLogistic Regression\n\nMethod\nEach penalty in the dataset is tied to a player, season, and league. Since some players take penalties in multiple seasons (or even in multiple leagues), the raw data contained repeated rows for the same player. To avoid overweighting those players, we collapsed the dataset to one row per player × age group × league, summing up penalties scored and attempted within each cell. This way, every player contributes fairly to the analysis.\nI used a logistic regression model because the outcome of interest—scoring or missing a penalty—is binary. Logistic regression lets us model the probability of success while accounting for the number of attempts in each cell. We tested age group, league, and their interaction to see if any of them had an effect on conversion rates. Confidence intervals were estimated around the predicted probabilities to judge how much overlap there was between groups.\n\n\nResults\nTo test whether penalty conversion varies by age or by league, I fit a logistic regression with both predictors and their interaction. The likelihood-ratio tests showed no evidence that either factor—or their combination—improves model fit (all p &gt; .4). In other words, neither age group nor league explains variation in conversion odds.\nPredicted probabilities were remarkably consistent across groups, generally hovering between 73% and 84%. For instance:\n\n≤20 years: 73–78% across leagues\n\n21–23 years: 71–79%\n\n27–29 years (peak): 77–79%\n\n33+ years: 74–84%\n\nConfidence intervals overlapped substantially, indicating no systematic age or league effect.\nNote: Bars show predicted conversion probabilities with 95% confidence intervals. The dashed line indicates the overall average (~78%).\n\n\n\n\n\n\nconversion by age\n\n\n\nage_group\nComp\npred_prob\nci_low\nci_high\n\n\n\n\n720\n&lt;=20: No Fear At That Age?\nCL\n0.731707\n0.577484\n0.844769\n\n\n721\n&lt;=20: No Fear At That Age?\nEPL\n0.750000\n0.643950\n0.832670\n\n\n452\n&lt;=20: No Fear At That Age?\nLa Liga\n0.777778\n0.674573\n0.855275\n\n\n309\n21-23: Not A Kid Anymore\nCL\n0.712230\n0.631588\n0.781332\n\n\n94\n21-23: Not A Kid Anymore\nEPL\n0.791252\n0.753518\n0.824555\n\n\n41\n21-23: Not A Kid Anymore\nLa Liga\n0.758025\n0.713916\n0.797264\n\n\n258\n24-26: Early Peak\nCL\n0.773109\n0.715574\n0.821903\n\n\n7\n24-26: Early Peak\nEPL\n0.784173\n0.754948\n0.810785\n\n\n26\n24-26: Early Peak\nLa Liga\n0.787696\n0.758529\n0.814203\n\n\n333\n27-29: Peak Peak\nCL\n0.797794\n0.745865\n0.841369\n\n\n10\n27-29: Peak Peak\nEPL\n0.786885\n0.756998\n0.814000\n\n\n83\n27-29: Peak Peak\nLa Liga\n0.773109\n0.743418\n0.800288\n\n\n498\n30-32: Over The Hill?\nCL\n0.772152\n0.700306\n0.830932\n\n\n517\n30-32: Over The Hill?\nEPL\n0.781818\n0.743263\n0.816017\n\n\n68\n30-32: Over The Hill?\nLa Liga\n0.782779\n0.744914\n0.816408\n\n\n807\n33+: Cherry On Top\nCL\n0.805195\n0.701640\n0.879006\n\n\n520\n33+: Cherry On Top\nEPL\n0.839572\n0.779802\n0.885500\n\n\n773\n33+: Cherry On Top\nLa Liga\n0.744108\n0.691427\n0.790519"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "Eoin Dignan",
    "section": "",
    "text": "My name is Eoin, but throughout high school I was known exclusively as Diggy.\nI’m an MSc Data Science student (part-time) with an expected completion in 2027.\nMy background is in ecommerce copywriting, teaching & special needs care. Here is my resume.\n\n\n Miscellaneous Certificates\n\n\nTechSmith\nCamtasia\nSnagit\nSnagit - Techniques for Creating Training Materials\nSnagit - Techniques for Technical Documentation\n\n\n\nCoding:\nLearn Python 3 Skill Path (Codecademy)\nDataCamp Python Certificates\nDataCamp R Certificates\nDataCamp SQL Certificates\n\n\n\nBusiness Intelligence:\nDataCamp Power BI & Excel Certificates\n\n\n\nSEO & Marketing:\nGet Started Using Google Analytics (GA4)\nSemrush Academy SEO Principles: An Essential Guide for Beginners\n\n\n\nTeaching:\nInternational House Certificate in Teaching Young Learners and Teenagers (IHCYLT)\nCertificate in Teaching English to Speakers of Other Languages"
  },
  {
    "objectID": "assets/archived_md/index.html",
    "href": "assets/archived_md/index.html",
    "title": "Fair-Weather Fans?",
    "section": "",
    "text": "Project To-Dos:\n\n\n\n\n\n\nMake a Shiny for Python dashboard\nAdd a box plot with Destination: PL relegation, Championship survival, Championship promotion, Championship relegation on the x axis # TODO\nCurrently, my tables are just built from data I crunched in Excel a while back. I want to revamp all of this with Python # TODO\nMaybe add formal hypothesis testing and a regression model # TODO\nAdd more leagues. I am expecting things to stabilise once you are out of the Prem and bouncing around the Football League # TODO\nRe-draft of the text\nI’m a Burnley fan. And in honour of our impending promotion to the Premier League and consolidation as a yoyo club par excellence, I thought it would be a good time to assess the impact of relegation from the Premier League on attendance figures. Because it’s never too early to plan ahead."
  },
  {
    "objectID": "assets/archived_md/index.html#methodology",
    "href": "assets/archived_md/index.html#methodology",
    "title": "Fair-Weather Fans?",
    "section": "Methodology",
    "text": "Methodology\nFor this project, I gathered attendance data for every relegated club in the season they were relegated, and in the 2 seasons following their relegation. I also checked what league they were in for their 2nd year post-relegation. Had they been promoted at the first attempt? Spent another season in the Championship, or plummeted into League 1. I gathered all of this data from European-Football-Statistics.co.uk."
  },
  {
    "objectID": "assets/archived_md/index.html#analysis",
    "href": "assets/archived_md/index.html#analysis",
    "title": "Fair-Weather Fans?",
    "section": "Analysis",
    "text": "Analysis\n\nIncreased attendance after relegation?\nLet’s start on a positive note. On 10 occasions, teams managed to increase their average attendance following relegation.\n\n\n\n\n\n\n\n\n\n\nRelegated Team (Season)\nAttd.\nYear After\nAttd. year after\nLoss/Gain %\n\n\n\n\nSunderland (96/97)\n20,865\n1997-98\n33,492\n60.5%\n\n\nLeicester City (01/02)\n19,835\n2002-03\n29,231\n47.4%\n\n\nNottingham Forest (92/93)\n21,910\n1993-94\n23,051\n5.2%\n\n\nIpswich Town (01/02)\n24,426\n2002-03\n25,455\n4.2%\n\n\nBurnley (21/22)\n19,399\n2022-23\n19,953\n2.9%\n\n\nNewcastle United (15/16)\n49,754\n2016-17\n51,106\n2.7%\n\n\nNorwich City (04/05)\n24,350\n2005-06\n24,952\n2.5%\n\n\nCrystal Palace (94/95)\n14,992\n1995-96\n15,248\n1.7%\n\n\nLuton Town (23/24)\n11,244\n2024-25\n11,420\n1.6%\n\n\nMiddlesbrough (96/97)\n29,848\n1997-98\n29,994\n0.5%\n\n\n\nAnd I have to give a shoutout to Burnley and, indeed, to Vincent Kompany because he certainly galvanised the supporters that season.\nA couple teams really jump out. Both Sunderland and Leicester City moved into new stadia the year after their relegation, and this gave them a considerable bump. They must have been absolutely packing out their stadia the season prior and had supporters banging down the doors to get in. Sunderland even managed to add over 5,000 supporters to their tally the season after relegation, despite the fact that they were still stuck in the Championship. Leicester also increased attendances in 2003-04, by 1,600 to 30,983. But they spent that season in the Premier League, so it’s less startling to see an increase.\nNewcastle also catch the eye. 51,106 fans during the 2016-17 is quite extraordinary. Newcastle’s fanbase has a reputation for diehard loyalty. It’s why many neutrals were happy to see them bought by the Saudis, despite misgivings about sportwashing. Indeed, Newcastle also have the second-highest post-relegation attendance - 43,388 during the 2009-2010 season. That particular season did see an 11% drop on the previous year’s PL average. And the contrast between 2016-17 and 2009-10 is enlightening. Similar to how Burnley fell under the spell of Vincent Kompany in 2022/23, Newcastle fans had a great relationship with Rafael Benitez - their manager from 2016 to 2019. Hired towards the end of their 2015/16 relegation season, it was considered quite a coup to attract Benitez to a Championship-bound club. And the fans showed their appreciation during his first full season in charge with record-breaking attendances.\nTypically, we start to see the cracks in season 2 outside the top flight. Filtering out teams like Leicester who were promoted at the first attempt and had Premier League fixtures to pull in the fans, only 6 teams see attendance figures in the black by season 2.\n\n\n\n\n\n\n\n\n\n\n\nRelegated Team (Season)\nAttd.\nAttd. year after\nLoss/Gain %\nAttd. 2 yrs. after\nLoss/Gain % 2 yrs.\n\n\n\n\nSunderland (96/97)\n20,865\n33,492\n60.5%\n38,745\n86%\n\n\nMiddlesbrough (92/93)\n16,724\n10,400\n-37.8%\n18,702\n11.8%\n\n\nCrystal Palace (94/95)\n14,992\n15,248\n1.7%\n16,085\n7.3%\n\n\nManchester City (95/96)\n27,869\n26,753\n-4.0%\n28,196\n1.2%\n\n\nNorwich City (04/05)\n24,350\n24,952\n2.5%\n24,545\n0.8%\n\n\nIpswich Town (01/02)\n24,426\n25,455\n4.2%\n24,520\n0.4%\n\n\n\nAgain, we have some anomalies. Middlesborough’s attendance nosedived in 1993-94 but they were undergoing a stadium rebuild. Basically, they had more stadium 2 years later. By 2017-18, Middlesborough were hosting 25,544 fans a game in the Championship and over 30,000 during their stint for the preceding year’s stint in the Prem. So their 10,400 fan turnout - heck, even their 18,702 fan turnout, are merely reflective of stadium constraints and not reflective of their true fanbase.\n\n\nNosedives\nThis will include a mini investigation into Middlesborough and Oldham to find out why their attendances plummeted. I think there were explanatory factors.\n\n\nAnd in general?\nOn average, attendance falls significantly after relegation. The below table shows a 1st-year average decrease of 13.72%. And it shows that in the second year, there is an average decrease of 12.34%.\n\n\n\n\n\n\n\n\nLeague\nYear After Avg. Loss/Gain %\n2 yrs After Avg. of Loss/Gain %\n\n\n\n\nChampionship\n-13.72%\n-19.15%\n\n\nLeague 1\nN/A\n-23.80%\n\n\nPL\nN/A\n5.36%\n\n\nOverall\n-13.72%\n-12.34%\n\n\n\nEXCLUDING MIDDLESBOROUGH, LEICESTER & SUNDERLAND\n\n\n\n\n\n\n\n\nLeague\nYear After Avg. Loss/Gain %\n2 yrs After Avg. of Loss/Gain %\n\n\n\n\nChampionship\n-13.45%\n-21.49%\n\n\nLeague 1\nN/A\n-23.80%\n\n\nPL\nN/A\n3.24%\n\n\nOverall\n-14.98%\n-14.59%\n\n\n\nI think this table excluding Middlesborough, Leicester and Sunderland who introduce anomalies related to stadium constructions may be a better reference for this data. Superficially, the above data is reassuring. If you just look at the overalls, then it would seem attendances stabilise in Year 2 after relegation. You lose 15% of your attendance immediately after relegation, but at least it doesn’t get worse. But it does.\nIf you didn’t get promoted to the Premier League at the first time of asking and spend a 2nd year in the Championship, then you can expect to lose a further 8% of your Premier League attendance. And if you get relegated to League 1, that jumps above 10%. So it seems teams will stick with a team more resolutely in the year after their relegation, likely hoping for a successful season and a swift return. By Year 2, that optimism may fade and attendance figures dwindle still further. Let’s probe that performance factor further.\n\n\nDoes performance affect attendance?\nThe below table shows how the outcome of your first season post-relegation can impact attendance figures during that season.\n\n\n\nDestination during Championship Season\nAverage of Loss/Gain %\n\n\n\n\nChampionship\n-16.58%\n\n\nLeague 1\n-28.16%\n\n\nPL\n-5.84%\n\n\n2023/24 teams without year 2 data\n-4.07%\n\n\n   Burnley\n-7.29%\n\n\n   Luton Town\n1.57%\n\n\n   Sheffield United\n-6.47%\n\n\n\nEXCLUDING MIDDLESBOROUGH (93/94), LEICESTER (02/03) & SUNDERLAND (97/98)\n\n\n\nDestination during Championship Season\nAverage of Loss/Gain %\n\n\n\n\nChampionship\n-17.53%\n\n\nLeague 1\n-28.16%\n\n\nPL\n-8.15%\n\n\n2023/24 teams with unknown destination\n-4.07%\n\n\n   Burnley\n-7.29%\n\n\n   Luton Town\n1.57%\n\n\n   Sheffield United\n-6.47%\n\n\n\nIf your club isn’t on track to bounce straight back, then they can expect to lose around 17% of the previous years’ attendance. And if they are heading for back-to-back relegations, with a freefall to League 1, expect losses of 28.16%. If, however, they are in the hunt for promotion then the losses are considerably less. Teams bound for the Premier League only lose 5.84% (8.15% excluding the new-stadium teams). As you can see, the above data also excludes teams who were relegated in 2023/24 - Burnley, Luton, Sheffield United. However, I think it’s best to include them. Luton are likely to be relegated, Burnley are likely to be promoted, and Sheffield United will probably just miss out on the top 2 and console themselves with the playoffs. Since all 3 clubs have spent the entire season on these trajectories, it’s safe enough to incorporate their impact on the season’s attendances. So I will include them as Luton: relegated to League 1; Burnley and Sheffield United promoted to the Premier League.\nWith Burnley & Sheffield United as PL, and Luton as League 1\n\n\n\nDestination during Championship Season\nAverage of Loss/Gain %\n\n\n\n\nOverall\n-13.72%\n\n\nChampionship\n-16.58%\n\n\nLeague 1\n-20.73%\n\n\nPL\n-5.92%\n\n\nGrand Total\n-13.72%\n\n\n\nWith Burnley & Sheffield United as PL, and Luton as League 1. EXCLUDING MIDDLESBOROUGH (93/94), LEICESTER (02/03) & SUNDERLAND (97/98)\n\n\n\nDestination during Championship Season\nAverage of Loss/Gain %\n\n\n\n\nOverall\n-14.98%\n\n\nChampionship\n-17.53%\n\n\nLeague 1\n-20.73%\n\n\nPL\n-8.05%\n\n\nGrand Total\n-14.98%\n\n\n\nLuton really buck the trend for League 1-destined sides. And because there are so few teams who are relegated from the Premier League to League 1 in consecutive seasons, their outlier status has a huge impact on the data, dropping the averages by almost 8%. But can Luton really be considered anomalous when the data population is so small? In my view, yes. First of all, Luton had an emotional relegation season. Their captain Tom Lockyer suffered a cardiac arrest mid-game. Fortunately, he survived and has been on a road to recovery ever since with the view to playing again. Moreover, Luton battled very bravely against relegation despite these traumatising events and despite being financial minnows. Luton were a uniquely united club during their relegation season. However, that is not the only explanation. The other is that Luton are another stadium-constrained side. Kenilworth Road is famously tiny, and was a peculiar relic among Premier League stadiums. Luton have received approval for a stadium rebuild that will double its capacity. Based on their increased attendances post-relegation, Luton are another case of a club where demand has exceeded supply for some time.\nJust a quick note on Burnley, who were in the black during their Kompany-led campaign but have lost almost 8% this season. There are a few factors at play. First, morale sank during Kompany’s PL season. Burnley were truly awful and the core of their Championship-winning side was cast aside in favour of new recruits - an inexplicable decision in the view of many fans. Moreover, ALK capital - the ownership group - made some ill-judged and patronising comments to supporters for not bringing a positive enough atmosphere to Turf Moor. In a nutshell, the mood was bleak by the end of 2022-23. Kompany’s departure and subsequent replacement by Scott Parker failed to excite fans. Nor did selling half the first team squad and sitting through a million 0-0 draws. Despite the successful campaign, Parker-ball has been a bit of a slog. Sidenote: I was a huge Parker skeptic at first but I think he has brought the solidity Burnley needed and, as the season has gone on, a more cohesive team has taken shape, the football has yielded more goals and the fanbase has gotten on side. In any case, this all goes to highlight that there are complexities behind the averages I am presenting here."
  },
  {
    "objectID": "assets/archived_md/index.html#conclusions",
    "href": "assets/archived_md/index.html#conclusions",
    "title": "Fair-Weather Fans?",
    "section": "Conclusions",
    "text": "Conclusions\n\nTeams can typically expect to lose 12 to 15% of their attendance after relegation\nIf you are on track for Promotion, these losses are lessened\nIf you are on track to stay in the Championship, these losses are slightly higher\nAnd if you are on track for League 1, these losses are considerably higher\nInvestigating the outliers in the dataset tends to reveal mitigating circumstances. Often these relate to stadium builds, but in other cases - like Newcastle and Burnley - it is just vibes at play. To really understand the data I would dig into each relegated team a little more to understand what underlying factors affect other teams because it’s possibly more nuanced than relegation = fanbandonment.\n\n\nThumbnail image courtesy of Jaroslav A. Polák from Brno, Czech Republic, CC0, via Wikimedia Commons"
  },
  {
    "objectID": "assets/scripts/tidy_attendance.html",
    "href": "assets/scripts/tidy_attendance.html",
    "title": "Diggy Digs Data",
    "section": "",
    "text": "import pandas as pd\nimport numpy as np\n# Make sure you have this installed in your environment: pip install thefuzz\nfrom thefuzz import process\n\n\n# --- 1. LOAD MESSY DATA ---\n# Path is relative from the 'posts' directory: up two levels (../../) then down.\ntry:\n    df_wide = pd.read_excel(\"../files/datasets/Relegation Attendance Churn_copy.xlsx\", sheet_name=0, header=0)\nexcept FileNotFoundError:\n    print(\"Error: '../files/datasets/Relegation Attendance Churn_copy.xlsx' not found. Using example data.\")\n    # Example data in case the file isn't found\n    df_wide = pd.DataFrame({\n        'Season': ['1992-93'], 'Relegated Team': ['Nottingham Forest'], 'Position': ['Last'],\n        'Year Before': ['1991-1992'], 'Year Before Div': ['PL'], 'Year Before Att': '23,721',\n        'Attendance': '21,910', 'Year After': ['1993-94'], 'Year After Division': ['Championship'],\n        'Attendance year after': '23,051', '2 years after': ['1994-95'], '2 Years After Div': ['PL'],\n        'Attendance 2 years after': '23,633'\n    })\n\n# --- Polished Cleaning ---\n# Find only the attendance columns first\nattendance_cols = [c for c in df_wide.columns if \"Attendance\" in c]\n\n# Now, loop *only* through that smaller list\nfor col in attendance_cols:\n    # Convert *just this column* to string before cleaning\n    df_wide[col] = df_wide[col].astype(str).str.replace(',', '').replace('COVID', pd.NA).replace('nan', pd.NA)\n    df_wide[col] = pd.to_numeric(df_wide[col], errors='coerce')\n# --- End Fix ---\n\nprint(\"Step 1: Messy data loaded and attendance columns cleaned.\")\n\nStep 1: Messy data loaded and attendance columns cleaned.\n\n\n\n# --- 2. LOAD HISTORY DATA FOR AUDIT ---\ntry:\n    # Load 'season' as string to be safe\n    df_history = pd.read_csv('../files/datasets/standings.csv', dtype={'season': str})\n\n    # --- Load patch file and combine ---\n    try:\n        df_patch = pd.read_csv('../files/datasets/standings24_25.csv', dtype={'season': str})\n        # Append patch data to history data\n        df_history = pd.concat([df_history, df_patch], ignore_index=True)\n        print(\"Step 2a: Loaded and applied 'standings24_25.csv'.\")\n    except FileNotFoundError:\n        print(\"Step 2a: 'standings24_25.csv' not found. Skipping patch.\")\n    # --- End new patch logic ---\n\n    print(\"Step 2b: Loaded historical data for auditing.\")\n\n    # Create the cleaned df_positions here for later use\n    df_positions = df_history.rename(columns={\n        'team_name': 'Team',\n        'season': 'Season',\n        'position': 'Position_History',\n        'played': 'Games_Played_History',\n        'wins': 'Wins_History',\n        'goals_for': 'Goals_For_History',\n        'goals_against': 'Goals_Against_History',\n        'points': 'Points_History',\n        'tier': 'Tier_History'\n    })[['Team', 'Season', 'Position_History', 'Games_Played_History', 'Wins_History',\n        'Goals_For_History', 'Goals_Against_History', 'Points_History', 'Tier_History']]\n\n    # Convert new history columns to numeric\n    numeric_cols = ['Position_History', 'Games_Played_History', 'Wins_History',\n                    'Goals_For_History', 'Goals_Against_History', 'Points_History', 'Tier_History']\n    for col in numeric_cols:\n        df_positions[col] = pd.to_numeric(df_positions[col], errors='coerce')\n\n    # --- 3. AUDIT TEAM NAMES (NOW WITH AUTO-MAPPING) ---\n    # We audit the RAW, DIRTY team names from df_wide\n    teams_in_wide_df = set(df_wide['Relegated Team'].astype(str).unique())\n    teams_in_history_df = set(df_positions['Team'].astype(str).unique())\n\n    unmatched_teams = teams_in_wide_df.difference(teams_in_history_df)\n\n    # Create an empty map to build automatically\n    auto_team_name_map = {}\n\n    if unmatched_teams:\n        print(\"--- AUDIT: TEAM NAME MISMATCHES FOUND ---\")\n        print(\"The following teams from your file do not match the history file.\")\n        print(\"Attempting to build an automatic mapping...\")\n\n        # Loop through each unique unmatched team and find the best match\n        for team in sorted(unmatched_teams):\n            # process.extractOne returns a tuple: (best_match, score)\n            suggestion = process.extractOne(team, teams_in_history_df)\n\n            # Auto-map spaces, asterisks, and high-confidence matches\n            if suggestion[1] &gt; 85:\n                print(f\"  - Auto-mapping: \\\"{team}\\\" -&gt; \\\"{suggestion[0]}\\\" (Score: {suggestion[1]})\")\n                auto_team_name_map[team] = suggestion[0]\n            else:\n                # Don't map low-confidence or junk data\n                if team not in ['nan', 'TEAM', 'Relegated Team']:\n                    print(\n                        f\"  - WARNING: \\\"{team}\\\" has no confident match. (Best: \\\"{suggestion[0]}\\\" at {suggestion[1]}%)\")\n                    print(f\"    -&gt; Please add a fix for \\\"{team}\\\" to 'manual_overrides_map' in Step 4.\")\n\n        print(\"---------------------------------------------\")\n    else:\n        print(\"--- AUDIT: TEAM NAMES OK ---\")\n        print(\"All team names in your file match the history file.\")\n\nexcept FileNotFoundError:\n    print(\"Error: '../files/datasets/standings.csv' not found. Skipping audit and enrichment.\")\n    # Create empty dataframes if file not found\n    df_positions = pd.DataFrame(columns=['Team', 'Season', 'Position_History', 'Games_Played_History',\n                                         'Wins_History', 'Goals_For_History', 'Goals_Against_History',\n                                         'Points_History', 'Tier_History'])\n    auto_team_name_map = {}\n\nStep 2a: Loaded and applied 'standings24_25.csv'.\nStep 2b: Loaded historical data for auditing.\n--- AUDIT: TEAM NAME MISMATCHES FOUND ---\nThe following teams from your file do not match the history file.\nAttempting to build an automatic mapping...\n  - Auto-mapping: \" Aston Villa\" -&gt; \"Aston Villa\" (Score: 100)\n  - Auto-mapping: \" Barnsley\" -&gt; \"Barnsley\" (Score: 100)\n  - Auto-mapping: \" Birmingham City\" -&gt; \"Birmingham City\" (Score: 100)\n  - Auto-mapping: \" Blackburn Rovers\" -&gt; \"Blackburn Rovers\" (Score: 100)\n  - Auto-mapping: \" Blackpool\" -&gt; \"Blackpool\" (Score: 100)\n  - Auto-mapping: \" Bolton Wanderers\" -&gt; \"Bolton Wanderers\" (Score: 100)\n  - Auto-mapping: \" Bournemouth\" -&gt; \"Bournemouth\" (Score: 100)\n  - Auto-mapping: \" Bradford City\" -&gt; \"Bradford City\" (Score: 100)\n  - Auto-mapping: \" Burnley\" -&gt; \"Burnley\" (Score: 100)\n  - Auto-mapping: \" Cardiff City\" -&gt; \"Cardiff City\" (Score: 100)\n  - Auto-mapping: \" Charlton Athletic\" -&gt; \"Charlton Athletic\" (Score: 100)\n  - Auto-mapping: \" Coventry City\" -&gt; \"Coventry City\" (Score: 100)\n  - Auto-mapping: \" Crystal Palace\" -&gt; \"Crystal Palace\" (Score: 100)\n  - Auto-mapping: \" Derby County\" -&gt; \"Derby County\" (Score: 100)\n  - Auto-mapping: \" Fulham\" -&gt; \"Fulham\" (Score: 100)\n  - Auto-mapping: \" Fulham*\" -&gt; \"Fulham\" (Score: 100)\n  - Auto-mapping: \" Huddersfield Town\" -&gt; \"Huddersfield Town\" (Score: 100)\n  - Auto-mapping: \" Hull City\" -&gt; \"Hull City\" (Score: 100)\n  - Auto-mapping: \" Ipswich Town\" -&gt; \"Ipswich Town\" (Score: 100)\n  - Auto-mapping: \" Leeds United\" -&gt; \"Leeds United\" (Score: 100)\n  - Auto-mapping: \" Leicester City\" -&gt; \"Leicester City\" (Score: 100)\n  - Auto-mapping: \" Luton Town\" -&gt; \"Luton Town\" (Score: 100)\n  - Auto-mapping: \" Manchester City\" -&gt; \"Manchester City\" (Score: 100)\n  - Auto-mapping: \" Middlesbrough\" -&gt; \"Middlesbrough\" (Score: 100)\n  - Auto-mapping: \" Newcastle United\" -&gt; \"Newcastle United\" (Score: 100)\n  - Auto-mapping: \" Norwich City\" -&gt; \"Norwich City\" (Score: 100)\n  - Auto-mapping: \" Nottingham Forest\" -&gt; \"Nottingham Forest\" (Score: 100)\n  - Auto-mapping: \" Oldham Athletic\" -&gt; \"Oldham Athletic\" (Score: 100)\n  - Auto-mapping: \" Portsmouth\" -&gt; \"Portsmouth\" (Score: 100)\n  - Auto-mapping: \" Queens Park Rangers\" -&gt; \"Queens Park Rangers\" (Score: 100)\n  - Auto-mapping: \" Reading\" -&gt; \"Reading\" (Score: 100)\n  - Auto-mapping: \" Sheffield United\" -&gt; \"Sheffield United\" (Score: 100)\n  - Auto-mapping: \" Sheffield United*\" -&gt; \"Sheffield United\" (Score: 100)\n  - Auto-mapping: \" Sheffield Wednesday\" -&gt; \"Sheffield Wednesday\" (Score: 100)\n  - Auto-mapping: \" Southampton\" -&gt; \"Southampton\" (Score: 100)\n  - Auto-mapping: \" Stoke City\" -&gt; \"Stoke City\" (Score: 100)\n  - Auto-mapping: \" Sunderland\" -&gt; \"Sunderland\" (Score: 100)\n  - Auto-mapping: \" Swansea City\" -&gt; \"Swansea City\" (Score: 100)\n  - Auto-mapping: \" Swindon Town\" -&gt; \"Swindon Town\" (Score: 100)\n  - Auto-mapping: \" Watford\" -&gt; \"Watford\" (Score: 100)\n  - Auto-mapping: \" West Bromwich Albion\" -&gt; \"West Bromwich Albion\" (Score: 100)\n  - Auto-mapping: \" West Bromwich Albion*\" -&gt; \"West Bromwich Albion\" (Score: 100)\n  - Auto-mapping: \" West Ham United\" -&gt; \"West Ham United\" (Score: 100)\n  - Auto-mapping: \" Wigan Athletic\" -&gt; \"Wigan Athletic\" (Score: 100)\n  - Auto-mapping: \" Wimbledon\" -&gt; \"Wimbledon\" (Score: 100)\n  - Auto-mapping: \" Wolverhampton Wanderers\" -&gt; \"Wolverhampton Wanderers\" (Score: 100)\n---------------------------------------------\n\n\n\n# --- 4. STANDARDIZE TEAM NAMES (THE FIX) ---\n# Manual overrides for tricky names the fuzzy match might get wrong\n# or for low-confidence matches found in the audit.\nmanual_overrides_map = {\n    \"Man Utd\": \"Manchester United\",\n    \"Man City\": \"Manchester City\",\n    \"Spurs\": \"Tottenham Hotspur\",\n    \"QPR\": \"Queens Park Rangers\",\n    \"Wolves\": \"Wolverhampton Wanderers\",\n    \"Sheff Utd\": \"Sheffield United\",\n    \"Sheff Wed\": \"Sheffield Wednesday\",\n    \"Nott'm Forest\": \"Nottingham Forest\",\n    \"Notts County\": \"Nottingham Forest\"\n    # e.g., if audit warns about \"Bradford\", add:\n    # \"Bradford\": \"Bradford City\",\n}\n\n# Combine the auto-generated map with the manual overrides\n# This is where we combine the two dictionaries.\n# The 'manual_overrides_map' will overwrite any conflicting keys from 'auto_team_name_map'.\nfinal_team_map = {**auto_team_name_map, **manual_overrides_map}\n\ndf_wide['Relegated Team'] = df_wide['Relegated Team'].replace(final_team_map)\nprint(\"Step 4: Standardized 'Relegated Team' names using auto-mapping and manual overrides.\")\n\nStep 4: Standardized 'Relegated Team' names using auto-mapping and manual overrides.\n\n\n\n# --- 4.5. FILTERING STEP ---\n# Now that names are mapped, we can filter out junk rows that didn't get mapped\nteams_in_history_df = set(df_positions['Team'].astype(str).unique())\ndf_wide = df_wide[df_wide['Relegated Team'].isin(teams_in_history_df)]\nprint(\"Step 4.5: Filtered out junk rows (e.g., 'nan', 'TEAM').\")\n\nStep 4.5: Filtered out junk rows (e.g., 'nan', 'TEAM').\n\n\n\n# --- 5. CREATE RELEGATION_EVENT_ID ---\n# Now uses the CLEANED and FILTERED team names\ndf_wide['Relegation_Event_ID'] = df_wide['Relegated Team'] + ' ' + df_wide['Season']\nprint(\"Step 5: Created 'Relegation_Event_ID'.\")\n\nStep 5: Created 'Relegation_Event_ID'.\n\n\n\n# --- Step 6: Tidying data safely ---\nprint(\"Step 6: Tidying data using robust pd.concat method...\")\n\ndef make_slice(df, team_col, season_col, att_col, year_vs):\n    slice_df = df.rename(columns={\n        team_col: \"Team\",\n        season_col: \"Season_tmp\",\n        att_col: \"Attendance_tmp\"\n    }).assign(Year_vs_Relegation=year_vs)\n\n    # Select and rename final columns\n    slice_df = slice_df[['Relegation_Event_ID', 'Team', 'Season_tmp', 'Attendance_tmp', 'Year_vs_Relegation']].copy()\n    slice_df.columns = ['Relegation_Event_ID', 'Team', 'Season', 'Attendance', 'Year_vs_Relegation']\n\n    return slice_df\n\n\n# Create slices\nslice_minus1 = make_slice(df_wide, \"Relegated Team\", \"Year Before\", \"Year Before Att\", -1)\nslice_0      = make_slice(df_wide, \"Relegated Team\", \"Season\", \"Attendance\", 0)\nslice_1      = make_slice(df_wide, \"Relegated Team\", \"Year After\", \"Attendance year after\", 1)\nslice_2      = make_slice(df_wide, \"Relegated Team\", \"2 years after\", \"Attendance 2 years after\", 2)\n\n# Concatenate slices safely\ndf_tidy = pd.concat([slice_minus1, slice_0, slice_1, slice_2], ignore_index=True)\n\nprint(\"Step 6: Data has been 'tidied' successfully!\")\nprint(df_tidy.head())\n\nStep 6: Tidying data using robust pd.concat method...\nStep 6: Data has been 'tidied' successfully!\n         Relegation_Event_ID               Team     Season Attendance  \\\n0  Nottingham Forest 1992-93  Nottingham Forest  1991-1992      23721   \n1     Crystal Palace 1992-93     Crystal Palace  1991-1992      17618   \n2      Middlesbrough 1992-93      Middlesbrough  1991-1992      14703   \n3   Sheffield United 1993-94   Sheffield United  1992-1993      18801   \n4    Oldham Athletic 1993-94    Oldham Athletic  1992-1993      12859   \n\n   Year_vs_Relegation  \n0                  -1  \n1                  -1  \n2                  -1  \n3                  -1  \n4                  -1  \n\n\n\ndupes = df_wide.columns[df_wide.columns.duplicated()]\nprint(\"Duplicate columns:\", dupes)\n\nDuplicate columns: Index([], dtype='object')\n\n\n\n# --- 7. STANDARDIZE JOIN KEY (SEASON) ---\ndef format_season(season_str):\n    \"\"\"Converts '1991-1992' to '1991-92' and leaves '1992-93' as is.\"\"\"\n    if pd.isna(season_str):\n        return pd.NA\n    parts = str(season_str).split('-')\n    if len(parts) == 2:\n        if len(parts[1]) == 4:  # Format is '1991-1992'\n            return f\"{parts[0]}-{parts[1][-2:]}\"\n        else:  # Format is '1992-93'\n            return season_str\n    return season_str  # Return as-is if not in expected format\n\n\ndf_tidy['Season'] = df_tidy['Season'].apply(format_season)\nprint(\"Step 7: Standardized 'Season' key to 'YYYY-YY' format (e.g., '1992-93').\")\n\nStep 7: Standardized 'Season' key to 'YYYY-YY' format (e.g., '1992-93').\n\n\n\n# --- 8. ENRICH WITH POSITION DATA ---\nif not df_positions.empty:\n\n    # --- Upgrade the history file's 'Season' column ---\n    # Convert 'Season' (e.g., '1992') to 'YYYY-YY' format (e.g., '1992-93')\n    season_numeric = pd.to_numeric(df_positions['Season'], errors='coerce')\n    season_numeric = season_numeric.dropna()  # Drop rows where 'Season' wasn't a number\n    # Format the end year (e.g., 93, 00)\n    season_end_year = (season_numeric + 1).astype(int).astype(str).str.zfill(4).str[-2:]\n    df_positions.loc[season_numeric.index, 'Season'] = season_numeric.astype(int).astype(str) + '-' + season_end_year\n\n    # --- Calculate Per-Game metrics using the 'played' column ---\n    # This is the correct way, using the actual 'played' column\n    df_positions['Goals_For_Per_Game'] = df_positions['Goals_For_History'] / df_positions['Games_Played_History']\n    df_positions['Goals_Against_Per_Game'] = df_positions['Goals_Against_History'] / df_positions[\n        'Games_Played_History']\n    df_positions['Points_Per_Game'] = df_positions['Points_History'] / df_positions['Games_Played_History']\n    df_positions['Win_Percentage'] = df_positions['Wins_History'] / df_positions['Games_Played_History']\n\n    # Select all historical columns we need for the merge\n    df_positions_merge = df_positions[['Team', 'Season', 'Position_History', 'Tier_History',\n                                       'Goals_For_Per_Game', 'Goals_Against_Per_Game',\n                                       'Points_Per_Game', 'Win_Percentage']]\n\n    print(\"Step 8a: Upgraded history file 'Season' key and calculated Per-Game metrics.\")\n\n    # --- Merge the data ---\n    print(\"Step 8b: Merging tidy data with position data...\")\n    df_final = pd.merge(\n        df_tidy,\n        df_positions_merge,  # Use the merge-ready dataframe\n        on=['Team', 'Season'],\n        how='left'\n    )\n\n    # --- Use 'Position_History' as the *only* source for 'Position' ---\n    df_final['Position'] = df_final['Position_History']\n\n    # Carry the new metrics into the main column structure\n    df_final['Tier'] = df_final['Tier_History']\n\nelse:\n    print(\"Step 8: Skipping merge as 'standings.csv' was not loaded.\")\n    df_final = df_tidy\n    df_final['Position'] = pd.NA  # Ensure column exists\n    # Ensure all columns exist even if merge skipped\n    df_final['Tier'] = pd.NA\n    df_final['Goals_For_Per_Game'] = pd.NA\n    df_final['Goals_Against_Per_Game'] = pd.NA\n    df_final['Points_Per_Game'] = pd.NA\n    df_final['Win_Percentage'] = pd.NA\n\nStep 8a: Upgraded history file 'Season' key and calculated Per-Game metrics.\nStep 8b: Merging tidy data with position data...\n\n\n\n# --- 9. FINAL POLISH AND SAVE ---\n# This is the full list of columns for your \"smart\" dataset\nfinal_columns = [\n    'Relegation_Event_ID', 'Team', 'Season', 'Tier',\n    'Position', 'Attendance', 'Goals_For_Per_Game', 'Goals_Against_Per_Game',\n    'Points_Per_Game', 'Win_Percentage', 'Year_vs_Relegation'\n]\n\n# Ensure final columns exist before slicing (drops the temporary *_History columns)\nfor col in final_columns:\n    if col not in df_final.columns:\n        df_final[col] = pd.NA\n\n# Attendance should be a nullable integer (Int64)\ndf_final['Attendance'] = pd.to_numeric(df_final['Attendance'], errors='coerce').astype('Int64')\ndf_final = df_final[final_columns].sort_values(by=['Relegation_Event_ID', 'Year_vs_Relegation'])\n\n# Save the final, perfect data to a new CSV in the 'datasets' folder\noutput_path = \"../files/datasets/perfect_tidy_data.csv\"\ndf_final.to_csv(output_path, index=False)\nimport os\nprint(\"Current working directory:\", os.getcwd())\nprint(\"Saving file to:\", os.path.abspath(output_path))\nprint(f\"Step 9: Success! Final table saved to '{output_path}'\")\n\nCurrent working directory: c:\\Users\\eoind\\Documents\\Projects\\diggydigsdata.github.io\\assets\\scripts\nSaving file to: c:\\Users\\eoind\\Documents\\Projects\\diggydigsdata.github.io\\assets\\files\\datasets\\perfect_tidy_data.csv\nStep 9: Success! Final table saved to '../files/datasets/perfect_tidy_data.csv'\n\n\n\n# --- 10. DISPLAY THE FINAL RESULT ---\nprint(\"\\n--- FINAL ENRICHED DATA TABLE ---\")\nprint(df_final.to_markdown(index=False))\n\n\n--- FINAL ENRICHED DATA TABLE ---\n| Relegation_Event_ID             | Team                    | Season   |   Tier |   Position | Attendance   |   Goals_For_Per_Game |   Goals_Against_Per_Game |   Points_Per_Game |   Win_Percentage |   Year_vs_Relegation |\n|:--------------------------------|:------------------------|:---------|-------:|-----------:|:-------------|---------------------:|-------------------------:|------------------:|-----------------:|---------------------:|\n| Aston Villa 2015-16             | Aston Villa             | 2014-15  |      1 |         17 | 34133        |             0.815789 |                 1.5      |          1        |        0.263158  |                   -1 |\n| Aston Villa 2015-16             | Aston Villa             | 2015-16  |      1 |         20 | 33690        |             0.710526 |                 2        |          0.447368 |        0.0789474 |                    0 |\n| Aston Villa 2015-16             | Aston Villa             | 2016-17  |      2 |         13 | 32107        |             1.02174  |                 1.04348  |          1.34783  |        0.347826  |                    1 |\n| Aston Villa 2015-16             | Aston Villa             | 2017-18  |      2 |          4 | 32097        |             1.56522  |                 0.913043 |          1.80435  |        0.521739  |                    2 |\n| Barnsley 1997-98                | Barnsley                | 1996-97  |      2 |          2 | 11356        |             1.65217  |                 1.19565  |          1.73913  |        0.478261  |                   -1 |\n| Barnsley 1997-98                | Barnsley                | 1997-98  |      1 |         19 | 18449        |             0.973684 |                 2.15789  |          0.921053 |        0.263158  |                    0 |\n| Barnsley 1997-98                | Barnsley                | 1998-99  |      2 |         13 | 16269        |             1.28261  |                 1.21739  |          1.28261  |        0.304348  |                    1 |\n| Barnsley 1997-98                | Barnsley                | 1999-00  |      2 |          4 | 15412        |             1.91304  |                 1.45652  |          1.78261  |        0.521739  |                    2 |\n| Birmingham City 2005-06         | Birmingham City         | 2004-05  |      1 |         12 | 28760        |             1.05263  |                 1.21053  |          1.18421  |        0.289474  |                   -1 |\n| Birmingham City 2005-06         | Birmingham City         | 2005-06  |      1 |         18 | 27392        |             0.736842 |                 1.31579  |          0.894737 |        0.210526  |                    0 |\n| Birmingham City 2005-06         | Birmingham City         | 2006-07  |      2 |          2 | 22274        |             1.45652  |                 0.913043 |          1.86957  |        0.565217  |                    1 |\n| Birmingham City 2005-06         | Birmingham City         | 2007-08  |      1 |         19 | 26181        |             1.21053  |                 1.63158  |          0.921053 |        0.210526  |                    2 |\n| Birmingham City 2007-08         | Birmingham City         | 2006-07  |      2 |          2 | 22274        |             1.45652  |                 0.913043 |          1.86957  |        0.565217  |                   -1 |\n| Birmingham City 2007-08         | Birmingham City         | 2007-08  |      1 |         19 | 26181        |             1.21053  |                 1.63158  |          0.921053 |        0.210526  |                    0 |\n| Birmingham City 2007-08         | Birmingham City         | 2008-09  |      2 |          2 | 19081        |             1.17391  |                 0.804348 |          1.80435  |        0.5       |                    1 |\n| Birmingham City 2007-08         | Birmingham City         | 2009-10  |      1 |          9 | 25246        |             1        |                 1.23684  |          1.31579  |        0.342105  |                    2 |\n| Birmingham City 2010-11         | Birmingham City         | 2009-10  |      1 |          9 | 25246        |             1        |                 1.23684  |          1.31579  |        0.342105  |                   -1 |\n| Birmingham City 2010-11         | Birmingham City         | 2010-11  |      1 |         18 | 25462        |             0.973684 |                 1.52632  |          1.02632  |        0.210526  |                    0 |\n| Birmingham City 2010-11         | Birmingham City         | 2011-12  |      2 |          4 | 19127        |             1.69565  |                 1.1087   |          1.65217  |        0.434783  |                    1 |\n| Birmingham City 2010-11         | Birmingham City         | 2012-13  |      2 |         12 | 16703        |             1.36957  |                 1.5      |          1.32609  |        0.326087  |                    2 |\n| Blackburn Rovers 1998-99        | Blackburn Rovers        | 1997-98  |      1 |          6 | 25253        |             1.5      |                 1.36842  |          1.52632  |        0.421053  |                   -1 |\n| Blackburn Rovers 1998-99        | Blackburn Rovers        | 1998-99  |      1 |         19 | 25773        |             1        |                 1.36842  |          0.921053 |        0.184211  |                    0 |\n| Blackburn Rovers 1998-99        | Blackburn Rovers        | 1999-00  |      2 |         11 | 19253        |             1.19565  |                 1.1087   |          1.34783  |        0.326087  |                    1 |\n| Blackburn Rovers 1998-99        | Blackburn Rovers        | 2000-01  |      2 |          2 | 20740        |             1.65217  |                 0.847826 |          1.97826  |        0.565217  |                    2 |\n| Blackburn Rovers 2011-12        | Blackburn Rovers        | 2010-11  |      1 |         15 | 25000        |             1.21053  |                 1.55263  |          1.13158  |        0.289474  |                   -1 |\n| Blackburn Rovers 2011-12        | Blackburn Rovers        | 2011-12  |      1 |         19 | 22551        |             1.26316  |                 2.05263  |          0.815789 |        0.210526  |                    0 |\n| Blackburn Rovers 2011-12        | Blackburn Rovers        | 2012-13  |      2 |         17 | 14997        |             1.19565  |                 1.34783  |          1.26087  |        0.304348  |                    1 |\n| Blackburn Rovers 2011-12        | Blackburn Rovers        | 2013-14  |      2 |          8 | 14962        |             1.52174  |                 1.34783  |          1.52174  |        0.391304  |                    2 |\n| Blackpool 2010-11               | Blackpool               | 2009-10  |      2 |          6 | 8611         |             1.6087   |                 1.26087  |          1.52174  |        0.413043  |                   -1 |\n| Blackpool 2010-11               | Blackpool               | 2010-11  |      1 |         19 | 15780        |             1.44737  |                 2.05263  |          1.02632  |        0.263158  |                    0 |\n| Blackpool 2010-11               | Blackpool               | 2011-12  |      2 |          5 | 12764        |             1.71739  |                 1.28261  |          1.63043  |        0.434783  |                    1 |\n| Blackpool 2010-11               | Blackpool               | 2012-13  |      2 |         15 | 13917        |             1.34783  |                 1.36957  |          1.28261  |        0.304348  |                    2 |\n| Bolton Wanderers 1995-96        | Bolton Wanderers        | 1994-95  |      2 |          3 | 13029        |             1.45652  |                 0.978261 |          1.67391  |        0.456522  |                   -1 |\n| Bolton Wanderers 1995-96        | Bolton Wanderers        | 1995-96  |      1 |         20 | 18822        |             1.02632  |                 1.86842  |          0.763158 |        0.210526  |                    0 |\n| Bolton Wanderers 1995-96        | Bolton Wanderers        | 1996-97  |      2 |          1 | 15826        |             2.17391  |                 1.15217  |          2.13043  |        0.608696  |                    1 |\n| Bolton Wanderers 1995-96        | Bolton Wanderers        | 1997-98  |      1 |         18 | 24352        |             1.07895  |                 1.60526  |          1.05263  |        0.236842  |                    2 |\n| Bolton Wanderers 1997-98        | Bolton Wanderers        | 1996-97  |      2 |          1 | 15826        |             2.17391  |                 1.15217  |          2.13043  |        0.608696  |                   -1 |\n| Bolton Wanderers 1997-98        | Bolton Wanderers        | 1997-98  |      1 |         18 | 24352        |             1.07895  |                 1.60526  |          1.05263  |        0.236842  |                    0 |\n| Bolton Wanderers 1997-98        | Bolton Wanderers        | 1998-99  |      2 |          6 | 18196        |             1.69565  |                 1.28261  |          1.65217  |        0.434783  |                    1 |\n| Bolton Wanderers 1997-98        | Bolton Wanderers        | 1999-00  |      2 |          6 | 14297        |             1.5      |                 1.08696  |          1.65217  |        0.456522  |                    2 |\n| Bolton Wanderers 2011-12        | Bolton Wanderers        | 2010-11  |      1 |         14 | 22870        |             1.36842  |                 1.47368  |          1.21053  |        0.315789  |                   -1 |\n| Bolton Wanderers 2011-12        | Bolton Wanderers        | 2011-12  |      1 |         18 | 23670        |             1.21053  |                 2.02632  |          0.947368 |        0.263158  |                    0 |\n| Bolton Wanderers 2011-12        | Bolton Wanderers        | 2012-13  |      2 |          7 | 18034        |             1.5      |                 1.32609  |          1.47826  |        0.391304  |                    1 |\n| Bolton Wanderers 2011-12        | Bolton Wanderers        | 2013-14  |      2 |         14 | 16141        |             1.28261  |                 1.30435  |          1.28261  |        0.304348  |                    2 |\n| Bournemouth 2019-20             | Bournemouth             | 2018-19  |      1 |         14 | 10532        |             1.47368  |                 1.84211  |          1.18421  |        0.342105  |                   -1 |\n| Bournemouth 2019-20             | Bournemouth             | 2019-20  |      1 |         18 | 10510        |             1.05263  |                 1.71053  |          0.894737 |        0.236842  |                    0 |\n| Bournemouth 2019-20             | Bournemouth             | 2020-21  |      2 |          6 | &lt;NA&gt;         |             1.58696  |                 1        |          1.67391  |        0.478261  |                    1 |\n| Bournemouth 2019-20             | Bournemouth             | 2021-22  |      2 |          2 | 9588         |             1.6087   |                 0.847826 |          1.91304  |        0.543478  |                    2 |\n| Bradford City 2000-01           | Bradford City           | 1999-00  |      1 |         17 | 18030        |             1        |                 1.78947  |          0.947368 |        0.236842  |                   -1 |\n| Bradford City 2000-01           | Bradford City           | 2000-01  |      1 |         20 | 18511        |             0.789474 |                 1.84211  |          0.684211 |        0.131579  |                    0 |\n| Bradford City 2000-01           | Bradford City           | 2001-02  |      2 |         15 | 15489        |             1.5      |                 1.65217  |          1.19565  |        0.326087  |                    1 |\n| Bradford City 2000-01           | Bradford City           | 2002-03  |      2 |         19 | 12501        |             1.1087   |                 1.58696  |          1.13043  |        0.304348  |                    2 |\n| Burnley 2009-10                 | Burnley                 | 2008-09  |      2 |          5 | 13082        |             1.56522  |                 1.30435  |          1.65217  |        0.456522  |                   -1 |\n| Burnley 2009-10                 | Burnley                 | 2009-10  |      1 |         18 | 20654        |             1.10526  |                 2.15789  |          0.789474 |        0.210526  |                    0 |\n| Burnley 2009-10                 | Burnley                 | 2010-11  |      2 |          8 | 14931        |             1.41304  |                 1.32609  |          1.47826  |        0.391304  |                    1 |\n| Burnley 2009-10                 | Burnley                 | 2011-12  |      2 |         13 | 14048        |             1.32609  |                 1.26087  |          1.34783  |        0.369565  |                    2 |\n| Burnley 2014-15                 | Burnley                 | 2013-14  |      2 |          2 | 13719        |             1.56522  |                 0.804348 |          2.02174  |        0.565217  |                   -1 |\n| Burnley 2014-15                 | Burnley                 | 2014-15  |      1 |         19 | 19131        |             0.736842 |                 1.39474  |          0.868421 |        0.184211  |                    0 |\n| Burnley 2014-15                 | Burnley                 | 2015-16  |      2 |          1 | 16823        |             1.56522  |                 0.76087  |          2.02174  |        0.565217  |                    1 |\n| Burnley 2014-15                 | Burnley                 | 2016-17  |      1 |         16 | 20558        |             1.02632  |                 1.44737  |          1.05263  |        0.289474  |                    2 |\n| Burnley 2021-22                 | Burnley                 | 2020-21  |      1 |         17 | &lt;NA&gt;         |             0.868421 |                 1.44737  |          1.02632  |        0.263158  |                   -1 |\n| Burnley 2021-22                 | Burnley                 | 2021-22  |      1 |         18 | 19399        |             0.894737 |                 1.39474  |          0.921053 |        0.184211  |                    0 |\n| Burnley 2021-22                 | Burnley                 | 2022-23  |      2 |          1 | 19953        |             1.8913   |                 0.76087  |          2.19565  |        0.630435  |                    1 |\n| Burnley 2021-22                 | Burnley                 | 2023-24  |      1 |         19 | 21184        |             1.07895  |                 2.05263  |          0.631579 |        0.131579  |                    2 |\n| Burnley 2023-24                 | Burnley                 | 2022-23  |      2 |          1 | 19953        |             1.8913   |                 0.76087  |          2.19565  |        0.630435  |                   -1 |\n| Burnley 2023-24                 | Burnley                 | 2023-24  |      1 |         19 | 21184        |             1.07895  |                 2.05263  |          0.631579 |        0.131579  |                    0 |\n| Burnley 2023-24                 | Burnley                 | 2024-25  |      2 |          2 | 19639        |             1.5      |                 0.347826 |          2.17391  |        0.608696  |                    1 |\n| Burnley 2023-24                 | Burnley                 | 2025-26  |    nan |        nan | 21524        |           nan        |               nan        |        nan        |      nan         |                    2 |\n| Cardiff City 2013-14            | Cardiff City            | 2012-13  |      2 |          1 | 22999        |             1.56522  |                 0.978261 |          1.8913   |        0.543478  |                   -1 |\n| Cardiff City 2013-14            | Cardiff City            | 2013-14  |      1 |         20 | 27430        |             0.842105 |                 1.94737  |          0.789474 |        0.184211  |                    0 |\n| Cardiff City 2013-14            | Cardiff City            | 2014-15  |      2 |         11 | 21124        |             1.23913  |                 1.32609  |          1.34783  |        0.347826  |                    1 |\n| Cardiff City 2013-14            | Cardiff City            | 2015-16  |      2 |          8 | 16463        |             1.21739  |                 1.1087   |          1.47826  |        0.369565  |                    2 |\n| Cardiff City 2018-19            | Cardiff City            | 2017-18  |      2 |          2 | 20164        |             1.5      |                 0.847826 |          1.95652  |        0.586957  |                   -1 |\n| Cardiff City 2018-19            | Cardiff City            | 2018-19  |      1 |         18 | 31408        |             0.894737 |                 1.81579  |          0.894737 |        0.263158  |                    0 |\n| Cardiff City 2018-19            | Cardiff City            | 2019-20  |      2 |          5 | 22822        |             1.47826  |                 1.26087  |          1.58696  |        0.413043  |                    1 |\n| Cardiff City 2018-19            | Cardiff City            | 2020-21  |      2 |          8 | &lt;NA&gt;         |             1.43478  |                 1.06522  |          1.47826  |        0.391304  |                    2 |\n| Charlton Athletic 1998-99       | Charlton Athletic       | 1997-98  |      2 |          4 | 13275        |             1.73913  |                 1.06522  |          1.91304  |        0.565217  |                   -1 |\n| Charlton Athletic 1998-99       | Charlton Athletic       | 1998-99  |      1 |         18 | 19816        |             1.07895  |                 1.47368  |          0.947368 |        0.210526  |                    0 |\n| Charlton Athletic 1998-99       | Charlton Athletic       | 1999-00  |      2 |          1 | 19558        |             1.71739  |                 0.978261 |          1.97826  |        0.586957  |                    1 |\n| Charlton Athletic 1998-99       | Charlton Athletic       | 2000-01  |      1 |          9 | 20023        |             1.31579  |                 1.5      |          1.36842  |        0.368421  |                    2 |\n| Charlton Athletic 2006-07       | Charlton Athletic       | 2005-06  |      1 |         13 | 26196        |             1.07895  |                 1.44737  |          1.23684  |        0.342105  |                   -1 |\n| Charlton Athletic 2006-07       | Charlton Athletic       | 2006-07  |      1 |         19 | 26195        |             0.894737 |                 1.57895  |          0.894737 |        0.210526  |                    0 |\n| Charlton Athletic 2006-07       | Charlton Athletic       | 2007-08  |      2 |         11 | 23159        |             1.36957  |                 1.26087  |          1.3913   |        0.369565  |                    1 |\n| Charlton Athletic 2006-07       | Charlton Athletic       | 2008-09  |      2 |         24 | 20894        |             1.13043  |                 1.6087   |          0.847826 |        0.173913  |                    2 |\n| Coventry City 2000-01           | Coventry City           | 1999-00  |      1 |         14 | 20809        |             1.23684  |                 1.42105  |          1.15789  |        0.315789  |                   -1 |\n| Coventry City 2000-01           | Coventry City           | 2000-01  |      1 |         19 | 20582        |             0.947368 |                 1.65789  |          0.894737 |        0.210526  |                    0 |\n| Coventry City 2000-01           | Coventry City           | 2001-02  |      2 |         11 | 16150        |             1.28261  |                 1.15217  |          1.43478  |        0.434783  |                    1 |\n| Coventry City 2000-01           | Coventry City           | 2002-03  |      2 |         20 | 14813        |             1        |                 1.34783  |          1.08696  |        0.26087   |                    2 |\n| Crystal Palace 1992-93          | Crystal Palace          | 1991-92  |      1 |         10 | 17618        |             1.2619   |                 1.45238  |          1.35714  |        0.333333  |                   -1 |\n| Crystal Palace 1992-93          | Crystal Palace          | 1992-93  |      1 |         20 | 15748        |             1.14286  |                 1.45238  |          1.16667  |        0.261905  |                    0 |\n| Crystal Palace 1992-93          | Crystal Palace          | 1993-94  |      2 |          1 | 15365        |             1.58696  |                 1        |          1.95652  |        0.586957  |                    1 |\n| Crystal Palace 1992-93          | Crystal Palace          | 1994-95  |      1 |         19 | 14992        |             0.809524 |                 1.16667  |          1.07143  |        0.261905  |                    2 |\n| Crystal Palace 1994-95          | Crystal Palace          | 1993-94  |      2 |          1 | 15365        |             1.58696  |                 1        |          1.95652  |        0.586957  |                   -1 |\n| Crystal Palace 1994-95          | Crystal Palace          | 1994-95  |      1 |         19 | 14992        |             0.809524 |                 1.16667  |          1.07143  |        0.261905  |                    0 |\n| Crystal Palace 1994-95          | Crystal Palace          | 1995-96  |      2 |          3 | 15248        |             1.45652  |                 1.04348  |          1.63043  |        0.434783  |                    1 |\n| Crystal Palace 1994-95          | Crystal Palace          | 1996-97  |      2 |          6 | 16085        |             1.69565  |                 1.04348  |          1.54348  |        0.413043  |                    2 |\n| Crystal Palace 1997-98          | Crystal Palace          | 1996-97  |      2 |          6 | 16085        |             1.69565  |                 1.04348  |          1.54348  |        0.413043  |                   -1 |\n| Crystal Palace 1997-98          | Crystal Palace          | 1997-98  |      1 |         20 | 21983        |             0.973684 |                 1.86842  |          0.868421 |        0.210526  |                    0 |\n| Crystal Palace 1997-98          | Crystal Palace          | 1998-99  |      2 |         14 | 17123        |             1.26087  |                 1.54348  |          1.26087  |        0.304348  |                    1 |\n| Crystal Palace 1997-98          | Crystal Palace          | 1999-00  |      2 |         15 | 15662        |             1.23913  |                 1.45652  |          1.17391  |        0.282609  |                    2 |\n| Crystal Palace 2004-05          | Crystal Palace          | 2003-04  |      2 |          6 | 17344        |             1.56522  |                 1.32609  |          1.58696  |        0.456522  |                   -1 |\n| Crystal Palace 2004-05          | Crystal Palace          | 2004-05  |      1 |         18 | 24108        |             1.07895  |                 1.63158  |          0.868421 |        0.184211  |                    0 |\n| Crystal Palace 2004-05          | Crystal Palace          | 2005-06  |      2 |          6 | 19457        |             1.45652  |                 1.04348  |          1.63043  |        0.456522  |                    1 |\n| Crystal Palace 2004-05          | Crystal Palace          | 2006-07  |      2 |         12 | 17541        |             1.28261  |                 1.1087   |          1.41304  |        0.391304  |                    2 |\n| Derby County 2001-02            | Derby County            | 2000-01  |      1 |         17 | 28551        |             0.973684 |                 1.55263  |          1.10526  |        0.263158  |                   -1 |\n| Derby County 2001-02            | Derby County            | 2001-02  |      1 |         19 | 29816        |             0.868421 |                 1.65789  |          0.789474 |        0.210526  |                    0 |\n| Derby County 2001-02            | Derby County            | 2002-03  |      2 |         18 | 25470        |             1.19565  |                 1.6087   |          1.13043  |        0.326087  |                    1 |\n| Derby County 2001-02            | Derby County            | 2003-04  |      2 |         20 | 22200        |             1.15217  |                 1.45652  |          1.13043  |        0.282609  |                    2 |\n| Derby County 2007-08            | Derby County            | 2006-07  |      2 |          3 | 25945        |             1.34783  |                 1        |          1.82609  |        0.543478  |                   -1 |\n| Derby County 2007-08            | Derby County            | 2007-08  |      1 |         20 | 32432        |             0.526316 |                 2.34211  |          0.289474 |        0.0263158 |                    0 |\n| Derby County 2007-08            | Derby County            | 2008-09  |      2 |         18 | 29440        |             1.19565  |                 1.45652  |          1.17391  |        0.304348  |                    1 |\n| Derby County 2007-08            | Derby County            | 2009-10  |      2 |         14 | 29230        |             1.15217  |                 1.36957  |          1.21739  |        0.326087  |                    2 |\n| Fulham 2013-14                  | Fulham                  | 2012-13  |      1 |         12 | 25394        |             1.31579  |                 1.57895  |          1.13158  |        0.289474  |                   -1 |\n| Fulham 2013-14                  | Fulham                  | 2013-14  |      1 |         19 | 24977        |             1.05263  |                 2.23684  |          0.842105 |        0.236842  |                    0 |\n| Fulham 2013-14                  | Fulham                  | 2014-15  |      2 |         17 | 18276        |             1.34783  |                 1.80435  |          1.13043  |        0.304348  |                    1 |\n| Fulham 2013-14                  | Fulham                  | 2015-16  |      2 |         20 | 17566        |             1.43478  |                 1.71739  |          1.1087   |        0.26087   |                    2 |\n| Fulham 2018-19                  | Fulham                  | 2017-18  |      2 |          3 | 19896        |             1.71739  |                 1        |          1.91304  |        0.543478  |                   -1 |\n| Fulham 2018-19                  | Fulham                  | 2018-19  |      1 |         19 | 24371        |             0.894737 |                 2.13158  |          0.684211 |        0.184211  |                    0 |\n| Fulham 2018-19                  | Fulham                  | 2019-20  |      2 |          4 | 18204        |             1.3913   |                 1.04348  |          1.76087  |        0.5       |                    1 |\n| Fulham 2018-19                  | Fulham                  | 2020-21  |      1 |         18 | &lt;NA&gt;         |             0.710526 |                 1.39474  |          0.736842 |        0.131579  |                    2 |\n| Fulham 2020-21                  | Fulham                  | 2019-20  |      2 |          4 | 18204        |             1.3913   |                 1.04348  |          1.76087  |        0.5       |                   -1 |\n| Fulham 2020-21                  | Fulham                  | 2019-20  |      2 |          4 | 18204        |             1.3913   |                 1.04348  |          1.76087  |        0.5       |                   -1 |\n| Fulham 2020-21                  | Fulham                  | 2020-21  |      1 |         18 | &lt;NA&gt;         |             0.710526 |                 1.39474  |          0.736842 |        0.131579  |                    0 |\n| Fulham 2020-21                  | Fulham                  | 2020-21  |      1 |         18 | &lt;NA&gt;         |             0.710526 |                 1.39474  |          0.736842 |        0.131579  |                    0 |\n| Fulham 2020-21                  | Fulham                  | 2021-22  |      2 |          1 | 17774        |             2.30435  |                 0.934783 |          1.95652  |        0.586957  |                    1 |\n| Fulham 2020-21                  | Fulham                  | 2021-22  |      2 |          1 | 17774        |             2.30435  |                 0.934783 |          1.95652  |        0.586957  |                    1 |\n| Fulham 2020-21                  | Fulham                  | 2022-23  |      1 |         10 | 23746        |             1.44737  |                 1.39474  |          1.36842  |        0.394737  |                    2 |\n| Fulham 2020-21                  | Fulham                  | 2022-23  |      1 |         10 | 23746        |             1.44737  |                 1.39474  |          1.36842  |        0.394737  |                    2 |\n| Huddersfield Town 2018-19       | Huddersfield Town       | 2017-18  |      1 |         16 | 24028        |             0.736842 |                 1.52632  |          0.973684 |        0.236842  |                   -1 |\n| Huddersfield Town 2018-19       | Huddersfield Town       | 2018-19  |      1 |         20 | 23203        |             0.578947 |                 2        |          0.421053 |        0.0789474 |                    0 |\n| Huddersfield Town 2018-19       | Huddersfield Town       | 2019-20  |      2 |         18 | 21748        |             1.13043  |                 1.52174  |          1.1087   |        0.282609  |                    1 |\n| Huddersfield Town 2018-19       | Huddersfield Town       | 2020-21  |      2 |         20 | &lt;NA&gt;         |             1.08696  |                 1.54348  |          1.06522  |        0.26087   |                    2 |\n| Hull City 2009-10               | Hull City               | 2008-09  |      1 |         17 | 24816        |             1.02632  |                 1.68421  |          0.921053 |        0.210526  |                   -1 |\n| Hull City 2009-10               | Hull City               | 2009-10  |      1 |         19 | 24390        |             0.894737 |                 1.97368  |          0.789474 |        0.157895  |                    0 |\n| Hull City 2009-10               | Hull City               | 2010-11  |      2 |         11 | 21169        |             1.13043  |                 1.1087   |          1.41304  |        0.347826  |                    1 |\n| Hull City 2009-10               | Hull City               | 2011-12  |      2 |          8 | 18790        |             1.02174  |                 0.956522 |          1.47826  |        0.413043  |                    2 |\n| Hull City 2014-15               | Hull City               | 2013-14  |      1 |         16 | 24117        |             1        |                 1.39474  |          0.973684 |        0.263158  |                   -1 |\n| Hull City 2014-15               | Hull City               | 2014-15  |      1 |         18 | 23557        |             0.868421 |                 1.34211  |          0.921053 |        0.210526  |                    0 |\n| Hull City 2014-15               | Hull City               | 2015-16  |      2 |          4 | 17199        |             1.5      |                 0.76087  |          1.80435  |        0.521739  |                    1 |\n| Hull City 2014-15               | Hull City               | 2016-17  |      1 |         18 | 20761        |             0.973684 |                 2.10526  |          0.894737 |        0.236842  |                    2 |\n| Hull City 2016-17               | Hull City               | 2015-16  |      2 |          4 | 17199        |             1.5      |                 0.76087  |          1.80435  |        0.521739  |                   -1 |\n| Hull City 2016-17               | Hull City               | 2016-17  |      1 |         18 | 20761        |             0.973684 |                 2.10526  |          0.894737 |        0.236842  |                    0 |\n| Hull City 2016-17               | Hull City               | 2017-18  |      2 |         18 | 15622        |             1.52174  |                 1.52174  |          1.06522  |        0.23913   |                    1 |\n| Hull City 2016-17               | Hull City               | 2018-19  |      2 |         13 | 12165        |             1.43478  |                 1.47826  |          1.34783  |        0.369565  |                    2 |\n| Ipswich Town 1994-95            | Ipswich Town            | 1993-94  |      1 |         19 | 16382        |             0.833333 |                 1.38095  |          1.02381  |        0.214286  |                   -1 |\n| Ipswich Town 1994-95            | Ipswich Town            | 1994-95  |      1 |         22 | 16818        |             0.857143 |                 2.21429  |          0.642857 |        0.166667  |                    0 |\n| Ipswich Town 1994-95            | Ipswich Town            | 1995-96  |      2 |          7 | 12604        |             1.71739  |                 1.5      |          1.5      |        0.413043  |                    1 |\n| Ipswich Town 1994-95            | Ipswich Town            | 1996-97  |      2 |          4 | 11953        |             1.47826  |                 1.08696  |          1.6087   |        0.434783  |                    2 |\n| Ipswich Town 2001-02            | Ipswich Town            | 2000-01  |      1 |          5 | 22532        |             1.5      |                 1.10526  |          1.73684  |        0.526316  |                   -1 |\n| Ipswich Town 2001-02            | Ipswich Town            | 2001-02  |      1 |         18 | 24426        |             1.07895  |                 1.68421  |          0.947368 |        0.236842  |                    0 |\n| Ipswich Town 2001-02            | Ipswich Town            | 2002-03  |      2 |          7 | 25455        |             1.73913  |                 1.3913   |          1.52174  |        0.413043  |                    1 |\n| Ipswich Town 2001-02            | Ipswich Town            | 2003-04  |      2 |          5 | 24520        |             1.82609  |                 1.56522  |          1.58696  |        0.456522  |                    2 |\n| Ipswich Town 2024-25            | Ipswich Town            | 2023-24  |      2 |          2 | 28845        |             2        |                 1.23913  |          2.08696  |        0.608696  |                   -1 |\n| Ipswich Town 2024-25            | Ipswich Town            | 2024-25  |      1 |         19 | 29742        |             0.947368 |                 2.15789  |          0.578947 |        0.105263  |                    0 |\n| Ipswich Town 2024-25            | Ipswich Town            | 2025-26  |    nan |        nan | 28610        |           nan        |               nan        |        nan        |      nan         |                    1 |\n| Ipswich Town 2024-25            | Ipswich Town            | 2026-27  |    nan |        nan | &lt;NA&gt;         |           nan        |               nan        |        nan        |      nan         |                    2 |\n| Leeds United 2003-04            | Leeds United            | 2002-03  |      1 |         15 | 39120        |             1.52632  |                 1.5      |          1.23684  |        0.368421  |                   -1 |\n| Leeds United 2003-04            | Leeds United            | 2003-04  |      1 |         19 | 36666        |             1.05263  |                 2.07895  |          0.868421 |        0.210526  |                    0 |\n| Leeds United 2003-04            | Leeds United            | 2004-05  |      2 |         14 | 29207        |             1.06522  |                 1.13043  |          1.30435  |        0.304348  |                    1 |\n| Leeds United 2003-04            | Leeds United            | 2005-06  |      2 |          5 | 22355        |             1.23913  |                 0.826087 |          1.69565  |        0.456522  |                    2 |\n| Leeds United 2022-23            | Leeds United            | 2021-22  |      1 |         17 | 36308        |             1.10526  |                 2.07895  |          1        |        0.236842  |                   -1 |\n| Leeds United 2022-23            | Leeds United            | 2022-23  |      1 |         19 | 36566        |             1.26316  |                 2.05263  |          0.815789 |        0.184211  |                    0 |\n| Leeds United 2022-23            | Leeds United            | 2023-24  |      2 |          3 | 35989        |             1.76087  |                 0.934783 |          1.95652  |        0.586957  |                    1 |\n| Leeds United 2022-23            | Leeds United            | 2024-25  |      2 |          1 | 36216        |             2.06522  |                 0.652174 |          2.17391  |        0.630435  |                    2 |\n| Leicester City 1994-95          | Leicester City          | 1993-94  |      2 |          4 | 16009        |             1.56522  |                 1.28261  |          1.58696  |        0.413043  |                   -1 |\n| Leicester City 1994-95          | Leicester City          | 1994-95  |      1 |         21 | 19532        |             1.07143  |                 1.90476  |          0.690476 |        0.142857  |                    0 |\n| Leicester City 1994-95          | Leicester City          | 1995-96  |      2 |          5 | 16530        |             1.43478  |                 1.30435  |          1.54348  |        0.413043  |                    1 |\n| Leicester City 1994-95          | Leicester City          | 1996-97  |      1 |          9 | 20184        |             1.21053  |                 1.42105  |          1.23684  |        0.315789  |                    2 |\n| Leicester City 2001-02          | Leicester City          | 2000-01  |      1 |         13 | 20452        |             1.02632  |                 1.34211  |          1.26316  |        0.368421  |                   -1 |\n| Leicester City 2001-02          | Leicester City          | 2001-02  |      1 |         20 | 19835        |             0.789474 |                 1.68421  |          0.736842 |        0.131579  |                    0 |\n| Leicester City 2001-02          | Leicester City          | 2002-03  |      2 |          2 | 29231        |             1.58696  |                 0.869565 |          2        |        0.565217  |                    1 |\n| Leicester City 2001-02          | Leicester City          | 2003-04  |      1 |         18 | 30983        |             1.26316  |                 1.71053  |          0.868421 |        0.157895  |                    2 |\n| Leicester City 2003-04          | Leicester City          | 2002-03  |      2 |          2 | 29231        |             1.58696  |                 0.869565 |          2        |        0.565217  |                   -1 |\n| Leicester City 2003-04          | Leicester City          | 2003-04  |      1 |         18 | 30983        |             1.26316  |                 1.71053  |          0.868421 |        0.157895  |                    0 |\n| Leicester City 2003-04          | Leicester City          | 2004-05  |      2 |         15 | 24137        |             1.06522  |                 1        |          1.23913  |        0.26087   |                    1 |\n| Leicester City 2003-04          | Leicester City          | 2005-06  |      2 |         16 | 22234        |             1.1087   |                 1.28261  |          1.17391  |        0.282609  |                    2 |\n| Leicester City 2022-23          | Leicester City          | 2021-22  |      1 |          8 | 32061        |             1.63158  |                 1.55263  |          1.36842  |        0.368421  |                   -1 |\n| Leicester City 2022-23          | Leicester City          | 2022-23  |      1 |         18 | 31887        |             1.34211  |                 1.78947  |          0.894737 |        0.236842  |                    0 |\n| Leicester City 2022-23          | Leicester City          | 2023-24  |      2 |          1 | 31238        |             1.93478  |                 0.891304 |          2.1087   |        0.673913  |                    1 |\n| Leicester City 2022-23          | Leicester City          | 2024-25  |      1 |         18 | 31740        |             0.868421 |                 2.10526  |          0.657895 |        0.157895  |                    2 |\n| Leicester City 2024-25          | Leicester City          | 2023-24  |      2 |          1 | 31238        |             1.93478  |                 0.891304 |          2.1087   |        0.673913  |                   -1 |\n| Leicester City 2024-25          | Leicester City          | 2024-25  |      1 |         18 | 31448        |             0.868421 |                 2.10526  |          0.657895 |        0.157895  |                    0 |\n| Leicester City 2024-25          | Leicester City          | 2025-26  |    nan |        nan | 29871        |           nan        |               nan        |        nan        |      nan         |                    1 |\n| Leicester City 2024-25          | Leicester City          | 2026-27  |    nan |        nan | &lt;NA&gt;         |           nan        |               nan        |        nan        |      nan         |                    2 |\n| Luton Town 2023-24              | Luton Town              | 2022-23  |      2 |          3 | 9854         |             1.23913  |                 0.847826 |          1.73913  |        0.456522  |                   -1 |\n| Luton Town 2023-24              | Luton Town              | 2023-24  |      1 |         18 | 11244        |             1.36842  |                 2.23684  |          0.684211 |        0.157895  |                    0 |\n| Luton Town 2023-24              | Luton Town              | 2024-25  |      2 |         22 | 11420        |             0.978261 |                 1.5      |          1.06522  |        0.282609  |                    1 |\n| Luton Town 2023-24              | Luton Town              | 2025-26  |    nan |        nan | 11414        |           nan        |               nan        |        nan        |      nan         |                    2 |\n| Manchester City 1995-96         | Manchester City         | 1994-95  |      1 |         17 | 22725        |             1.2619   |                 1.52381  |          1.16667  |        0.285714  |                   -1 |\n| Manchester City 1995-96         | Manchester City         | 1995-96  |      1 |         18 | 27869        |             0.868421 |                 1.52632  |          1        |        0.236842  |                    0 |\n| Manchester City 1995-96         | Manchester City         | 1996-97  |      2 |         14 | 26753        |             1.28261  |                 1.30435  |          1.32609  |        0.369565  |                    1 |\n| Manchester City 1995-96         | Manchester City         | 1997-98  |      2 |         22 | 28196        |             1.21739  |                 1.23913  |          1.04348  |        0.26087   |                    2 |\n| Manchester City 2000-01         | Manchester City         | 1999-00  |      2 |          2 | 32088        |             1.69565  |                 0.869565 |          1.93478  |        0.565217  |                   -1 |\n| Manchester City 2000-01         | Manchester City         | 2000-01  |      1 |         18 | 34058        |             1.07895  |                 1.71053  |          0.894737 |        0.210526  |                    0 |\n| Manchester City 2000-01         | Manchester City         | 2001-02  |      2 |          1 | 33059        |             2.34783  |                 1.13043  |          2.15217  |        0.673913  |                    1 |\n| Manchester City 2000-01         | Manchester City         | 2002-03  |      1 |          9 | 34565        |             1.23684  |                 1.42105  |          1.34211  |        0.394737  |                    2 |\n| Middlesbrough 1992-93           | Middlesbrough           | 1991-92  |      2 |          2 | 14703        |             1.26087  |                 0.891304 |          1.73913  |        0.5       |                   -1 |\n| Middlesbrough 1992-93           | Middlesbrough           | 1992-93  |      1 |         21 | 16724        |             1.28571  |                 1.78571  |          1.04762  |        0.261905  |                    0 |\n| Middlesbrough 1992-93           | Middlesbrough           | 1993-94  |      2 |          9 | 10400        |             1.43478  |                 1.17391  |          1.45652  |        0.391304  |                    1 |\n| Middlesbrough 1992-93           | Middlesbrough           | 1994-95  |      2 |          1 | 18702        |             1.45652  |                 0.869565 |          1.78261  |        0.5       |                    2 |\n| Middlesbrough 1996-97           | Middlesbrough           | 1995-96  |      1 |         12 | 29283        |             0.921053 |                 1.31579  |          1.13158  |        0.289474  |                   -1 |\n| Middlesbrough 1996-97           | Middlesbrough           | 1996-97  |      1 |         19 | 29848        |             1.34211  |                 1.57895  |          1.02632  |        0.263158  |                    0 |\n| Middlesbrough 1996-97           | Middlesbrough           | 1997-98  |      2 |          2 | 29994        |             1.67391  |                 0.891304 |          1.97826  |        0.586957  |                    1 |\n| Middlesbrough 1996-97           | Middlesbrough           | 1998-99  |      1 |          9 | 34386        |             1.26316  |                 1.42105  |          1.34211  |        0.315789  |                    2 |\n| Middlesbrough 2008-09           | Middlesbrough           | 2007-08  |      1 |         13 | 26708        |             1.13158  |                 1.39474  |          1.10526  |        0.263158  |                   -1 |\n| Middlesbrough 2008-09           | Middlesbrough           | 2008-09  |      1 |         19 | 28429        |             0.736842 |                 1.5      |          0.842105 |        0.184211  |                    0 |\n| Middlesbrough 2008-09           | Middlesbrough           | 2009-10  |      2 |         11 | 19948        |             1.26087  |                 1.08696  |          1.34783  |        0.347826  |                    1 |\n| Middlesbrough 2008-09           | Middlesbrough           | 2010-11  |      2 |         12 | 16269        |             1.47826  |                 1.47826  |          1.34783  |        0.369565  |                    2 |\n| Middlesbrough 2016-17           | Middlesbrough           | 2015-16  |      2 |          2 | 24627        |             1.36957  |                 0.673913 |          1.93478  |        0.565217  |                   -1 |\n| Middlesbrough 2016-17           | Middlesbrough           | 2016-17  |      1 |         19 | 30449        |             0.710526 |                 1.39474  |          0.736842 |        0.131579  |                    0 |\n| Middlesbrough 2016-17           | Middlesbrough           | 2017-18  |      2 |          5 | 25544        |             1.45652  |                 0.978261 |          1.65217  |        0.478261  |                    1 |\n| Middlesbrough 2016-17           | Middlesbrough           | 2018-19  |      2 |          7 | 23217        |             1.06522  |                 0.891304 |          1.58696  |        0.434783  |                    2 |\n| Newcastle United 2008-09        | Newcastle United        | 2007-08  |      1 |         12 | 51321        |             1.18421  |                 1.71053  |          1.13158  |        0.289474  |                   -1 |\n| Newcastle United 2008-09        | Newcastle United        | 2008-09  |      1 |         18 | 48750        |             1.05263  |                 1.55263  |          0.894737 |        0.184211  |                    0 |\n| Newcastle United 2008-09        | Newcastle United        | 2009-10  |      2 |          1 | 43388        |             1.95652  |                 0.76087  |          2.21739  |        0.652174  |                    1 |\n| Newcastle United 2008-09        | Newcastle United        | 2010-11  |      1 |         12 | 47718        |             1.47368  |                 1.5      |          1.21053  |        0.289474  |                    2 |\n| Newcastle United 2015-16        | Newcastle United        | 2014-15  |      1 |         15 | 50359        |             1.05263  |                 1.65789  |          1.02632  |        0.263158  |                   -1 |\n| Newcastle United 2015-16        | Newcastle United        | 2015-16  |      1 |         18 | 49754        |             1.15789  |                 1.71053  |          0.973684 |        0.236842  |                    0 |\n| Newcastle United 2015-16        | Newcastle United        | 2016-17  |      2 |          1 | 51106        |             1.84783  |                 0.869565 |          2.04348  |        0.630435  |                    1 |\n| Newcastle United 2015-16        | Newcastle United        | 2017-18  |      1 |         10 | 51992        |             1.02632  |                 1.23684  |          1.15789  |        0.315789  |                    2 |\n| Norwich City 1994-95            | Norwich City            | 1993-94  |      1 |         12 | 18164        |             1.54762  |                 1.45238  |          1.2619   |        0.285714  |                   -1 |\n| Norwich City 1994-95            | Norwich City            | 1994-95  |      1 |         20 | 18625        |             0.880952 |                 1.28571  |          1.02381  |        0.238095  |                    0 |\n| Norwich City 1994-95            | Norwich City            | 1995-96  |      2 |         16 | 14581        |             1.28261  |                 1.19565  |          1.23913  |        0.304348  |                    1 |\n| Norwich City 1994-95            | Norwich City            | 1996-97  |      2 |         13 | 14719        |             1.36957  |                 1.47826  |          1.36957  |        0.369565  |                    2 |\n| Norwich City 2004-05            | Norwich City            | 2003-04  |      2 |          1 | 18987        |             1.71739  |                 0.847826 |          2.04348  |        0.608696  |                   -1 |\n| Norwich City 2004-05            | Norwich City            | 2004-05  |      1 |         19 | 24350        |             1.10526  |                 2.02632  |          0.868421 |        0.184211  |                    0 |\n| Norwich City 2004-05            | Norwich City            | 2005-06  |      2 |          9 | 24952        |             1.21739  |                 1.41304  |          1.34783  |        0.391304  |                    1 |\n| Norwich City 2004-05            | Norwich City            | 2006-07  |      2 |         16 | 24545        |             1.21739  |                 1.54348  |          1.23913  |        0.347826  |                    2 |\n| Norwich City 2013-14            | Norwich City            | 2012-13  |      1 |         11 | 26672        |             1.07895  |                 1.52632  |          1.15789  |        0.263158  |                   -1 |\n| Norwich City 2013-14            | Norwich City            | 2013-14  |      1 |         18 | 26805        |             0.736842 |                 1.63158  |          0.868421 |        0.210526  |                    0 |\n| Norwich City 2013-14            | Norwich City            | 2014-15  |      2 |          3 | 26343        |             1.91304  |                 1.04348  |          1.86957  |        0.543478  |                    1 |\n| Norwich City 2013-14            | Norwich City            | 2015-16  |      1 |         19 | 26972        |             1.02632  |                 1.76316  |          0.894737 |        0.236842  |                    2 |\n| Norwich City 2015-16            | Norwich City            | 2014-15  |      2 |          3 | 26343        |             1.91304  |                 1.04348  |          1.86957  |        0.543478  |                   -1 |\n| Norwich City 2015-16            | Norwich City            | 2015-16  |      1 |         19 | 26972        |             1.02632  |                 1.76316  |          0.894737 |        0.236842  |                    0 |\n| Norwich City 2015-16            | Norwich City            | 2016-17  |      2 |          8 | 26354        |             1.84783  |                 1.5      |          1.52174  |        0.434783  |                    1 |\n| Norwich City 2015-16            | Norwich City            | 2017-18  |      2 |         14 | 25959        |             1.06522  |                 1.30435  |          1.30435  |        0.326087  |                    2 |\n| Norwich City 2019-20            | Norwich City            | 2018-19  |      2 |          1 | 26014        |             2.02174  |                 1.23913  |          2.04348  |        0.586957  |                   -1 |\n| Norwich City 2019-20            | Norwich City            | 2019-20  |      1 |         20 | 27025        |             0.684211 |                 1.97368  |          0.552632 |        0.131579  |                    0 |\n| Norwich City 2019-20            | Norwich City            | 2020-21  |      2 |          1 | &lt;NA&gt;         |             1.63043  |                 0.782609 |          2.1087   |        0.630435  |                    1 |\n| Norwich City 2019-20            | Norwich City            | 2021-22  |      1 |         20 | 26836        |             0.605263 |                 2.21053  |          0.578947 |        0.131579  |                    2 |\n| Norwich City 2021-22            | Norwich City            | 2020-21  |      2 |          1 | &lt;NA&gt;         |             1.63043  |                 0.782609 |          2.1087   |        0.630435  |                   -1 |\n| Norwich City 2021-22            | Norwich City            | 2021-22  |      1 |         20 | 26836        |             0.605263 |                 2.21053  |          0.578947 |        0.131579  |                    0 |\n| Norwich City 2021-22            | Norwich City            | 2022-23  |      2 |         13 | 26069        |             1.23913  |                 1.17391  |          1.34783  |        0.369565  |                    1 |\n| Norwich City 2021-22            | Norwich City            | 2023-24  |      2 |          6 | 26077        |             1.71739  |                 1.3913   |          1.58696  |        0.456522  |                    2 |\n| Nottingham Forest 1992-93       | Nottingham Forest       | 1991-92  |      1 |          8 | 23721        |             1.42857  |                 1.38095  |          1.40476  |        0.380952  |                   -1 |\n| Nottingham Forest 1992-93       | Nottingham Forest       | 1992-93  |      1 |         22 | 21910        |             0.97619  |                 1.47619  |          0.952381 |        0.238095  |                    0 |\n| Nottingham Forest 1992-93       | Nottingham Forest       | 1993-94  |      2 |          2 | 23051        |             1.6087   |                 1.06522  |          1.80435  |        0.5       |                    1 |\n| Nottingham Forest 1992-93       | Nottingham Forest       | 1994-95  |      1 |          3 | 23633        |             1.71429  |                 1.02381  |          1.83333  |        0.52381   |                    2 |\n| Nottingham Forest 1996-97       | Nottingham Forest       | 1995-96  |      1 |          9 | 25916        |             1.31579  |                 1.42105  |          1.52632  |        0.394737  |                   -1 |\n| Nottingham Forest 1996-97       | Nottingham Forest       | 1996-97  |      1 |         20 | 24587        |             0.815789 |                 1.55263  |          0.894737 |        0.157895  |                    0 |\n| Nottingham Forest 1996-97       | Nottingham Forest       | 1997-98  |      2 |          1 | 20584        |             1.78261  |                 0.913043 |          2.04348  |        0.608696  |                    1 |\n| Nottingham Forest 1996-97       | Nottingham Forest       | 1998-99  |      1 |         20 | 24415        |             0.921053 |                 1.81579  |          0.789474 |        0.184211  |                    2 |\n| Nottingham Forest 1998-99       | Nottingham Forest       | 1997-98  |      2 |          1 | 20584        |             1.78261  |                 0.913043 |          2.04348  |        0.608696  |                   -1 |\n| Nottingham Forest 1998-99       | Nottingham Forest       | 1998-99  |      1 |         20 | 24415        |             0.921053 |                 1.81579  |          0.789474 |        0.184211  |                    0 |\n| Nottingham Forest 1998-99       | Nottingham Forest       | 1999-00  |      2 |         14 | 17196        |             1.15217  |                 1.19565  |          1.21739  |        0.304348  |                    1 |\n| Nottingham Forest 1998-99       | Nottingham Forest       | 2000-01  |      2 |         11 | 20615        |             1.19565  |                 1.15217  |          1.47826  |        0.434783  |                    2 |\n| Oldham Athletic 1993-94         | Oldham Athletic         | 1992-93  |      1 |         19 | 12859        |             1.5      |                 1.7619   |          1.16667  |        0.309524  |                   -1 |\n| Oldham Athletic 1993-94         | Oldham Athletic         | 1993-94  |      1 |         21 | 12563        |             1        |                 1.61905  |          0.952381 |        0.214286  |                    0 |\n| Oldham Athletic 1993-94         | Oldham Athletic         | 1994-95  |      2 |         14 | 8444         |             1.30435  |                 1.30435  |          1.32609  |        0.347826  |                    1 |\n| Oldham Athletic 1993-94         | Oldham Athletic         | 1995-96  |      2 |         18 | 6634         |             1.17391  |                 1.08696  |          1.21739  |        0.304348  |                    2 |\n| Portsmouth 2009-10              | Portsmouth              | 2008-09  |      1 |         14 | 19830        |             1        |                 1.5      |          1.07895  |        0.263158  |                   -1 |\n| Portsmouth 2009-10              | Portsmouth              | 2009-10  |      1 |         20 | 18249        |             0.894737 |                 1.73684  |          0.5      |        0.184211  |                    0 |\n| Portsmouth 2009-10              | Portsmouth              | 2010-11  |      2 |         16 | 15707        |             1.15217  |                 1.30435  |          1.26087  |        0.326087  |                    1 |\n| Portsmouth 2009-10              | Portsmouth              | 2011-12  |      2 |         22 | 15016        |             1.08696  |                 1.28261  |          0.869565 |        0.282609  |                    2 |\n| Queens Park Rangers 1995-96     | Queens Park Rangers     | 1994-95  |      1 |          8 | 14613        |             1.45238  |                 1.40476  |          1.42857  |        0.404762  |                   -1 |\n| Queens Park Rangers 1995-96     | Queens Park Rangers     | 1995-96  |      1 |         19 | 15683        |             1        |                 1.5      |          0.868421 |        0.236842  |                    0 |\n| Queens Park Rangers 1995-96     | Queens Park Rangers     | 1996-97  |      2 |          9 | 12554        |             1.3913   |                 1.30435  |          1.43478  |        0.391304  |                    1 |\n| Queens Park Rangers 1995-96     | Queens Park Rangers     | 1997-98  |      2 |         21 | 13083        |             1.1087   |                 1.36957  |          1.06522  |        0.217391  |                    2 |\n| Queens Park Rangers 2012-13     | Queens Park Rangers     | 2011-12  |      1 |         17 | 17295        |             1.13158  |                 1.73684  |          0.973684 |        0.263158  |                   -1 |\n| Queens Park Rangers 2012-13     | Queens Park Rangers     | 2012-13  |      1 |         20 | 17779        |             0.789474 |                 1.57895  |          0.657895 |        0.105263  |                    0 |\n| Queens Park Rangers 2012-13     | Queens Park Rangers     | 2013-14  |      2 |          4 | 16656        |             1.30435  |                 0.956522 |          1.73913  |        0.5       |                    1 |\n| Queens Park Rangers 2012-13     | Queens Park Rangers     | 2014-15  |      1 |         20 | 17809        |             1.10526  |                 1.92105  |          0.789474 |        0.210526  |                    2 |\n| Queens Park Rangers 2014-15     | Queens Park Rangers     | 2013-14  |      2 |          4 | 16656        |             1.30435  |                 0.956522 |          1.73913  |        0.5       |                   -1 |\n| Queens Park Rangers 2014-15     | Queens Park Rangers     | 2014-15  |      1 |         20 | 17809        |             1.10526  |                 1.92105  |          0.789474 |        0.210526  |                    0 |\n| Queens Park Rangers 2014-15     | Queens Park Rangers     | 2015-16  |      2 |         12 | 15994        |             1.17391  |                 1.17391  |          1.30435  |        0.304348  |                    1 |\n| Queens Park Rangers 2014-15     | Queens Park Rangers     | 2016-17  |      2 |         18 | 14616        |             1.13043  |                 1.43478  |          1.15217  |        0.326087  |                    2 |\n| Reading 2007-08                 | Reading                 | 2006-07  |      1 |          8 | 23829        |             1.36842  |                 1.23684  |          1.44737  |        0.421053  |                   -1 |\n| Reading 2007-08                 | Reading                 | 2007-08  |      1 |         18 | 23585        |             1.07895  |                 1.73684  |          0.947368 |        0.263158  |                    0 |\n| Reading 2007-08                 | Reading                 | 2008-09  |      2 |          4 | 19936        |             1.56522  |                 0.869565 |          1.67391  |        0.456522  |                    1 |\n| Reading 2007-08                 | Reading                 | 2009-10  |      2 |          9 | 17408        |             1.47826  |                 1.36957  |          1.36957  |        0.369565  |                    2 |\n| Reading 2012-13                 | Reading                 | 2011-12  |      2 |          1 | 19219        |             1.5      |                 0.891304 |          1.93478  |        0.586957  |                   -1 |\n| Reading 2012-13                 | Reading                 | 2012-13  |      1 |         19 | 23862        |             1.13158  |                 1.92105  |          0.736842 |        0.157895  |                    0 |\n| Reading 2012-13                 | Reading                 | 2013-14  |      2 |          7 | 19171        |             1.52174  |                 1.21739  |          1.54348  |        0.413043  |                    1 |\n| Reading 2012-13                 | Reading                 | 2014-15  |      2 |         19 | 17022        |             1.04348  |                 1.5      |          1.08696  |        0.282609  |                    2 |\n| Sheffield United 1993-94        | Sheffield United        | 1992-93  |      1 |         14 | 18801        |             1.28571  |                 1.2619   |          1.2381   |        0.333333  |                   -1 |\n| Sheffield United 1993-94        | Sheffield United        | 1993-94  |      1 |         20 | 19562        |             1        |                 1.42857  |          1        |        0.190476  |                    0 |\n| Sheffield United 1993-94        | Sheffield United        | 1994-95  |      2 |          8 | 14462        |             1.6087   |                 1.19565  |          1.47826  |        0.369565  |                    1 |\n| Sheffield United 1993-94        | Sheffield United        | 1995-96  |      2 |          9 | 12901        |             1.23913  |                 1.17391  |          1.34783  |        0.347826  |                    2 |\n| Sheffield United 2006-07        | Sheffield United        | 2005-06  |      2 |          2 | 23650        |             1.65217  |                 1        |          1.95652  |        0.565217  |                   -1 |\n| Sheffield United 2006-07        | Sheffield United        | 2006-07  |      1 |         18 | 30512        |             0.842105 |                 1.44737  |          1        |        0.263158  |                    0 |\n| Sheffield United 2006-07        | Sheffield United        | 2007-08  |      2 |          9 | 25631        |             1.21739  |                 1.1087   |          1.43478  |        0.369565  |                    1 |\n| Sheffield United 2006-07        | Sheffield United        | 2008-09  |      2 |          3 | 26023        |             1.3913   |                 0.847826 |          1.73913  |        0.478261  |                    2 |\n| Sheffield United 2020-21        | Sheffield United        | 2019-20  |      1 |          9 | 30869        |             1.02632  |                 1.02632  |          1.42105  |        0.368421  |                   -1 |\n| Sheffield United 2020-21        | Sheffield United        | 2019-20  |      1 |          9 | 30869        |             1.02632  |                 1.02632  |          1.42105  |        0.368421  |                   -1 |\n| Sheffield United 2020-21        | Sheffield United        | 2020-21  |      1 |         20 | &lt;NA&gt;         |             0.526316 |                 1.65789  |          0.605263 |        0.184211  |                    0 |\n| Sheffield United 2020-21        | Sheffield United        | 2020-21  |      1 |         20 | &lt;NA&gt;         |             0.526316 |                 1.65789  |          0.605263 |        0.184211  |                    0 |\n| Sheffield United 2020-21        | Sheffield United        | 2021-22  |      2 |          5 | 27611        |             1.36957  |                 0.978261 |          1.63043  |        0.456522  |                    1 |\n| Sheffield United 2020-21        | Sheffield United        | 2021-22  |      2 |          5 | 27611        |             1.36957  |                 0.978261 |          1.63043  |        0.456522  |                    1 |\n| Sheffield United 2020-21        | Sheffield United        | 2022-23  |      2 |          2 | 28746        |             1.58696  |                 0.847826 |          1.97826  |        0.608696  |                    2 |\n| Sheffield United 2020-21        | Sheffield United        | 2022-23  |      2 |          2 | 28746        |             1.58696  |                 0.847826 |          1.97826  |        0.608696  |                    2 |\n| Sheffield United 2023-24        | Sheffield United        | 2022-23  |      2 |          2 | 28746        |             1.58696  |                 0.847826 |          1.97826  |        0.608696  |                   -1 |\n| Sheffield United 2023-24        | Sheffield United        | 2023-24  |      1 |         20 | 30011        |             0.921053 |                 2.73684  |          0.421053 |        0.0789474 |                    0 |\n| Sheffield United 2023-24        | Sheffield United        | 2024-25  |      2 |          3 | 28070        |             1.36957  |                 0.782609 |          1.95652  |        0.608696  |                    1 |\n| Sheffield United 2023-24        | Sheffield United        | 2025-26  |    nan |        nan | 27788        |           nan        |               nan        |        nan        |      nan         |                    2 |\n| Sheffield Wednesday 1999-2000   | Sheffield Wednesday     | 1998-99  |      1 |         12 | 26745        |             1.07895  |                 1.10526  |          1.21053  |        0.342105  |                   -1 |\n| Sheffield Wednesday 1999-2000   | Sheffield Wednesday     | 1999-00  |      1 |         19 | 24855        |             1        |                 1.84211  |          0.815789 |        0.210526  |                    0 |\n| Sheffield Wednesday 1999-2000   | Sheffield Wednesday     | 2000-01  |      2 |         17 | 19268        |             1.13043  |                 1.54348  |          1.15217  |        0.326087  |                    1 |\n| Sheffield Wednesday 1999-2000   | Sheffield Wednesday     | 2001-02  |      2 |         20 | 20870        |             1.06522  |                 1.54348  |          1.08696  |        0.26087   |                    2 |\n| Southampton 2004-05             | Southampton             | 2003-04  |      1 |         12 | 31717        |             1.15789  |                 1.18421  |          1.23684  |        0.315789  |                   -1 |\n| Southampton 2004-05             | Southampton             | 2004-05  |      1 |         20 | 30610        |             1.18421  |                 1.73684  |          0.842105 |        0.157895  |                    0 |\n| Southampton 2004-05             | Southampton             | 2005-06  |      2 |         12 | 23614        |             1.06522  |                 1.08696  |          1.26087  |        0.282609  |                    1 |\n| Southampton 2004-05             | Southampton             | 2006-07  |      2 |          6 | 23556        |             1.67391  |                 1.15217  |          1.63043  |        0.456522  |                    2 |\n| Southampton 2022-23             | Southampton             | 2021-22  |      1 |         15 | 29889        |             1.13158  |                 1.76316  |          1.05263  |        0.236842  |                   -1 |\n| Southampton 2022-23             | Southampton             | 2022-23  |      1 |         20 | 30440        |             0.947368 |                 1.92105  |          0.657895 |        0.157895  |                    0 |\n| Southampton 2022-23             | Southampton             | 2023-24  |      2 |          4 | 29373        |             1.8913   |                 1.36957  |          1.8913   |        0.565217  |                    1 |\n| Southampton 2022-23             | Southampton             | 2024-25  |      1 |         20 | 31147        |             0.684211 |                 2.26316  |          0.315789 |        0.0526316 |                    2 |\n| Southampton 2024-25             | Southampton             | 2023-24  |      2 |          4 | 29373        |             1.8913   |                 1.36957  |          1.8913   |        0.565217  |                   -1 |\n| Southampton 2024-25             | Southampton             | 2024-25  |      1 |         20 | 30865        |             0.684211 |                 2.26316  |          0.315789 |        0.0526316 |                    0 |\n| Southampton 2024-25             | Southampton             | 2025-26  |    nan |        nan | 28783        |           nan        |               nan        |        nan        |      nan         |                    1 |\n| Southampton 2024-25             | Southampton             | 2026-27  |    nan |        nan | &lt;NA&gt;         |           nan        |               nan        |        nan        |      nan         |                    2 |\n| Stoke City 2017-18              | Stoke City              | 2016-17  |      1 |         13 | 27433        |             1.07895  |                 1.47368  |          1.15789  |        0.289474  |                   -1 |\n| Stoke City 2017-18              | Stoke City              | 2017-18  |      1 |         19 | 29280        |             0.921053 |                 1.78947  |          0.868421 |        0.184211  |                    0 |\n| Stoke City 2017-18              | Stoke City              | 2018-19  |      2 |         16 | 25200        |             0.978261 |                 1.13043  |          1.19565  |        0.23913   |                    1 |\n| Stoke City 2017-18              | Stoke City              | 2019-20  |      2 |         15 | 22828        |             1.34783  |                 1.47826  |          1.21739  |        0.347826  |                    2 |\n| Sunderland 1996-97              | Sunderland              | 1995-96  |      2 |          1 | 17482        |             1.28261  |                 0.717391 |          1.80435  |        0.478261  |                   -1 |\n| Sunderland 1996-97              | Sunderland              | 1996-97  |      1 |         18 | 20865        |             0.921053 |                 1.39474  |          1.05263  |        0.263158  |                    0 |\n| Sunderland 1996-97              | Sunderland              | 1997-98  |      2 |          3 | 33492        |             1.86957  |                 1.08696  |          1.95652  |        0.565217  |                    1 |\n| Sunderland 1996-97              | Sunderland              | 1998-99  |      2 |          1 | 38745        |             1.97826  |                 0.608696 |          2.28261  |        0.673913  |                    2 |\n| Sunderland 2002-03              | Sunderland              | 2001-02  |      1 |         17 | 46745        |             0.763158 |                 1.34211  |          1.05263  |        0.263158  |                   -1 |\n| Sunderland 2002-03              | Sunderland              | 2002-03  |      1 |         20 | 39698        |             0.552632 |                 1.71053  |          0.5      |        0.105263  |                    0 |\n| Sunderland 2002-03              | Sunderland              | 2003-04  |      2 |          3 | 27119        |             1.34783  |                 0.978261 |          1.71739  |        0.478261  |                    1 |\n| Sunderland 2002-03              | Sunderland              | 2004-05  |      2 |          1 | 28821        |             1.65217  |                 0.891304 |          2.04348  |        0.630435  |                    2 |\n| Sunderland 2005-06              | Sunderland              | 2004-05  |      2 |          1 | 28821        |             1.65217  |                 0.891304 |          2.04348  |        0.630435  |                   -1 |\n| Sunderland 2005-06              | Sunderland              | 2005-06  |      1 |         20 | 33904        |             0.684211 |                 1.81579  |          0.394737 |        0.0789474 |                    0 |\n| Sunderland 2005-06              | Sunderland              | 2006-07  |      2 |          1 | 31887        |             1.65217  |                 1.02174  |          1.91304  |        0.586957  |                    1 |\n| Sunderland 2005-06              | Sunderland              | 2007-08  |      1 |         15 | 43344        |             0.947368 |                 1.55263  |          1.02632  |        0.289474  |                    2 |\n| Sunderland 2016-17              | Sunderland              | 2015-16  |      1 |         17 | 43071        |             1.26316  |                 1.63158  |          1.02632  |        0.236842  |                   -1 |\n| Sunderland 2016-17              | Sunderland              | 2016-17  |      1 |         20 | 41287        |             0.763158 |                 1.81579  |          0.631579 |        0.157895  |                    0 |\n| Sunderland 2016-17              | Sunderland              | 2017-18  |      2 |         24 | 27635        |             1.13043  |                 1.73913  |          0.804348 |        0.152174  |                    1 |\n| Sunderland 2016-17              | Sunderland              | 2018-19  |      3 |          5 | 32157        |             1.73913  |                 1.02174  |          1.84783  |        0.478261  |                    2 |\n| Swansea City 2017-18            | Swansea City            | 2016-17  |      1 |         15 | 20619        |             1.18421  |                 1.84211  |          1.07895  |        0.315789  |                   -1 |\n| Swansea City 2017-18            | Swansea City            | 2017-18  |      1 |         18 | 20623        |             0.736842 |                 1.47368  |          0.868421 |        0.210526  |                    0 |\n| Swansea City 2017-18            | Swansea City            | 2018-19  |      2 |         10 | 18737        |             1.41304  |                 1.34783  |          1.41304  |        0.391304  |                    1 |\n| Swansea City 2017-18            | Swansea City            | 2019-20  |      2 |          6 | 16151        |             1.34783  |                 1.15217  |          1.52174  |        0.391304  |                    2 |\n| Swindon Town 1993-94            | Swindon Town            | 1992-93  |      2 |          5 | 10716        |             1.6087   |                 1.28261  |          1.65217  |        0.456522  |                   -1 |\n| Swindon Town 1993-94            | Swindon Town            | 1993-94  |      1 |         22 | 15274        |             1.11905  |                 2.38095  |          0.714286 |        0.119048  |                    0 |\n| Swindon Town 1993-94            | Swindon Town            | 1994-95  |      2 |         21 | 9744         |             1.17391  |                 1.58696  |          1.04348  |        0.26087   |                    1 |\n| Swindon Town 1993-94            | Swindon Town            | 1995-96  |      3 |          1 | 10602        |             1.54348  |                 0.73913  |          2        |        0.543478  |                    2 |\n| Watford 1999-2000               | Watford                 | 1998-99  |      2 |          5 | 11822        |             1.41304  |                 1.21739  |          1.67391  |        0.456522  |                   -1 |\n| Watford 1999-2000               | Watford                 | 1999-00  |      1 |         20 | 18544        |             0.921053 |                 2.02632  |          0.631579 |        0.157895  |                    0 |\n| Watford 1999-2000               | Watford                 | 2000-01  |      2 |          9 | 13941        |             1.65217  |                 1.45652  |          1.5      |        0.434783  |                    1 |\n| Watford 1999-2000               | Watford                 | 2001-02  |      2 |         14 | 14868        |             1.34783  |                 1.21739  |          1.28261  |        0.347826  |                    2 |\n| Watford 2006-07                 | Watford                 | 2005-06  |      2 |          3 | 15450        |             1.67391  |                 1.15217  |          1.76087  |        0.478261  |                   -1 |\n| Watford 2006-07                 | Watford                 | 2006-07  |      1 |         20 | 18751        |             0.763158 |                 1.55263  |          0.736842 |        0.131579  |                    0 |\n| Watford 2006-07                 | Watford                 | 2007-08  |      2 |          6 | 16876        |             1.34783  |                 1.21739  |          1.52174  |        0.391304  |                    1 |\n| Watford 2006-07                 | Watford                 | 2008-09  |      2 |         13 | 14858        |             1.47826  |                 1.56522  |          1.26087  |        0.347826  |                    2 |\n| Watford 2019-20                 | Watford                 | 2018-19  |      1 |         11 | 20016        |             1.36842  |                 1.55263  |          1.31579  |        0.368421  |                   -1 |\n| Watford 2019-20                 | Watford                 | 2019-20  |      1 |         19 | 20837        |             0.947368 |                 1.68421  |          0.894737 |        0.210526  |                    0 |\n| Watford 2019-20                 | Watford                 | 2020-21  |      2 |          2 | &lt;NA&gt;         |             1.36957  |                 0.652174 |          1.97826  |        0.586957  |                    1 |\n| Watford 2019-20                 | Watford                 | 2021-22  |      1 |         19 | 20614        |             0.894737 |                 2.02632  |          0.605263 |        0.157895  |                    2 |\n| Watford 2021-22                 | Watford                 | 2020-21  |      2 |          2 | &lt;NA&gt;         |             1.36957  |                 0.652174 |          1.97826  |        0.586957  |                   -1 |\n| Watford 2021-22                 | Watford                 | 2021-22  |      1 |         19 | 20614        |             0.894737 |                 2.02632  |          0.605263 |        0.157895  |                    0 |\n| Watford 2021-22                 | Watford                 | 2022-23  |      2 |         11 | 19172        |             1.21739  |                 1.15217  |          1.36957  |        0.347826  |                    1 |\n| Watford 2021-22                 | Watford                 | 2023-24  |      2 |         15 | 18876        |             1.32609  |                 1.32609  |          1.21739  |        0.282609  |                    2 |\n| West Bromwich Albion 2002-03    | West Bromwich Albion    | 2001-02  |      2 |          2 | 20910        |             1.32609  |                 0.630435 |          1.93478  |        0.586957  |                   -1 |\n| West Bromwich Albion 2002-03    | West Bromwich Albion    | 2002-03  |      1 |         19 | 26731        |             0.763158 |                 1.71053  |          0.684211 |        0.157895  |                    0 |\n| West Bromwich Albion 2002-03    | West Bromwich Albion    | 2003-04  |      2 |          2 | 24765        |             1.3913   |                 0.913043 |          1.86957  |        0.543478  |                    1 |\n| West Bromwich Albion 2002-03    | West Bromwich Albion    | 2004-05  |      1 |         17 | 25987        |             0.947368 |                 1.60526  |          0.894737 |        0.157895  |                    2 |\n| West Bromwich Albion 2005-06    | West Bromwich Albion    | 2004-05  |      1 |         17 | 25987        |             0.947368 |                 1.60526  |          0.894737 |        0.157895  |                   -1 |\n| West Bromwich Albion 2005-06    | West Bromwich Albion    | 2005-06  |      1 |         19 | 25404        |             0.815789 |                 1.52632  |          0.789474 |        0.184211  |                    0 |\n| West Bromwich Albion 2005-06    | West Bromwich Albion    | 2006-07  |      2 |          4 | 20472        |             1.76087  |                 1.19565  |          1.65217  |        0.478261  |                    1 |\n| West Bromwich Albion 2005-06    | West Bromwich Albion    | 2007-08  |      2 |          1 | 22311        |             1.91304  |                 1.19565  |          1.76087  |        0.5       |                    2 |\n| West Bromwich Albion 2008-09    | West Bromwich Albion    | 2007-08  |      2 |          1 | 22311        |             1.91304  |                 1.19565  |          1.76087  |        0.5       |                   -1 |\n| West Bromwich Albion 2008-09    | West Bromwich Albion    | 2008-09  |      1 |         20 | 25828        |             0.947368 |                 1.76316  |          0.842105 |        0.210526  |                    0 |\n| West Bromwich Albion 2008-09    | West Bromwich Albion    | 2009-10  |      2 |          2 | 22199        |             1.93478  |                 1.04348  |          1.97826  |        0.565217  |                    1 |\n| West Bromwich Albion 2008-09    | West Bromwich Albion    | 2010-11  |      1 |         11 | 24683        |             1.47368  |                 1.86842  |          1.23684  |        0.315789  |                    2 |\n| West Bromwich Albion 2017-18    | West Bromwich Albion    | 2016-17  |      1 |         10 | 23876        |             1.13158  |                 1.34211  |          1.18421  |        0.315789  |                   -1 |\n| West Bromwich Albion 2017-18    | West Bromwich Albion    | 2017-18  |      1 |         20 | 24520        |             0.815789 |                 1.47368  |          0.815789 |        0.157895  |                    0 |\n| West Bromwich Albion 2017-18    | West Bromwich Albion    | 2018-19  |      2 |          4 | 24148        |             1.8913   |                 1.34783  |          1.73913  |        0.5       |                    1 |\n| West Bromwich Albion 2017-18    | West Bromwich Albion    | 2019-20  |      2 |          2 | 24053        |             1.67391  |                 0.978261 |          1.80435  |        0.478261  |                    2 |\n| West Bromwich Albion 2020-21    | West Bromwich Albion    | 2019-20  |      2 |          2 | 24053        |             1.67391  |                 0.978261 |          1.80435  |        0.478261  |                   -1 |\n| West Bromwich Albion 2020-21    | West Bromwich Albion    | 2019-20  |      2 |          2 | 24053        |             1.67391  |                 0.978261 |          1.80435  |        0.478261  |                   -1 |\n| West Bromwich Albion 2020-21    | West Bromwich Albion    | 2020-21  |      1 |         19 | &lt;NA&gt;         |             0.921053 |                 2        |          0.684211 |        0.131579  |                    0 |\n| West Bromwich Albion 2020-21    | West Bromwich Albion    | 2020-21  |      1 |         19 | &lt;NA&gt;         |             0.921053 |                 2        |          0.684211 |        0.131579  |                    0 |\n| West Bromwich Albion 2020-21    | West Bromwich Albion    | 2021-22  |      2 |         10 | 21481        |             1.13043  |                 0.978261 |          1.45652  |        0.391304  |                    1 |\n| West Bromwich Albion 2020-21    | West Bromwich Albion    | 2021-22  |      2 |         10 | 21481        |             1.13043  |                 0.978261 |          1.45652  |        0.391304  |                    1 |\n| West Bromwich Albion 2020-21    | West Bromwich Albion    | 2022-23  |      2 |          9 | 23094        |             1.28261  |                 1.15217  |          1.43478  |        0.391304  |                    2 |\n| West Bromwich Albion 2020-21    | West Bromwich Albion    | 2022-23  |      2 |          9 | 23094        |             1.28261  |                 1.15217  |          1.43478  |        0.391304  |                    2 |\n| West Ham United 2002-03         | West Ham United         | 2001-02  |      1 |          7 | 31570        |             1.26316  |                 1.5      |          1.39474  |        0.394737  |                   -1 |\n| West Ham United 2002-03         | West Ham United         | 2002-03  |      1 |         18 | 34432        |             1.10526  |                 1.55263  |          1.10526  |        0.263158  |                    0 |\n| West Ham United 2002-03         | West Ham United         | 2003-04  |      2 |          4 | 31167        |             1.45652  |                 0.978261 |          1.6087   |        0.413043  |                    1 |\n| West Ham United 2002-03         | West Ham United         | 2004-05  |      2 |          6 | 27403        |             1.43478  |                 1.21739  |          1.58696  |        0.456522  |                    2 |\n| West Ham United 2010-11         | West Ham United         | 2009-10  |      1 |         17 | 33683        |             1.23684  |                 1.73684  |          0.921053 |        0.210526  |                   -1 |\n| West Ham United 2010-11         | West Ham United         | 2010-11  |      1 |         20 | 33492        |             1.13158  |                 1.84211  |          0.868421 |        0.184211  |                    0 |\n| West Ham United 2010-11         | West Ham United         | 2011-12  |      2 |          3 | 30923        |             1.76087  |                 1.04348  |          1.86957  |        0.521739  |                    1 |\n| West Ham United 2010-11         | West Ham United         | 2012-13  |      1 |         10 | 34720        |             1.18421  |                 1.39474  |          1.21053  |        0.315789  |                    2 |\n| Wigan Athletic 2012-13          | Wigan Athletic          | 2011-12  |      1 |         15 | 18634        |             1.10526  |                 1.63158  |          1.13158  |        0.289474  |                   -1 |\n| Wigan Athletic 2012-13          | Wigan Athletic          | 2012-13  |      1 |         18 | 19359        |             1.23684  |                 1.92105  |          0.947368 |        0.236842  |                    0 |\n| Wigan Athletic 2012-13          | Wigan Athletic          | 2013-14  |      2 |          5 | 15177        |             1.32609  |                 1.04348  |          1.58696  |        0.456522  |                    1 |\n| Wigan Athletic 2012-13          | Wigan Athletic          | 2014-15  |      2 |         23 | 12882        |             0.847826 |                 1.3913   |          0.847826 |        0.195652  |                    2 |\n| Wimbledon 1999-2000             | Wimbledon               | 1998-99  |      1 |         16 | 18207        |             1.05263  |                 1.65789  |          1.10526  |        0.263158  |                   -1 |\n| Wimbledon 1999-2000             | Wimbledon               | 1999-00  |      1 |         18 | 17157        |             1.21053  |                 1.94737  |          0.868421 |        0.184211  |                    0 |\n| Wimbledon 1999-2000             | Wimbledon               | 2000-01  |      2 |          8 | 7901         |             1.54348  |                 1.08696  |          1.5      |        0.369565  |                    1 |\n| Wimbledon 1999-2000             | Wimbledon               | 2001-02  |      2 |          9 | 6961         |             1.36957  |                 1.23913  |          1.45652  |        0.391304  |                    2 |\n| Wolverhampton Wanderers 2003-04 | Wolverhampton Wanderers | 2002-03  |      2 |          5 | 25745        |             1.76087  |                 0.956522 |          1.65217  |        0.434783  |                   -1 |\n| Wolverhampton Wanderers 2003-04 | Wolverhampton Wanderers | 2003-04  |      1 |         20 | 28874        |             1        |                 2.02632  |          0.868421 |        0.184211  |                    0 |\n| Wolverhampton Wanderers 2003-04 | Wolverhampton Wanderers | 2004-05  |      2 |          9 | 26620        |             1.56522  |                 1.28261  |          1.43478  |        0.326087  |                    1 |\n| Wolverhampton Wanderers 2003-04 | Wolverhampton Wanderers | 2005-06  |      2 |          7 | 23624        |             1.08696  |                 0.913043 |          1.45652  |        0.347826  |                    2 |\n| Wolverhampton Wanderers 2011-12 | Wolverhampton Wanderers | 2010-11  |      1 |         17 | 27696        |             1.21053  |                 1.73684  |          1.05263  |        0.289474  |                   -1 |\n| Wolverhampton Wanderers 2011-12 | Wolverhampton Wanderers | 2011-12  |      1 |         20 | 25682        |             1.05263  |                 2.15789  |          0.657895 |        0.131579  |                    0 |\n| Wolverhampton Wanderers 2011-12 | Wolverhampton Wanderers | 2012-13  |      2 |         23 | 21773        |             1.19565  |                 1.5      |          1.1087   |        0.304348  |                    1 |\n| Wolverhampton Wanderers 2011-12 | Wolverhampton Wanderers | 2013-14  |      3 |          1 | 20879        |             1.93478  |                 0.673913 |          2.23913  |        0.673913  |                    2 |"
  },
  {
    "objectID": "posts/currys-copywriting-samples/index.html",
    "href": "posts/currys-copywriting-samples/index.html",
    "title": "Currys",
    "section": "",
    "text": "A compilation of some ecommerce copy I wrote while working as a copywriter for Currys. I wrote about everything and anything - particularly computing.\nSome links will inevitably break over time. Increasingly, these products are no longer on the main Currys site. But archived products often sit on Currys Business - the ugly duckling sibling site - to wither and rot. Where I’ve used a Currys Business link, the neglected product would be especially grateful to receive your visit.\nMy name isn’t on any of these, but I promise I wrote them!\nLEDGER Nano X Hardware Wallet For Crypto \n\nSHOKZ OpenRun Bone Conduction Sports Headphones \n\nFootball Manager 24 \n\nSpongeBob SquarePants: The Cosmic Shake\n\n\nASUS ROG Strix SCAR 18” Gaming Laptop\n\n\n\nThumbnail image courtesy of FutureBrand Currys PLC, CC BY-SA 4.0, https://creativecommons.org/licenses/by-sa/4.0, via Wikimedia Commons"
  },
  {
    "objectID": "posts/post-relegation-attendance/index.html",
    "href": "posts/post-relegation-attendance/index.html",
    "title": "Fair-Weather Fans?",
    "section": "",
    "text": "I’m a Burnley fan. With our recent promotion to the Premier League we are firmly consolidated as a yoyo club par excellence - we rank joint-4th with Sunderland on the Yoyo-meter (below). So what better time to assess some of the impacts of relegation from the Premier League? Because it’s never too early to plan ahead.\nIn this article, I’ll be exploring if, how and for how long Premier League relegation disrupts attendances. We’ll also examine some mitigating factors. Does attractive football help maintain attendances? Is mid-table mediocrity worse for attendances than being in a relegation dogfight?\nThe dataset I have designed for this project combines a few different online resources and also engineers some variables. You can read about it and download it here."
  },
  {
    "objectID": "posts/post-relegation-attendance/index.html#methodology",
    "href": "posts/post-relegation-attendance/index.html#methodology",
    "title": "Fair-Weather Fans?",
    "section": "Methodology",
    "text": "Methodology\n\nData Collection\nFor this project, I gathered attendance, league position, and performance data for every club relegated from the Premier League, spanning a four-year period for each event:\n\nYear -1: The season before the Premier League relegation season.\nYear 0: The Premier League season that resulted in relegation.\nYear +1: The first season after relegation (in the Championship).\nYear +2: The second season after relegation.\n\n\n\n\n\n\n\nNote\n\n\n\nA temporary fifth year of data (Year +3) was programmatically generated to extract the league tier, which is used to determine the final outcome of the Year +2 season. After achieving that, the temporary Year +3 data was dropped.\n\n\n\nSources\n\nFor Attendance data, I referenced European-Football-Statistics.co.uk.\nFor both Position and Performance data I relied on the Fjelstul English Football Database, which is a comprehensive catalogue of English Football from 1888-2024. I used a small section from the standings dataset, but he also has datasets covering seasons, teams, matches, and appearances. Worth a look if you have a project in mind.\n\n\n\n\n\n\n\nNote\n\n\n\nDr. Fjelstul’s database is copyrighted (“© 2024 Joshua C. Fjelstul, Ph.D.”) but accessible via the CC-BY-SA 4.0 license. I will also be making my own dataset available under the same CC-BY-SA 4.0 license.\n\n\n\n\n\nDataset\nIn addition to merging attendance data with position data and performance data, some key features of the dataset had to be engineered. I needed Year_vs_Relegation and Year_End_Outcome columns in order to group by season outcomes and to track attendance over time.\nFor my single source of truth dataset, I am using the raw values for performance (Points, Goals, etc.) and calculating per-game metrics as needed for analysis. Below is a snapshot of the final, tidy dataset.\n\nLimitations\nAs tidy as it is, there are still some pretty big limitations to this dataset:\nSeason-Level Granularity:\n- The dataset aggregates data at the season level, meaning any within-season events—such as managerial changes, mid-season form swings, or cup runs—are not captured.\nLoss of Match-Level Variability:\n- Attendance figures are averaged per season, so high- or low-attendance matches (e.g., local derbies) are smoothed out.\nExternal Influences Aren’t Captured (with the exception of COVID) - Factors such as weather, ticket pricing, fan protests, or extraordinary events (e.g., stadium closures) are not included. These could all contribute to unexplained variance in attendance. However, I do think that over a season, these sorts of things tend to balance themselves out. Except for COVID and stadium reconstructions, which both need special handling.\nHandling COVID-19\n- A quick note on the elephant in the stadium: the 2019-20 and 2020-21 seasons. Since many games were played with zero or partial attendance, including them as “0” would catastrophically skew the averages. To prevent this, the data cleaning pipeline explicitly searches for any attendance data marked “COVID” and converts it to a null value (pd.NA). All subsequent averaging functions automatically ignore these null values, so the analysis is not contaminated by seasons played behind closed doors.\nHandling Stadium Anomalies The data contains three major structural anomalies where attendance was dictated by stadium construction, not fan sentiment or on-pitch performance:\n\nMiddlesbrough (1993-94): Attendance artificially plummeted due to a stadium rebuild.\nSunderland (1997-98): Attendance saw a massive, artificial spike from moving to the new Stadium of Light.\nLeicester City (2002-03): A similar spike occurred when the club moved to the Walkers Stadium (now called the King Power Stadium).\n\nTo prevent these outliers from skewing my interpretations, these specific team-seasons were identified. Unless I specifically mention their inclusion, you can safely assume they were filtered out of the analysis.\n\n\nDownloadable\nIf you still want the dataset for analysis after all that, or you’re wondering why I keep calling things tidy, then check out Too Messy to Melt for a technical guide to how this dataset was constructed. Or you can inspect the data dictionary and grab the downloadable dataset straight from my GitHub."
  },
  {
    "objectID": "posts/post-relegation-attendance/index.html#analysis",
    "href": "posts/post-relegation-attendance/index.html#analysis",
    "title": "Fair-Weather Fans?",
    "section": "Analysis",
    "text": "Analysis\n\nIncreased attendance after relegation?\nLet’s start on a positive note. On 10 occasions, teams managed to increase their average attendance in the first season (Y+1) immediately following relegation.\n\n\n\n\n\n\n\nTeam\nAttendance (Y0)\nAttendance (Y+1)\nChange (%)\n\n\n\n\nSunderland\n20865\n33492\n60.52\n\n\nLeicester City\n19835\n29231\n47.37\n\n\nNottingham Forest\n21910\n23051\n5.21\n\n\nIpswich Town\n24426\n25455\n4.21\n\n\nBurnley\n19399\n19953\n2.86\n\n\nNewcastle United\n49754\n51106\n2.72\n\n\nNorwich City\n24350\n24952\n2.47\n\n\nCrystal Palace\n14992\n15248\n1.71\n\n\nLuton Town\n11244\n11420\n1.57\n\n\nMiddlesbrough\n29848\n29994\n0.49\n\n\n\n\n\nAnd I have to give a shoutout to Burnley and, indeed, to Vincent Kompany because he certainly galvanised the supporters that season.\nA couple teams really jump out. Both Sunderland and Leicester City moved into new stadia the year after their relegation, and this gave them a considerable bump. They must have been absolutely packing out their stadia the season prior and had supporters banging down the doors to get in. Sunderland even managed to add over 5,000 supporters to their tally the season after relegation, despite the fact that they were still stuck in the Championship. Leicester also increased attendances in 2003-04, by 1,600 to 30,983. But they spent that season in the Premier League, so it’s less startling to see an increase.\nNewcastle also catch the eye, but not just because their 51,106 fans in 2016-17 is an extraordinary number - everyone knows Newcastle is a football-mad city. What’s truly insightful is comparing their two most recent relegations.\n\nAfter relegation in 2009, the club saw a significant 11% drop in average attendance.\nAfter relegation in 2016-17, The club saw a 2.7% increase in attendance.\n\nThat’s 13.7-point swing. The club was massive in both scenarios, so “big club” is a constant. The most obvious variable is “vibes.”\nAt the end of 2008-09 Newcastle’s all-time record goalscorer and local lad Alan Shearer had stepped up to try and save Newcastle. He only had 8 games to do it in. No matter the outcome, he was supposed to stay on as manager into the next season. But they got relegated and he didn’t get offered a contract for the next season. There’s no doubt that this was a low point between Newcastle fans and their owner Mike Ashley. And this was borne out in the 2009-10 attendances.\n2016-17 was the polar opposite. Similar to how Burnley fell under the spell of Vincent Kompany in 2022/23, Newcastle fans had a great relationship with Rafael Benitez, even if Mike Ashley was still as loathed as ever. Benitez was hired towards the end of their 2015/16 relegation season and it was considered quite a coup to attract this Champions League-winning manager to a Championship-bound club. So the fans showed their appreciation during his first full season in charge with record-breaking attendances."
  },
  {
    "objectID": "posts/post-relegation-attendance/index.html#anomalies",
    "href": "posts/post-relegation-attendance/index.html#anomalies",
    "title": "Fair-Weather Fans?",
    "section": "Anomalies",
    "text": "Anomalies\nThose positive stories are, unfortunately, anomalies. And they are not the only ones. A box plot of all post-relegation data (Y+1 and Y+2) shows the wild variance in outcomes.\n\n\n\n\n\nDistribution of attendance change (Y+1 & Y+2) by outcome, including all outliers and sample sizes.\n\n\n\n\nThe plot above clearly shows several extreme statistical outliers (the dots) that are skewing the data. To understand what they are, we can use the 1.5 * IQR rule (the same logic the box plot uses) to print a list of them.\n\nOutlier Hunt Using the 1.5 * IQR Rule\n\n\n\n\n\n\n\nOutcome\nTeam\nSeason\nYear\nChange vs Y0 (%)\n\n\n\n\nSurvived\nSunderland\n1998-99\n2\n+85.7\n\n\nSurvived\nSunderland\n1997-98\n1\n+60.5\n\n\nPromoted\nLeicester City\n2003-04\n2\n+56.2\n\n\nPromoted\nLeicester City\n2002-03\n1\n+47.4\n\n\nPromoted\nBolton Wanderers\n1997-98\n2\n+29.4\n\n\nPromoted\nSunderland\n2007-08\n2\n+27.8\n\n\nPromoted\nFulham\n2019-20\n1\n-25.3\n\n\nPromoted\nHull City\n2015-16\n1\n-27.0\n\n\nPromoted\nBirmingham City\n2008-09\n1\n-27.1\n\n\nSurvived\nWimbledon\n2000-01\n1\n-53.9\n\n\nSurvived\nWimbledon\n2001-02\n2\n-59.4\n\n\n\n\n\n\n\nCase-by-Case Anomaly Handling\nThis list gives us a clear action plan. To understand the true relationship between performance and attendance, we must filter out cases where attendance was driven by external structural factors, not fan behavior.\n\n\n\n\n\n\n\n\n\n\n\nRelegation Event\nYear\nChange\nOutlier Type\nDecision\nReason\n\n\n\n\nSunderland 1996-97\nY+1, Y+2\n+61%, +86%\nStadium Anomaly\nRemove\nMoved to the new, much larger Stadium of Light.\n\n\nLeicester City 2001-02\nY+1, Y+2\n+47%, +56%\nStadium Anomaly\nRemove\nMoved to the new Walkers (King Power) Stadium.\n\n\nBolton Wanderers 1995-96\nY+2\n+29%\nStadium Anomaly\nRemove\nY+2 (1997-98 season) was their first in the new Reebok Stadium.\n\n\nMiddlesbrough 1992-93\nY+1\n-38%\nStadium Anomaly\nRemove\nAttendance nosedived during a stadium rebuild.\n\n\nWimbledon 1999-2000\nY+1, Y+2\n-54%, -59%\nToxicity\nKeep\nTo be continued…\n\n\nHull City 2014-15\nY+1\n-27%\nToxicity\nKeep\nTo be continued…\n\n\nBirmingham City 2007-08\nY+1\n-27%\nToxicity\nKeep\nTo be continued…\n\n\n\nNow, with the data properly filtered, let’s look at the real story.\nAnd we may as well start with that Toxicity factor I mentioned above."
  },
  {
    "objectID": "posts/post-relegation-attendance/index.html#the-toxicity-factor-when-loyalty-snaps-and-when-it-doesnt",
    "href": "posts/post-relegation-attendance/index.html#the-toxicity-factor-when-loyalty-snaps-and-when-it-doesnt",
    "title": "Fair-Weather Fans?",
    "section": "The Toxicity Factor: When Loyalty Snaps (and When It Doesn’t)",
    "text": "The Toxicity Factor: When Loyalty Snaps (and When It Doesn’t)\nOn-pitch performance isn’t the only driver. The data shows that a toxic or broken relationship between a club’s owners and its fans can act as a powerful accelerant for an attendance collapse.\nThese aren’t just “bad vibes”; they are measurable, real-world events:\nHull City (2014-15): The -27% drop in Y+1 wasn’t just about relegation. It directly coincided with a fan mutiny over the owners’ deeply unpopular attempt to rebrand the club as “Hull Tigers.”\nBirmingham City (2007-08): A similar story. Their -27% nosedive in Y+1 was fueled by widespread fan protests calling for the board to resign.\nNewcastle (2009-10 vs. 2016-17): This is the perfect A/B test. In both 2009 and 2016, the club had the same toxic ownership under Mike Ashley.\nIn 2009-10, the vibe was poisonous. The result? A significant 11% drop in attendance.\nIn 2016-17, a different “vibe” won. Hiring (and keeping) Rafa Benitez was such an unexpected coup that his popularity papered over the cracks, galvanizing the fanbase and leading to a 2.7% increase.\nWimbledon (1999-2000): This is the ultimate case study. They were already a “homeless” club, playing at Crystal Palace’s Selhurst Park during their Y0 relegation season. Their baseline attendance was already depressed. When they lost their Premier League status, attendance collapsed by -59%. The showpiece occasion of a Premier League game seems to have been the last thread holding that displaced fanbase together. When it snapped, so did the club."
  },
  {
    "objectID": "posts/post-relegation-attendance/index.html#a-results-business",
    "href": "posts/post-relegation-attendance/index.html#a-results-business",
    "title": "Fair-Weather Fans?",
    "section": "A Results Business",
    "text": "A Results Business\nNext up, we’ll look at our Year_End_Outcome variable. Let’s plot the attendance change over time, grouping teams by whether they were Promoted, Survived, or Relegated in their first post-relegation season.\n\n\n\n\n\nAverage attendance change (anomalies removed) relative to the relegation season (Y0), grouped by the team’s outcome in their first post-relegation season (Y+1).\n\n\n\n\nIrrespective of season outcome, relegated teams on average lose fans. And there seems to be a clear correlation between team performance and attendance. Moreover, it does seem that performance affects attendances.\nPromoted (Green Line): Teams that bounce straight back (like Burnley) see their Y+1 attendance drop minimized to just -8.6%. By Y+2, they are back in the Premier League, and attendance recovers to surpass its pre-relegation level by 2%.\nSurvived (Blue Line): Teams that “survive” and stay in the Championship see a much larger initial drop of -17.2%. Worse, by Y+2, that optimism fades and attendance dwindles further to -21.6%.\nRelegated (Orange Line): Teams that enter freefall and plummet into League 1 see a catastrophic -28% drop in Y+1, which slightly recovers to -24% in Y+2."
  },
  {
    "objectID": "posts/post-relegation-attendance/index.html#would-champagne-football-help",
    "href": "posts/post-relegation-attendance/index.html#would-champagne-football-help",
    "title": "Fair-Weather Fans?",
    "section": "Would champagne football help?",
    "text": "Would champagne football help?\nIf you’re stuck in the Championship, can you at least keep the fans entertained with attacking football?\nTo test this, I’ve plotted Goals_For_Per_Game against the percentage change in attendance for all post-relegation seasons (Y+1 and Y+2), again grouped by the team’s outcome and with the stadium anomalies removed.\n\n\n\n\n\nScatter plots (all structural anomalies removed) showing the relationship between attacking football and the percentage change in attendance.\n\n\n\n\nThe answer seems to be: yes, but only if you have nothing else to play for.\nFor Survived teams, there is a fairly clear positive relationship. If a team is destined for another year of mid-table Championship football, entertainment value (scoring goals) seems to help keep traffic coming through the turnstiles."
  },
  {
    "objectID": "posts/post-relegation-attendance/index.html#conclusions",
    "href": "posts/post-relegation-attendance/index.html#conclusions",
    "title": "Fair-Weather Fans?",
    "section": "Conclusions",
    "text": "Conclusions\n\nTeams can typically expect to lose 16-22% of their attendance after relegation if they don’t bounce straight back, and that drop accelerates in the second year.\nIf you are on track for promotion, losses are minimized to ~8% and attendance fully recovers upon returning to the Premier League.\n“Vibes” (like a popular manager) and “style” (attacking football) seem to be real factors, but their effect is most visible for teams stuck in mid-table, where the on-pitch result isn’t exciting enough on its own.\nAnd if you are on track for League 1, these losses are considerably higher\nRelegation doesn’t automatically mean fan abandonment. Context matters: management, entertainment value, stadium capacity, and hope for promotion all play a role."
  },
  {
    "objectID": "posts/post-relegation-attendance/index.html#sources-1",
    "href": "posts/post-relegation-attendance/index.html#sources-1",
    "title": "Fair-Weather Fans?",
    "section": "Sources:",
    "text": "Sources:\nFjelstul, Joshua C. “The Fjelstul English Football Database v1.1.0.” May 26, 2024. https://www.github.com/jfjelstul/englishfootball\nEuropean-Football-Statistics.co.uk\nThumbnail image courtesy of Jaroslav A. Polák from Brno, Czech Republic, CC0, via Wikimedia Commons"
  },
  {
    "objectID": "posts/strava-gap-metric/index.html",
    "href": "posts/strava-gap-metric/index.html",
    "title": "Grade Adjusted Pace (GAP)",
    "section": "",
    "text": "Disclaimer\n\n\n\nThis article is an independent technical-writing sample created solely for portfolio and demonstration purposes.\nIt is not affiliated with, endorsed by, or produced on behalf of Strava.\nAll explanations of Grade Adjusted Pace (GAP), its behaviour, and its underlying logic are my own interpretations based on publicly available Strava documentation, Strava Engineering blog posts, and the academic research cited in the bibliography below.\nAll datasets, adjustment factors, charts, and code shown here are synthetic examples created by me for illustration only. They should not be interpreted as precise reproductions of Strava’s proprietary data or algorithms.\nCertain stylistic elements—such as layout choices, callout boxes, metadata fields like “Last modified,” and the overall structure—intentionally emulate the conventions of corporate technical blogs and documentation. These are used purely to demonstrate writing style and document design and should not be taken to imply authorship by Strava or access to internal systems.\nLast modified: 17 November 2025\nGrade Adjusted Pace (GAP) estimates how fast you would have run on a flat route even if your run was actually on uphill, downhill or mixed grade terrain. By using GAP, runners can better compare paces across routes that have very different terrain profiles.\nSee also: Pace"
  },
  {
    "objectID": "posts/strava-gap-metric/index.html#where-to-find",
    "href": "posts/strava-gap-metric/index.html#where-to-find",
    "title": "Grade Adjusted Pace (GAP)",
    "section": "Where to find",
    "text": "Where to find\nYou can check your run’s GAP on both the Strava website and the mobile app (Android / iOS). You’ll find it in the following places:\n\n\n\n\n\n\nTo Do\n\n\n\n[Get side-by-side screenshot of the GAP metric on a post-run analysis screen. There would be captions under each image: ‘Mobile View ’on the left, ’Desktop View’ on the right]\n\n\nYour run’s analysis screen lets you evaluate your GAP across your full activity. You can even zoom in on key points for a closer look at your adjusted pace on any particularly nasty uphills.\nYour followers will also be able to view your GAP, so they can see how hard you really worked and give you the compliments you deserve."
  },
  {
    "objectID": "posts/strava-gap-metric/index.html#how-gap-works",
    "href": "posts/strava-gap-metric/index.html#how-gap-works",
    "title": "Grade Adjusted Pace (GAP)",
    "section": "How GAP Works",
    "text": "How GAP Works\nThe GAP model uses two inputs: the grade of the terrain and the pace adjustment factor derived from physiological research.\n\nGrade:\nStrava estimates the grade (steepness) throughout your run by using elevation data.\nSee also: Elevation\nPace Adjustment Factor:\nStrava’s Grade Adjusted Pace formula is based on research published in the Journal of Applied Physiology by Davies [@Davies1974; @Davies1980] and Minetti [@Minetti2002]. Over time, Strava’s engineering team has continued to build upon these studies. Broadly, the conclusions are:\n\nEffort is affected by the direction of steepness. Positive grades increase effort. Negative grades decrease it.\nEffort is affected by the level of steepness. In general, higher levels of steepness have larger effects on effort.\n\nCrucially, however, Strava’s analysis of athlete heart rate data has helped to quantify how much extra effort is expended on uphills or saved on downhills. For example, they found that:\n\nDownhills provide their greatest energy savings and pace increases at grades around -10%. Steeper than this, the positive effects begin to decrease.\n\nAt -18% downhills actually have a negative impact on your pace. This is because of a braking effect where runners must actively slow down.\n\nBy quantifying the relationship between effort and grade, Strava can apply a Pace Adjustment Factor that is based on grade. On perfectly flat 0% grade terrain, this factor will be 1.0.\nThe full range of adjustment factors that Strava applies to grades from -30% to +30% can be seen on this graph:\n\n\n\nCode\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\n# 1. Create the example data\ndata = {\n    'grade_percent': [\n        -30, -25, -20, -18, -15, -10, -9, -5, 0, \n        5, 10, 15, 20, 25, 30\n    ],\n    'adjustment_factor': [\n        1.52, 1.26, 1.06, 1.0, 0.93, 0.88, 0.88, 0.9, 1.0, 1.27, 1.66, 2.13, \n        2.65, 3.2, 3.74\n    ]\n}\n\n# 2. Create a DataFrame\ndf = pd.DataFrame(data)\n\n# 3. Plot\nfig, ax = plt.subplots()\n\nsns.lineplot(\n    data=df,\n    x='grade_percent',\n    y='adjustment_factor',\n    marker='o',  # Add markers for the data points\n    lw=2,        # Line width\n    ax=ax        # Tell seaborn to use our 'ax' object\n)\n\nax.set_ylim(0.5, 4)\nax.set_title('Grade Adjusted Pace Model', fontsize=16)\nax.set_xlabel('Gradient (%)', fontsize=12)\nax.set_ylabel('Pace Adjustment Factor', fontsize=12)\n\n# --- Add a reference line for \"flat\" ---\nax.axhline(\n    y=1.0, \n    color='grey', \n    linestyle='--', \n    lw=1.5\n)\nax.text(-32, 1.02, 'Flat Terrain', color='grey', fontsize=10)\n\n# --- Add callouts for key points ---\nax.annotate('Max downhill benefit occurs\\nat approx. -9%',xy=(-9, 0.88), ha='center', arrowprops=dict(facecolor='black', shrink=0.05), xytext=(-4, 2), fontsize=10, color='black', bbox=dict(boxstyle='round', fc='0.9'))\n\nax.annotate('Braking effect begins \\nat approx. -18%',xy=(-18, 1.0), ha='left', arrowprops=dict(facecolor='black', shrink=0.05), xytext=(-30, 3), fontsize=10, color='black', bbox=dict(boxstyle='round', fc='0.9'))\n\n# --- Final touches ---\nax.grid(True, linestyle=':', alpha=0.7)\n\n# --- Use as thumbnail ---\nfig.savefig(\"featured.png\", facecolor='white')\n\n\n\n\n\n\n\n\nFigure 1: Strava’s GAP model, showing pace adjustment factor vs. grade.\n\n\n\n\n\nTo understand how the graph works, let’s look at the GAP calculations for a 7 minute mile run on a 5% gradient:\n1. Convert minutes/mile to seconds: \\(7 × 60 = 420\\)\n2. Divide by the uphill factor: \\(420 ÷ 1.27 ≈ 331\\)\n3. Convert back to minutes: \\(331 ÷ 60 ≈ 5:31\\)\nThe following table shows GAP values for common paces across different gradients.\n\n\n\nGrade %\nFactor\n6:00 mile\n7:00 mile\n8:00 mile\n\n\n\n\n-7.5\n0.89\n06:45\n07:53\n09:01\n\n\n-5.0\n0.90\n06:40\n07:47\n08:53\n\n\n-2.5\n0.95\n06:19\n07:22\n08:25\n\n\n0.0\n1.00\n06:00\n07:00\n08:00\n\n\n+2.5\n1.14\n05:16\n06:09\n07:01\n\n\n+5.0\n1.27\n04:44\n05:31\n06:18\n\n\n+7.5\n1.47\n04:05\n04:46\n05:27\n\n\n\n\n\n\n\n\n\nNote\n\n\n\nGAP and Pace are identical on flat surfaces"
  },
  {
    "objectID": "posts/strava-gap-metric/index.html#how-to-interpret",
    "href": "posts/strava-gap-metric/index.html#how-to-interpret",
    "title": "Grade Adjusted Pace (GAP)",
    "section": "How to Interpret",
    "text": "How to Interpret\n🔺 SCENARIO 1: You ran a net UPHILL route\n\nAverage Grade: +5.0%\nFactor: 1.27\nPace: 7:00/mile\nGAP: 5:31/mile\n\nYour pace was divided by a factor greater than 1 when you ran on uphill sections. This meant your GAP was faster than your Pace.\n⚡ SCENARIO 2: You ran a net DOWNHILL route\n\nAverage Grade: −5.0%\nFactor: 0.90\nPace: 7:00/mile\nGAP: 7:47/mile\n\nYour pace was divided by a factor less than 1 when you ran on downhill sections. This meant your GAP was slower than your Pace.\n⚖️ SCENARIO 3: You ran a FLAT or BALANCED route\n\nAverage Grade: 0%\nFactor: 1.0\nPace: 7:00/mile\nGAP: 7:00/mile\n\nYour pace was divided by 1 so it didn’t change.\n\n\n\n\n\n\nTip\n\n\n\nAlways check the elevation data. A route with constant ups and downs would be very tiring but could still result in a GAP which appears as if it were flat. For example, the Boston Marathon is notoriously challenging due to its uphill sections but is actually a net downhill course."
  },
  {
    "objectID": "posts/strava-gap-metric/index.html#limitations",
    "href": "posts/strava-gap-metric/index.html#limitations",
    "title": "Grade Adjusted Pace (GAP)",
    "section": "Limitations",
    "text": "Limitations\n\nGAP may indicate that a route was flat when it contained significant uphill and downhill sections.\nGAP does not adjust for the fatigue caused by effort spikes or uneven pacing on undulating terrain.\nGAP does not adjust for any other terrain features or technical difficulties, such as gravel. It only accounts for the gradient.\nGAP does not adjust for the additional stress on joints of downhill running."
  },
  {
    "objectID": "posts/strava-gap-metric/index.html#golden-rules",
    "href": "posts/strava-gap-metric/index.html#golden-rules",
    "title": "Grade Adjusted Pace (GAP)",
    "section": "Golden Rules",
    "text": "Golden Rules\nGAP is a helpful training tool. You can make more accurate assessments of your fitness level by minimising the confusion caused by hilly terrain. Just follow these golden rules to use it properly.\nUse GAP when:\n\nComparing your best 5 km times on different routes\nAssessing fitness trends when you run on varied terrain\nBenchmarking tempo run or interval times on new routes by comparing them to your old or existing routes\nYou have checked the Elevation profile to check if the route is Flat or Balanced\n\nDon’t rely on GAP when:\n\nRunning technical trails\nEvaluating injury risk from downhills\nMeasuring pacing discipline"
  },
  {
    "objectID": "posts/strava-gap-metric/index.html#references",
    "href": "posts/strava-gap-metric/index.html#references",
    "title": "Grade Adjusted Pace (GAP)",
    "section": "References",
    "text": "References\n\nTo Do\n[Fix the quarto bibtex referencing. It’s not working for some reason]"
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html",
    "href": "posts/winner-takes-it-all/index.html",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "",
    "text": "Football credits the taker of a penalty, not the player who won it. That’s why we end up with nicknames like “Penaldo”. A BBC caption - “Misstiano Penaldo” - even went viral after CR7 missed against Slovenia in 2024.\nThis project asks a simple counterfactual:\nWhat would happen if penalties were allocated back to the players who won them? How would that change the way we look at player statlines across seasons, careers or during awards season?\nAnd why not just give them the full goals? Because this is a counterfactual allocation problem, we have to account for the possibility that they would miss. So my made-up metric is Expected Goals from Penalties Won (xGpw), which is currently fixed at 0.757 for every player, though I do plan to tweak this. Explanation of all that to follow.\nSo far, the workflow is:\nThis isn’t intended as a one-off analysis — it’s a pipeline project. Long-term, I plan to transition this pipeline to a paid football API to ensure scalability and commercial compliance. The data I scraped is just for my experimentation with the above workflow. In future, I intend to make a Shiny dashboard that automatically refreshes data, and fully explorable by site visitors. I will periodically publish small vignettes based on my own exploration."
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html#the-question",
    "href": "posts/winner-takes-it-all/index.html#the-question",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "The question",
    "text": "The question\nIf penalties were allocated to the player who won them, how much would goal totals and rankings change?\nThis is not “perfect truth”. It’s a transparent, testable metric you can disagree with—and still use.\nI focus on Premier League-era data where PkWon is tracked (FBref only goes back to 2016/17 for PL data)."
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html#a-simple-metric-xpwg",
    "href": "posts/winner-takes-it-all/index.html#a-simple-metric-xpwg",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "A simple metric: xPwG",
    "text": "A simple metric: xPwG\nDefinitions:\n\nPkWon = penalties won\n\nxPwG = expected goals from penalties the player won\n\nG - PK + xPwG = non-penalty goals + expected goals from penalties won\n\nIn the simplest version:\nxPwG = PkWon × conversion_rate\nThe key idea is conservative allocation:\nreward the player who generated the penalty with an expected-goals value rather than giving them the full “goal” automatically.\n\nWhy not just give them the full goals?\nBecause this is a counterfactual allocation problem: - We don’t know who would take penalties under different rules - xPwG is a conservative way to allocate credit while acknowledging uncertainty"
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html#quick-example-sterling-vs-vardy",
    "href": "posts/winner-takes-it-all/index.html#quick-example-sterling-vs-vardy",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Quick example: Sterling vs Vardy",
    "text": "Quick example: Sterling vs Vardy\nRaheem Sterling is the Premier League’s greatest ever winner of penalties—with 26. But he’s historically bad at converting them (43% success rate vs 78.9% league average). Meanwhile, specialist penalty takers like Steven Gerrard (33 penalties at 80.5%) and Sergio Agüero (27 at 81.8%) took most of the penalties Sterling won.\n\n\n\n\n\n\n\n\n\n\n\n\nPlayer\nPL goals incl. pens\nNon-pen goals\nPkWon\nPK Conversion %\nxPwG\nG-PK+xPwG\n\n\n\n\nVardy\n143\n116\n23\n82\n18.81\n134.81\n\n\nSterling\n123\n120\n26\n43\n11.18\n131.18\n\n\n\n\nKey - PkWon = penalty kicks won\n- xPwG = expected goals from those penalties\n- G-PK+xPwG = non-penalty goals + xPwG\n\nUnder this framework, Sterling jumps from 30th to 16th in all-time PL scoring, while Vardy (who took 4 penalties he didn’t win) drops slightly but holds 15th place.\nThis already hints at the broader point: some players “feast” on penalties others created, while some creators don’t get the credit."
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html#methodology-short-readable",
    "href": "posts/winner-takes-it-all/index.html#methodology-short-readable",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Methodology (short, readable)",
    "text": "Methodology (short, readable)\n\nData\n\nSource: FBref\nScope: PL seasons where PkWon exists (FBref only goes back to 2016/17 for PL PkWon)\n\n\n\nPenalty conversion assumptions\nTo estimate xPwG, I use competition-level conversion rates from my penalty dataset (PL, La Liga, UCL, international shootouts).\n(Keep your conversion-rate tables here.)\n\n\nWhy not just give them the full goals?\nBecause this is a counterfactual allocation problem: - we don’t know who would take penalties under a different rule - so xPwG is a conservative way to allocate credit while acknowledging uncertainty"
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html#dashboard-prototype",
    "href": "posts/winner-takes-it-all/index.html#dashboard-prototype",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Dashboard (prototype)",
    "text": "Dashboard (prototype)\nHere is a small prototype I made in Power Bi.\n\nKnown limitations (current dashboard)\n\nThis can only be filtered to a single-season / single-competition grain as I have encountered issues with my DAX measures.\nCross-filter interactions can be annoying (table clicks affecting cards in ways I don’t want)"
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html#roadmap-pipeline-reliability",
    "href": "posts/winner-takes-it-all/index.html#roadmap-pipeline-reliability",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Roadmap (pipeline + reliability)",
    "text": "Roadmap (pipeline + reliability)\nI’m treating this as a pipeline project, not just a one-off analysis. Here’s the plan:\n\nPhase 1 — Extend coverage (data completeness)\n\nAdd missing competitions (e.g., UCL) via a football API\nStandardize competition + season keys\nSolidify grains like player × team × competition × season\n\n\n\nPhase 2 — Validation + repeatability (data trust)\n\nCross-source checks (API vs scrape): row counts, key uniqueness, spot checks\nData freshness + completeness checks\nDocument metric logic + assumptions clearly (so it’s reviewable)\n\n\n\nPhase 3 — Refresh + product layer (usable outputs)\n\nWeekly refresh cadence (automation + monitoring)\nPublish updated outputs through:\n\nPower BI for now (demo layer), and later a cleaner rebuild (Tableau/Streamlit are candidates),\nplus lightweight “export-friendly” views for ad-hoc questions"
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html#notes-limitations",
    "href": "posts/winner-takes-it-all/index.html#notes-limitations",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Notes / limitations",
    "text": "Notes / limitations\n\nPkWon availability limits historical scope (especially pre-2016/17 for some leagues).\nMetric choices (conversion rates, positional assumptions) are assumptions, not facts.\nThis is meant to be auditable: you can see the logic and disagree with it."
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html#methodology",
    "href": "posts/winner-takes-it-all/index.html#methodology",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Methodology",
    "text": "Methodology\nThe methods for calculating conversion rates for each player and allocating an xPwG get a little more exacting for my actual analysis. All of that awaits in the methodology. And then we’ll be ee who the best players really were from a goal contributions perspective seeing who the best goalscorers really are if if we get rid of ball-snatching penalty-takers.\nNot much to say on the data. It’s the 200 highest-scoring players in the Premier League for 2022/23 and a bunch of goalscoring metrics. It all comes from FBref, and this project is possible because they have a PKwon metric - they log who is responsible for winning each penalty. FBref only has this data for the Premier League as far back as the 2016/17 season. My tally from Raheem Sterling includes earlier years - I guess that data exists somewhere because Opta has an article about it. But I don’t have those numbers. Anyway, for La Liga, FBref have it untl 2015/16.\nI’ve created a metric for this. It’s not catchy, so bear with me.\n\nxPwG\nxPwG, or Expected penalties won leading to goals, needs some unpacking. I have assigned a value of 0.75% to each penalty. Why?\n\nPenalty Conversion Rates\nFor another project - No Fear At That Age - I compiled penalty data from:\n\nEvery normal time penalty taken in the Premier League - in other words, since the 1992/1993 season\nEvery normal time penalty taken in the Champions League since the 1999/2000 season\nEvery normal time penalty taken in La Liga since the 1999/2000 season\n\nFor this project, I am adding: - Every penalty taken in the shootout of a major international tournament.\nInteresting that I have 7 less years from La Liga than the Premier League, but 64 more penalties.\n\nThe club data was taken from FBref while the international shootout data comes from RSSSF\n\n\n\n\nLeague\nTotal Penalties\n\n\n\n\nPremier League\n2892\n\n\nLa Liga\n2956\n\n\nChampions League\n925\n\n\nInt. Shootouts\n1907\n\n\nTotal\n6773\n\n\n\nAnd when it comes to conversion rates, all three leagues are roughly equivalent:\n\n\n\nCompetition\nConversion Rate (%)\n\n\n\n\nClub Comps\n77.99\n\n\nChampions League\n77.19\n\n\nPremier League\n78.84\n\n\nLa Liga\n77.40\n\n\nInt. Shootouts\n73.52\n\n\n\nUnsurprisingly, the international shootouts have worse conversion. Players are more nervous and many penalty takers are non-specialist; i.e. they don’t take penalties for their club sides.\nHypothetically, if this new rule really came into place, then the specialist penalty takers would necessarily be the players who are most likely to win penalties - that is, attacking players. The data backs this up.\nThose players could assume they will win their fair share, whereas defensive players wouldn’t. Specialisation would have to fall in line accordingly. Therefore, I will propose assigning a conversion rate based on player positions. To Do: Get this into SQL so I can join datasets for each year and group by position. In addition, I need to group by position for penalty taking success. Note: I will do a mini dashboard piece about success rate by position.\nUnfortunately, I haven’t added positional data for the datasets I downloaded. For wingers and forwards I will assign a value based on the specialists’ average: - 78%. For everyone else the value will be based on a middle ground between specialists in club comps and the pressure cooker penalty shootout success rate - that middle ground is roughly 75.75%.\nThis means that an attacking midfield or forward player who wins a penalty will be treated a specialist and assigned 0.78 expected goals. Everyone else will get 0.7575 expected goals.\nLet’s take an example. In 2023/24 Anthony Gordon won an extraordinary 6 penalties for Newcastle. As a winger, he gets a 0.78 expected goals value. That means his xPwG is 0.78*6, or 4.68 goals.\nOn the other hand, Jarrad Branthwaite won 1 penalty for Everton. He is a defender, so he gets 0.7575*1 for an xPwG of 0.7575 goals.\n\n\n\nG-PK+xPwg\nIf we now take Anthony Gordon’s non-penalty goals - 11 - and add his xPwG we get his G-PK+xPwg: 11+4.68. If Anthony Gordon took the penalties he won in 2023/24 we could expect him to score 15.68 goals.\nIn my analysis to come, I will also deploy xAG - expected Assists Leading to Goals. This is not a stat of my own invention and it’s a close cousin of expected assists. I will quote the NY Times on this: &gt;“Where expected assists (xA) considers all passes and the probability that they may ultimately lead to a scoring chance, xAG solely focuses on the passes that directly contribute to an expected goal.”\nmake sidebar: Shaq was so bad at shooting when 15 feet from the basket - a little over two Shaq’s laid head to toe to head to toe - that a new tactic was invented: ‘Hack-a-Shaq’. The idea was that if you simply fouled Shaq and put him at the free throw line, he would likely score less points - 1 from his 2 free throw attempts - than if you took the risk of letting the play continue because he’d probably manage to pivot and dunk for 2 points. So, if teams knew Kobe was stepping up with his 83.7% shooting then Shaq would have been hacked a heck of a lot less.\n\n\n\n\n\n⚙️ Upcoming Table Fixes # Feature Description / Action Priority 1 Minutes-weighted fairness rule for unattributed penalties Use player-minutes share to distribute team-level unattributed penalties fairly across players. 🔴 High 2 Revert to assists (no xAG) for 2016/17 Replace xAG values with raw assists in Hall of Fame tables for 2016/17 (xAG not tracked that year). 🟠 Medium 3 SQL short_name column for teams Add short_name field in dimteam to prevent text wrapping for long team names (e.g., “Borussia Mönchengladbach”). 🔴 High 4 Adaptive PKW weighting by conversion rate Weight PKW by player conversion rate (pens_scored / pens_attempted), default 0.757 if no attempts exist. 🟠 Medium\n🚀 Upcoming Features # Feature Description / Action Priority 5 Add UEFA Champions League 24/25 scraping feature Extend scraper to include UCL 2024/25 data and integrate into the main pipeline. 🔴 High 6 Tooltip linking unattributed PKWon info Add hover tooltips linking to unattributed PKWon reference table (superseded by standalone visual). 🟢 Low 7 Reset bookmark (unfiltered state) Configure a Reset button to restore default slicers via bookmarks. 🔴 High 8 Fix Hall of Fame visuals’ row-click response Adjust interactions / DAX filters so Hall of Fame cards ignore table-row selections. 🟠 Medium 9 Conditional formatting for awards Add Ballon d’Or 🟡 and Golden Boy 👦 flags with icon-based formatting (superseded by dedicated award page). 🟢 Low 10 Create and integrate SQL views for Power BI Create 4 SQL views (v_player_team_comp_season, v_player_team_comp, v_player_comp_season, v_player_overall) and link them into Power BI. 🔴 High 11 Standalone visualisations (outside dashboards) Build exportable visuals (trend lines, scatter plots, radar charts) for blog / static use. 🟠 Medium 12 Ballon d’Or comparison page Add a Power BI page comparing Ballon d’Or-winning seasons — metrics for winners, runners-up, and non-winners. 🔴 High 13 Scrape current season data for all comps (CL, PL, La Liga, Serie A, Bundesliga, Ligue 1) 🟠 High 13 Live build for current season (CI/CD) GitHub Actions workflow to run scraper daily, clean / load into DB, and refresh Power BI dataset automatically. 🟠 Medium 14 Fully automated Plotly Dash + embed Long-term goal: Dash app that fetches live data and regenerates visuals automatically — no Power BI refresh needed. 🟠 Medium 15 Re-scrape FBref for np expected goals data and add ratio of npgoals to npxg as calculated column 🟠 High\n🧭 Upcoming Documentation # Feature Description / Action Priority 15 Documentation & rationale layer Add detailed project docs (weighting rules, schema design, analytical logic, Power BI implementation, reproducibility). Includes sections A–E (Weighting Logic, Data Model, Analytical Design, Power BI Implementation, Reproducibility). 🔴 High 16 Pull Request: scraperfc (CL 24/25) Submit a PR to the scraperfc package adding UCL 24/25 support and update documentation accordingly (public-facing technical note). 🟢 Low\n\nv_player_team_comp_season\n\nGrain: one row per Player × Team × Competition × Season (atomic fact). Columns (typical):\nKeys: player_id, team_id, comp_id, season_id\nAdditives: minutes, goals, non_penalty_goals, penalties_won, pens_scored, pens_attempted, xAG, assists …\nOptionally: starts, subs_on, cards_y/r\nNo pre-aggregation other than data cleaning.\nUse in Power BI (pages it facilitates):\nPlayer Season Detail (drill-through from any summary): season-by-season line/table for a player within a team+comp.\nBallon d’Or Comparison page (winner vs runners-up vs notable seasons → needs true per-season rows).\nLeague Defaults Reference (join by comp_id, season_id to show league-season constants).\nAny time series visual (season on X-axis).\nTypical visuals: season table; season KPI strip; per-season trend lines (NPG, PKWon, xAG). Example measures: per-90 (divide by minutes/90), season ranks within comp.\n\nv_player_team_comp\n\nGrain: one row per Player × Team × Competition (aggregated across all seasons). Columns: same additive metrics summed across seasons: SUM(minutes) AS minutes, SUM(goals) AS goals, SUM(non_penalty_goals) AS npg, SUM(penalties_won) AS pkwon, SUM(pens_scored) AS pens_scored, …\nUse in Power BI (pages it facilitates):\nClub Career by Competition (e.g., Aubameyang at Arsenal in EPL vs UCL totals).\nRoll of Honour / “Best Stints” (top multi-season stints by comp).\nTable of Player–Team–Comp combos (clean 1 line per combo; prevents duplicate seasons).\nTypical visuals: tables ranked by NPG, PKWon, Goals; bar charts comparing comps for a player’s stint at a club. Example measures: %GoalsFromPens, NPG + PKWon*rate at stint level.\n\nv_player_comp_season\n\nGrain: one row per Player × Competition × Season (aggregated across teams). Columns: additives summed across teams in that season (handles mid-season transfers): SUM(minutes), SUM(goals), SUM(npg), SUM(pkwon), SUM(pens_scored), …\nUse in Power BI (pages it facilitates):\nSeason Dossiers by Competition (e.g., “Messi in 2018/19 UCL” even if multiple teams; common for players changing clubs).\nBallon d’Or Comparison (winner + runners-up often compared at competition-season level).\nLeague Tables of a Season (top scorers/creators in EPL 2021/22).\nTypical visuals: year slicer + comp slicer → ranked season table; season radar for a single comp. Example measures: season ranks within comp, league-specific unattributed share lookups.\n\nv_player_overall\n\nGrain: one row per Player (career totals across all teams, competitions, seasons). Columns: global sums: SUM(minutes), SUM(goals), SUM(npg), SUM(pkwon), SUM(pens_scored), SUM(xAG), SUM(assists) …\nUse in Power BI (pages it facilitates):\nCareer Leaderboards (global top lists).\nPlayer Finder / Similarity starting point (overall vectors).\nAward Winners Overview (career totals side-by-side).\nTypical visuals: top-N tables, scatter (career NPG vs xAG), profile cards. Example measures: career per-90, career penalty reliance, career conversion."
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html#tldr",
    "href": "posts/winner-takes-it-all/index.html#tldr",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "",
    "text": "Football credits the taker of a penalty, not the player who won it. This project asks a simple counterfactual:\nWhat would goal totals look like if penalties were allocated back to the players who won them—using expected goals rather than automatic “full goals”?\nRight now, this is: - a demo Power BI dashboard over scraped historical data, plus - a roadmap toward a refreshable pipeline for ongoing seasons.\nA teaser that shows why I care: Timo Werner’s 2020/21 Chelsea season looks very different if you treat penalties won as “earned xG” rather than something your teammate cashes in. In this framework, Werner’s non-pen goals + penalties-won xG + assists land surprisingly close to — and in some cuts better than — a modern, penalty-heavy headline season like Cole Palmer 2024/25. (Details below; the point is the framing, not claiming “Werner &gt; Palmer”.)"
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html#what-this-project-is-today",
    "href": "posts/winner-takes-it-all/index.html#what-this-project-is-today",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "What this project is (today)",
    "text": "What this project is (today)\n\nData + pipeline (current state)\nThis isn’t just a one-off analysis—it’s a pipeline project.\nSo far, the workflow is: 1. Bulk scrape FBref season/competition player data\n2. Clean + transform in pandas (consistency checks, joins, derived metrics) 3. Load into PostgreSQL using SQLAlchemy (from pandas → Postgres) 4. Schema work (dimensions/facts + keys so the model is scalable) 5. Publish a demo layer in Power BI (prototype dashboard)\n\n\nPenalty conversion methodology\nTo estimate xPwG, I use competition-level conversion rates from my penalty dataset:\n\n\n\nCompetition\nTotal Penalties\nConversion Rate (%)\n\n\n\n\nPremier League\n2,892\n78.84\n\n\nLa Liga\n2,956\n77.40\n\n\nChampions League\n925\n77.19\n\n\nInt. Shootouts\n1,907\n73.52\n\n\nClub Comps Avg\n6,773\n77.99\n\n\n\nFor this analysis, attacking players (forwards/wingers) get 78% conversion, while others get 75.75% (midpoint between club comps and high-pressure shootouts).\nData sources: Club data from FBref; international shootouts from RSSSF.\n\n\nKnown limitations (current dashboard)\n\nSome views are still single-season / single-competition scoped\nCross-filter interactions can be annoying (table clicks affecting cards in ways I don’t want)\nThe measure surface is large enough that debugging inside Power BI has diminishing returns—a rebuild with a cleaner model is likely"
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html#ongoing-outputs-small-vignettes-regularly",
    "href": "posts/winner-takes-it-all/index.html#ongoing-outputs-small-vignettes-regularly",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Ongoing outputs: small vignettes, regularly",
    "text": "Ongoing outputs: small vignettes, regularly\nThe goal isn’t just a dashboard that updates—it’s a steady stream of small, testable stories pulled from the same underlying data.\nAs the pipeline matures and coverage expands, I’ll publish short vignettes like: - Harry Kane in context: how much of the headline is penalties, and how his non-penalty output compares - Sterling and the record books: where he sits among PL greats under penalty-won allocation - The Shearer/Cole thought experiment: how “penalty credit” shifts rankings (within PkWon limits) - One weird season: a single player-season where penalties (won vs taken) distort the story the most\nEach vignette will link back to the metric definitions and the exact view used, so the logic stays transparent and repeatable."
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html#sidebar-hack-a-shaq-and-why-im-borrowing-from-basketball",
    "href": "posts/winner-takes-it-all/index.html#sidebar-hack-a-shaq-and-why-im-borrowing-from-basketball",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Sidebar: “Hack-a-Shaq” and why I’m borrowing from basketball",
    "text": "Sidebar: “Hack-a-Shaq” and why I’m borrowing from basketball\n\nShaq was so bad at free throws (~52% success rate) that teams started deliberately fouling him (“Hack-a-Shaq”).\nThe logic: two free throws at 52% could be less damaging than letting the play continue and risking an easy dunk.\nFootball can’t copy this mechanic perfectly, but the principle is interesting: the fouled player takes the shot, which naturally ties “chance creation” to “credit”.\nSimilarly, Raheem Sterling and Shaq share a common trait: both are elite at drawing fouls (Sterling: 26 PL penalties won, 4th-most all-time; Shaq: 4th all-time in free throw attempts) but terrible at converting (Sterling: 43%; Shaq: 52%)."
  },
  {
    "objectID": "posts/winner-takes-it-all/index.html#why-this-matters-timo-werner-vs-cole-palmer",
    "href": "posts/winner-takes-it-all/index.html#why-this-matters-timo-werner-vs-cole-palmer",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Why this matters: Timo Werner vs Cole Palmer",
    "text": "Why this matters: Timo Werner vs Cole Palmer\nMuch-maligned throughout his Chelsea career, Timo Werner’s 2020/21 season looks very different when you account for penalties won rather than penalties taken.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPlayer\nSeason\nNPG\nPK Won\nxPwG\nAssists\nTotal Contributions\nMinutes\nMins per Contribution\n\n\n\n\nWerner\n2020/21\n6\n5\n3.79\n8\n17.79\n2,602\n146.2\n\n\nPalmer\n2024/25\n11\n1\n0.76\n8\n19.76\n3,191\n161.5\n\n\n\n\nNote: xPwG uses a 75.7% conversion rate (league average). Palmer’s “real” stats show 138.7 minutes per contribution vs Werner’s 185.9—but this framework narrows that gap significantly.\n\nThe point isn’t “Werner &gt; Palmer.” It’s that penalties won are valuable goal contributions that get credited to someone else. When specialist penalty takers rack up goals from chances they didn’t create, it distorts who actually drove offensive output."
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#what-too-messy-to-melt-means",
    "href": "posts/too-messy-to-melt/index.html#what-too-messy-to-melt-means",
    "title": "Too Messy to Melt",
    "section": "",
    "text": "In pandas (and tidy-data workflows), melt() is the standard tool for reshaping a wide table into a long one.\nIn this project, the original spreadsheet wasn’t just wide — it was inconsistent across season formats, team naming conventions, and placeholder values (e.g., COVID). A naive pd.melt() would have produced incorrect joins and silent errors.\nThis page documents the reproducible reshaping pipeline used to build the final open dataset."
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#overview",
    "href": "posts/too-messy-to-melt/index.html#overview",
    "title": "Too Messy to Melt",
    "section": "Overview",
    "text": "Overview\nThis documentation covers data provenance and the reshaping process that produces a tidy dataset where each Premier League relegation event is represented across a consistent four-season window:\n\nYear -1: Season before relegation\n\nYear 0: Relegation season (Premier League)\n\nYear +1: First post-relegation season\n\nYear +2: Second post-relegation season\n\nA temporary Year +3 is generated programmatically only to determine the Year +2 season outcome (Promoted / Survived / Relegated). After outcome extraction, the Year +3 rows are dropped."
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#data-sources",
    "href": "posts/too-messy-to-melt/index.html#data-sources",
    "title": "Too Messy to Melt",
    "section": "Data sources",
    "text": "Data sources\n\nAttendance data\nAttendance values were manually compiled into an Excel workbook using:\n\nEuropean-Football-Statistics.co.uk (season-level attendances)\n\nBecause COVID-affected seasons are not comparable to normal seasons, I sometimes entered the string value COVID into attendance cells during manual compilation. The pipeline converts these placeholders to missing values (pd.NA) before numeric conversion.\nDownload Relegation Attendance Churn.xlsx\n\n\nLeague position and performance\nLeague tier, final position, and raw season performance totals come from:\n\nThe Fjelstul English Football Database (standings dataset)\nFjelstul, Joshua C. “The Fjelstul English Football Database v1.1.0.” May 26, 2024. https://www.github.com/jfjelstul/englishfootball\n\n\nLicensing note: The Fjelstul database is distributed under CC-BY-SA 4.0. This derived dataset is made available under the same CC BY-SA 4.0 license.\n\n\nPatch file\nThe Fjelstul dataset does not include the 2024/25 season, so I have supplemented it with a patch file (standings24_25.csv) to include the most recent completed season.\n\nDownload standings24_25.csv"
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#inputs-and-outputs",
    "href": "posts/too-messy-to-melt/index.html#inputs-and-outputs",
    "title": "Too Messy to Melt",
    "section": "Inputs and outputs",
    "text": "Inputs and outputs\n\nInputsOutputs\n\n\n\n\n\nFile\nPurpose\n\n\n\n\nRelegation Attendance Churn.xlsx\nWide-format attendance sheet\n\n\nStandings24_25.csv\nPatch file for 24/25 season\n\n\n\n\n\n\n\n\nFile\nPurpose\n\n\n\n\nperfect_tidy_data.csv\nFinal tidy dataset"
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#dataset-design",
    "href": "posts/too-messy-to-melt/index.html#dataset-design",
    "title": "Too Messy to Melt",
    "section": "Dataset design",
    "text": "Dataset design\n\nPrimary identifier: Relegation_Event_ID\nA relegation event is uniquely identified as:\nRelegation_Event_ID = \"{Team} {RelegationSeason}\"\nExample: Burnley 2023-24\nThis identifier is repeated across the four rows representing Year -1 through Year +2."
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#reshaping-pipeline",
    "href": "posts/too-messy-to-melt/index.html#reshaping-pipeline",
    "title": "Too Messy to Melt",
    "section": "Reshaping pipeline",
    "text": "Reshaping pipeline\n\nStep 0: Prerequisites\nimport pandas as pd\nimport numpy as np\n# You may need to install thefuzz\npip install thefuzz\nfrom thefuzz import process\n\n\nStep 1 — Load the wide spreadsheet and clean attendance columns\nWhy: The attendance sheet is wide-format, and attendance values include commas and placeholders (e.g., COVID).\nWhat happens: - Strip commas (e.g., 23,721 → 23721) - Convert COVID and nan placeholders to missing values (pd.NA) - Coerce to numeric\nattendance_cols = [c for c in df_wide.columns if \"Attendance\" in c]\nfor col in attendance_cols:\n    df_wide[col] = df_wide[col].astype(str).str.replace(',', '').replace('COVID', pd.NA).replace('nan', pd.NA)\n    df_wide[col] = pd.to_numeric(df_wide[col], errors='coerce')\n\n\nStep 2 — Load standings data (for auditing + enrichment)\nWhy: Team naming mismatches and season key mismatches can silently break merges. The standings dataset provides a stable reference list of teams and seasons.\nWhat happens: - Load standings.csv - Optionally append standings24_25.csv - Rename and select relevant columns - Coerce numeric columns\ntry:\n    # Load 'season' as string to be safe\n    df_history = pd.read_csv('../../assets/files/datasets/standings.csv', dtype={'season': str})\n\n    # --- Load patch file and combine ---\n    try:\n        df_patch = pd.read_csv('../../assets/files/datasets/standings24_25.csv', dtype={'season': str})\n        # Append patch data to history data\n        df_history = pd.concat([df_history, df_patch], ignore_index=True)\n        print(\"Step 2a: Loaded and applied 'standings24_25.csv'.\")\n    except FileNotFoundError:\n        print(\"Step 2a: 'standings24_25.csv' not found. Skipping patch.\")\n    # --- End new patch logic ---\n\n    print(\"Step 2b: Loaded historical data for auditing.\")\n\n    # Create the cleaned df_positions here for later use\n    df_positions = df_history.rename(columns={\n        'team_name': 'Team',\n        'season': 'Season',\n        'position': 'Position_History',\n        'played': 'Games_Played_History',\n        'wins': 'Wins_History',\n        'goals_for': 'Goals_For_History',\n        'goals_against': 'Goals_Against_History',\n        'points': 'Points_History',\n        'tier': 'Tier_History'\n    })[['Team', 'Season', 'Position_History', 'Games_Played_History', 'Wins_History',\n        'Goals_For_History', 'Goals_Against_History', 'Points_History', 'Tier_History']]\n\n    # Convert new history columns to numeric\n    numeric_cols = ['Position_History', 'Games_Played_History', 'Wins_History',\n                    'Goals_For_History', 'Goals_Against_History', 'Points_History', 'Tier_History']\n    for col in numeric_cols:\n        df_positions[col] = pd.to_numeric(df_positions[col], errors='coerce')\n\n\nStep 3 — Audit team names (fuzzy matching)\nWhy: The manual spreadsheet uses informal names (Man City, Spurs, etc.). The merge requires standardized names.\nWhat happens:\n- Identify team names in attendance sheet that don’t match standings - Propose high-confidence fuzzy matches (&gt;85) - Warn on low-confidence values\nteams_in_wide_df = set(df_wide['Relegated Team'].astype(str).unique())\n    teams_in_history_df = set(df_positions['Team'].astype(str).unique())\n\n    unmatched_teams = teams_in_wide_df.difference(teams_in_history_df)\n\n    # Create an empty map to build automatically\n    auto_team_name_map = {}\n\n    if unmatched_teams:\n        print(\"--- AUDIT: TEAM NAME MISMATCHES FOUND ---\")\n        print(\"The following teams from your file do not match the history file.\")\n        print(\"Attempting to build an automatic mapping...\")\n\n        # Loop through each unique unmatched team and find the best match\n        for team in sorted(unmatched_teams):\n            # process.extractOne returns a tuple: (best_match, score)\n            suggestion = process.extractOne(team, teams_in_history_df)\n\n            # Auto-map spaces, asterisks, and high-confidence matches\n            if suggestion[1] &gt; 85:\n                print(f\"  - Auto-mapping: \\\"{team}\\\" -&gt; \\\"{suggestion[0]}\\\" (Score: {suggestion[1]})\")\n                auto_team_name_map[team] = suggestion[0]\n            else:\n                # Don't map low-confidence or junk data\n                if team not in ['nan', 'TEAM', 'Relegated Team']:\n                    print(\n                        f\"  - WARNING: \\\"{team}\\\" has no confident match. (Best: \\\"{suggestion[0]}\\\" at {suggestion[1]}%)\")\n                    print(f\"    -&gt; Please add a fix for \\\"{team}\\\" to 'manual_overrides_map' in Step 4.\")\n\n        print(\"---------------------------------------------\")\n    else:\n        print(\"--- AUDIT: TEAM NAMES OK ---\")\n        print(\"All team names in your file match the history file.\")\n\nexcept FileNotFoundError:\n    print(\"Error: '../../assets/files/datasets/standings.csv' not found. Skipping audit and enrichment.\")\n    # Create empty dataframes if file not found\n    df_positions = pd.DataFrame(columns=['Team', 'Season', 'Position_History', 'Games_Played_History',\n                                         'Wins_History', 'Goals_For_History', 'Goals_Against_History',\n                                         'Points_History', 'Tier_History'])\n    auto_team_name_map = {}\n\n\nStep 4 — Standardize team names (auto-map + manual overrides)\nWhy: Fuzzy matching is helpful but not perfect; known edge cases are fixed with manual overrides.\nWhat happens: - Merge the auto-map and manual overrides\n- Replace names in the wide spreadsheet\n- Filter out remaining junk/unmapped rows\nmanual_overrides_map = {\n    \"Man Utd\": \"Manchester United\",\n    \"Man City\": \"Manchester City\",\n    \"Spurs\": \"Tottenham Hotspur\",\n    \"QPR\": \"Queens Park Rangers\",\n    \"Wolves\": \"Wolverhampton Wanderers\",\n    \"Sheff Utd\": \"Sheffield United\",\n    \"Sheff Wed\": \"Sheffield Wednesday\",\n    \"Nott'm Forest\": \"Nottingham Forest\",\n    \"Notts County\": \"Nottingham Forest\"\n    # e.g., if audit warns about \"Bradford\", add:\n    # \"Bradford\": \"Bradford City\",\n}\n# Combine the auto-generated map with the manual overrides\n# This is where we combine the two dictionaries.\n# The 'manual_overrides_map' will overwrite any conflicting keys from 'auto_team_name_map'.\nfinal_team_map = {**auto_team_name_map, **manual_overrides_map}\n\ndf_wide['Relegated Team'] = df_wide['Relegated Team'].replace(final_team_map)\nprint(\"Step 4: Standardized 'Relegated Team' names using auto-mapping and manual overrides.\")\n# --- 4.5. FILTERING STEP ---\n# Now that names are mapped, we can filter out junk rows that didn't get mapped\nteams_in_history_df = set(df_positions['Team'].astype(str).unique())\ndf_wide = df_wide[df_wide['Relegated Team'].isin(teams_in_history_df)]\nprint(\"Step 4.5: Filtered out junk rows (e.g., 'nan', 'TEAM').\")\n\n\nStep 5 — Create a stable event key (Relegation_Event_ID)\nWhy: Each relegation event needs a stable identifier across Year -1..+2.\ndf_wide['Relegation_Event_ID'] = df_wide['Relegated Team'] + ' ' + df_wide['Season']\nprint(\"Step 5: Created 'Relegation_Event_ID'.\")\n\n\nStep 6 — Convert wide → tidy (safe slices + concat)\nWhy: The attendance sheet is wide and not safely meltable without careful column mapping.\nWhat happens:\n- Create four normalized slices (Year -1..+2)\n- Concatenate into one long table with a consistent schema\n## Helper function to create each slice\ndef make_slice(df, team_col, season_col, att_col, year_vs):\n    # --- Check if att_col exists, otherwise use pd.NA ---\n    # This makes the function robust for the missing Y3 attendance\n    if att_col not in df.columns:\n        # Create a temporary column of NAs if the attendance col doesn't exist\n        df = df.assign(Attendance_tmp=pd.NA) \n    else:\n        # If the col *does* exist, rename it\n        df = df.rename(columns={att_col: \"Attendance_tmp\"})\n        \n    slice_df = df.rename(columns={\n        team_col: \"Team\",\n        season_col: \"Season_tmp\"\n    }).assign(Year_vs_Relegation=year_vs)\n\n    # Select and rename final columns\n    slice_df = slice_df[['Relegation_Event_ID', 'Team', 'Season_tmp', 'Attendance_tmp', 'Year_vs_Relegation']].copy()\n    slice_df.columns = ['Relegation_Event_ID', 'Team', 'Season', 'Attendance', 'Year_vs_Relegation']\n\n    return slice_df\n\n# Create slices (Only up to Year 2)\nslice_minus1 = make_slice(df_wide, \"Relegated Team\", \"Year Before\", \"Year Before Att\", -1)\nslice_0      = make_slice(df_wide, \"Relegated Team\", \"Season\", \"Attendance\", 0)\nslice_1      = make_slice(df_wide, \"Relegated Team\", \"Year After\", \"Attendance year after\", 1)\nslice_2      = make_slice(df_wide, \"Relegated Team\", \"2 years after\", \"Attendance 2 years after\", 2)\n\n# Concatenate slices safely\ndf_tidy = pd.concat([slice_minus1, slice_0, slice_1, slice_2], ignore_index=True)\n\nprint(\"Step 6: Data has been 'tidied' successfully!\")\n\n\nStep 7 — Standardize season keys (YYYY-YY)\n\nWhy: Season formats vary (e.g., 1991-1992 vs 1992-93) and must align for joins.\n\n# --- HELPER FUNCTION 1 ---\ndef format_season(season_str):\n    \"\"\"Converts '1991-1992' to '1991-92' and leaves '1992-93' as is.\"\"\"\n    if pd.isna(season_str):\n        return pd.NA\n    parts = str(season_str).split('-')\n    if len(parts) == 2:\n        if len(parts[1]) == 4:  # Format is '1991-1992'\n            return f\"{parts[0]}-{parts[1][-2:]}\"\n        else:  # Format is '1992-93'\n            return season_str\n    return season_str  # Return as-is if not in expected format\n\n# --- HELPER FUNCTION 2 ---\ndef increment_season(season_str):\n    \"\"\"Converts a season string like '1995-96' to '1996-97'.\"\"\"\n    if pd.isna(season_str):\n        return pd.NA\n    try:\n        start_year = int(season_str.split('-')[0])\n        next_start_year = start_year + 1\n        \n        # Handle the '1999-00' case\n        if next_start_year == 1999:\n            return \"1999-00\"\n        \n        next_end_year_short = str(next_start_year + 1)[-2:] # e.g., 97\n        return f\"{next_start_year}-{next_end_year_short}\"\n    except Exception as e:\n        print(f\"Error incrementing season '{season_str}': {e}\")\n        return pd.NA\n\n# Apply the formatting\ndf_tidy['Season'] = df_tidy['Season'].apply(format_season)\nprint(\"Step 7: Standardized 'Season' key to 'YYYY-YY' format (e.g., '1992-93').\")\n\n\nStep 7.5 — Temporary Year +3 rows (outcome extraction only)\nWhy: To compute the outcome of Year +2, we need to observe the next season’s tier transition.\nprint(\"Step 7.5: Generating temporary Year 3 rows for outcome calculation...\")\n\n# 1. Find all Year 2 rows\ndf_y2_rows = df_tidy[df_tidy['Year_vs_Relegation'] == 2].copy()\n\n# 2. Transform them into Year 3 rows\ndf_y2_rows['Year_vs_Relegation'] = 3\ndf_y2_rows['Attendance'] = pd.NA # Attendance data is not needed\ndf_y2_rows['Season'] = df_y2_rows['Season'].apply(increment_season)\n\n# 3. Concatenate these helper rows back onto the main tidy dataframe\ndf_tidy = pd.concat([df_tidy, df_y2_rows], ignore_index=True)\nprint(\"Step 7.5: Temporary Year 3 rows created and added.\")\n\n\nStep 8 — Enrich tidy data with standings (raw totals)\nWhy: Add tier, position, and season totals for later analysis while keeping this dataset “raw”.\nif not df_positions.empty:\n    # --- Upgrade the history file's 'Season' column ---\n    season_numeric = pd.to_numeric(df_positions['Season'], errors='coerce').dropna()\n    season_end_year = (season_numeric + 1).astype(int).astype(str).str.zfill(4).str[-2:]\n    df_positions.loc[season_numeric.index, 'Season'] = season_numeric.astype(int).astype(str) + '-' + season_end_year\n    print(\"Step 8a: Upgraded history file 'Season' key.\")\n\n    # --- MODIFICATION ---\n    # We are NO LONGER calculating per-game metrics here.\n    # We are ONLY merging the raw values.\n    df_positions_merge = df_positions[[\n        'Team', 'Season', 'Position_History', 'Tier_History',\n        'Games_Played_History', 'Wins_History', 'Goals_For_History', \n        'Goals_Against_History', 'Points_History'\n    ]]\n    # --- END MODIFICATION ---\n\n    # --- Merge the data ---\n    print(\"Step 8b: Merging tidy data with position data...\")\n    df_final = pd.merge(\n        df_tidy,\n        df_positions_merge,  # Use the merge-ready dataframe with raw columns\n        on=['Team', 'Season'],\n        how='left'\n    )\n    df_final['Position'] = df_final['Position_History']\n    df_final['Tier'] = df_final['Tier_History']\n    print(\"Step 8: Data enriched. 'df_final' created and 'Tier' column added.\")\n\nelse:\n    print(\"Step 8: Skipping merge as 'standings.csv' was not loaded.\")\n    df_final = df_tidy.copy() \n    # Add empty columns\n    for col in ['Position', 'Tier', 'Games_Played_History', 'Wins_History', 'Goals_For_History', 'Goals_Against_History', 'Points_History']:\n        df_final[col] = pd.NA\n\n\nStep 8.5 — Compute Year_End_Outcome from tier transitions\nWhy: Outcomes (Promoted/Survived/Relegated) are derived from how tier changes year-to-year within each event.\nprint(\"Step 8.5: Calculating 'Year_End_Outcome' based on precise timeline...\")\n\n# 1. Calculate the Tier Change (Tier_Next_Year - Tier_Current_Year)\ndf_final['Tier_Next_Year'] = df_final.groupby('Relegation_Event_ID')['Tier'].shift(-1)\ndf_final['Tier_Change'] = df_final['Tier_Next_Year'] - df_final['Tier']\n\n# 2. Map the Tier Change to the Outcome Label\ndef map_tier_change_to_outcome(row):\n    \"\"\"Maps the outcome based on the user's exact timeline definition.\"\"\"\n    \n    year_vs_relegation = row['Year_vs_Relegation'] \n    current_tier = row['Tier']\n    tier_change = row['Tier_Change']\n\n    # --- 1. Handle Year -1 (Based on CURRENT Tier) ---\n    if year_vs_relegation == -1:\n        if current_tier == 1:\n            return 'Survived'\n        if current_tier == 2:\n            return 'Promoted'\n        return pd.NA\n\n    # --- 2. Handle Year 0 (The Relegation Event) ---\n    if year_vs_relegation == 0:\n        return 'Relegated'\n\n    # --- 3. Handle Year +1 and +2 (Based on TIER CHANGE) ---\n    if year_vs_relegation in [1, 2]:\n        if pd.isna(tier_change):\n            return pd.NA \n        \n        if tier_change == -1:\n            return 'Promoted'\n        if tier_change == 0:\n            return 'Survived'\n        if tier_change == 1:\n            return 'Relegated'\n        \n        return pd.NA\n\n    return pd.NA # Catches Y3 row\n\n# Apply the function\ndf_final['Year_End_Outcome'] = df_final.apply(map_tier_change_to_outcome, axis=1)\nprint(\"Step 8.5: 'Year_End_Outcome' column successfully created.\")\n\n\nStep 9 — Finalize schema and export\nWhat happens:\n- Cast numeric fields to nullable integers\n- Drop helper Year +3 rows\n- Select final column set and sort\n- Write perfect_tidy_data.csv\nprint(\"Step 9: Polishing final data...\")\n\n# --- MODIFICATION: Added all _History columns ---\nfinal_columns = [\n    'Relegation_Event_ID', 'Team', 'Season', 'Tier',\n    'Position', 'Attendance', 'Year_vs_Relegation', 'Year_End_Outcome',\n    'Games_Played_History', 'Wins_History', 'Goals_For_History', \n    'Goals_Against_History', 'Points_History'\n]\n# --- END MODIFICATION ---\n\n# Ensure final columns exist before slicing\nfor col in final_columns:\n    if col not in df_final.columns:\n        df_final[col] = pd.NA\n\n# --- MODIFICATION: Cast all numeric columns to Int64 ---\nfor col in ['Attendance', 'Position', 'Tier', 'Games_Played_History', 'Wins_History', 'Goals_For_History', 'Goals_Against_History', 'Points_History']:\n    df_final[col] = pd.to_numeric(df_final[col], errors='coerce').astype('Int64')\n# --- END MODIFICATION ---\n\n# --- DROP THE HELPER ROW ---\ndf_final = df_final[df_final['Year_vs_Relegation'] != 3].copy()\n\n# Keep only the final columns and sort\ndf_final = df_final[final_columns].sort_values(by=['Relegation_Event_ID', 'Year_vs_Relegation'])\n\n# Save the final, perfect data to a new CSV in the 'datasets' folder\noutput_path = \"../../assets/files/datasets/perfect_tidy_data.csv\"\ndf_final.to_csv(output_path, index=False)\nimport os\nprint(f\"Step 9: Success! Final table saved to '{output_path}'\")\n#| output: false"
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#from-tidy-data-to-analysis-ready-tables",
    "href": "posts/too-messy-to-melt/index.html#from-tidy-data-to-analysis-ready-tables",
    "title": "Too Messy to Melt",
    "section": "From tidy data to analysis-ready tables",
    "text": "From tidy data to analysis-ready tables\nWhile that completes the reshaping pipeline, further steps are needed to prepare the data for analysis and visualization.\nprint(\"--- PREPARING DATA FOR ANALYSIS ---\")\n# --- ANALYSIS PREP ---\n# This block creates the 'df_plot' DataFrame for all visualizations\n# 1. Get the baseline attendance (Year 0) for each event\ndf_y0_baseline = df_final[\n    df_final['Year_vs_Relegation'] == 0\n][['Relegation_Event_ID', 'Attendance']].rename(columns={'Attendance': 'Attendance_Y0_Baseline'})\n\n# 2. Merge this baseline back onto the main df\ndf_plot = pd.merge(df_final, df_y0_baseline, on='Relegation_Event_ID', how='left')\n\n# 3. Calculate the Pct Change vs. Year 0 for all years\ndf_plot['Pct_Change_vs_Y0'] = (\n    (df_plot['Attendance'] - df_plot['Attendance_Y0_Baseline']) / \n    df_plot['Attendance_Y0_Baseline']\n)\n\n# 4. Get the *key outcome* from Year 1 (the first post-relegation season)\ndf_y1_outcome = df_final[\n    df_final['Year_vs_Relegation'] == 1\n][['Relegation_Event_ID', 'Year_End_Outcome']].rename(columns={'Year_End_Outcome': 'Outcome_Group'})\n\n# 5. Merge this outcome group onto the whole plot dataset\ndf_plot = pd.merge(df_plot, df_y1_outcome, on='Relegation_Event_ID', how='left')\n\n\n# 5.5: IMPUTE 2024-25 OUTCOMES ---\n# The Y+1 outcome for the 2023-24 cohort is NA. We impute it manually.\nprint(\"Imputing outcomes for 2023-24 cohort...\")\n\n# Define our imputations based on likely 2024-25 season-end performance\nimpute_map = {\n    'Burnley 2023-24': 'Promoted',\n    'Sheffield United 2023-24': 'Survived', # Assuming playoffs = Survived\n    'Luton Town 2023-24': 'Relegated'\n}\n\n# Apply the imputation\n# This finds rows where Outcome_Group is NA and maps the Event ID to our new value\ndf_plot['Outcome_Group'] = df_plot['Outcome_Group'].fillna(\n    df_plot['Relegation_Event_ID'].map(impute_map)\n)\nprint(\"Imputation complete.\")\n\n# 6. Convert Pct_Change to a percentage number (e.g., 0.05 -&gt; 5)\ndf_plot['Pct_Change_vs_Y0_Display'] = df_plot['Pct_Change_vs_Y0'] * 100\n\n# 7. Calculate Per-Game metrics on the fly\ndf_plot['Goals_For_Per_Game'] = df_plot['Goals_For_History'] / df_plot['Games_Played_History']\ndf_plot['Points_Per_Game'] = df_plot['Points_History'] / df_plot['Games_Played_History']\n\n# 8. Define the FINAL anomaly list\n# We are KEEPING Wimbledon, as it's a valid case study.\nanomaly_events = [\n    'Middlesbrough 1992-93', # Rebuild\n    'Sunderland 1996-97',    # New stadium\n    'Leicester City 2001-02', # New stadium\n    'Bolton Wanderers 1995-96'  # New stadium (in Y+2)\n]\n\n# 9. Create the FINAL filtered DataFrame for plotting\ndf_plot_filtered = df_plot[~df_plot['Relegation_Event_ID'].isin(anomaly_events)]\nprint(f\"Removed {len(df_plot) - len(df_plot_filtered)} total data points for structural anomalies.\")\n\n# 10. Create the cleaner plot labels\nlabel_map = {\n    'Promoted': 'Promoted (Back in PL)',\n    'Survived': 'Survived (Still in Champ)',\n    'Relegated': 'Relegated (Down to L1)'\n}\ndf_plot['Plot_Group_Label'] = df_plot['Outcome_Group'].map(label_map)\ndf_plot_filtered['Plot_Group_Label'] = df_plot_filtered['Outcome_Group'].map(label_map)\n\nprint(\"--- Analysis data is ready. ---\")"
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#introduction",
    "href": "posts/too-messy-to-melt/index.html#introduction",
    "title": "Too Messy to Melt",
    "section": "",
    "text": "In pandas (and tidy-data workflows), melt() is the standard tool for reshaping a wide table into a long one.\nIn this project, the original spreadsheet (see below) wasn’t just wide — it was inconsistent across season formats, team naming conventions, and placeholder values (e.g., COVID). A naive pd.melt() would have produced incorrect joins and silent errors.\n\n\n\nUnusably messy attendance spreadsheet\n\n\nThis page documents the reproducible reshaping pipeline used to build the final open dataset.\nThe final output of this process is the perfect_tidy_data.csv file. Read on to learn more about its structure, contents and composition or simply Download perfect_tidy_data.csv. The CSV becomes an analysis-ready Python DataFrame after some further enrichment - see the final code block for details."
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#analysis-prep-script",
    "href": "posts/too-messy-to-melt/index.html#analysis-prep-script",
    "title": "Too Messy to Melt",
    "section": "Analysis prep script",
    "text": "Analysis prep script\n## From tidy data to analysis-ready tables\nprint(\"--- PREPARING DATA FOR ANALYSIS ---\")\n\n# --- ANALYSIS PREP ---\n# This block creates the 'df_plot' DataFrame for all visualizations\n# 1. Get the baseline attendance (Year 0) for each event\ndf_y0_baseline = df_final[\n    df_final['Year_vs_Relegation'] == 0\n][['Relegation_Event_ID', 'Attendance']].rename(columns={'Attendance': 'Attendance_Y0_Baseline'})\n\n# 2. Merge this baseline back onto the main df\ndf_plot = pd.merge(df_final, df_y0_baseline, on='Relegation_Event_ID', how='left')\n\n# 3. Calculate the Pct Change vs. Year 0 for all years\ndf_plot['Pct_Change_vs_Y0'] = (\n    (df_plot['Attendance'] - df_plot['Attendance_Y0_Baseline']) / \n    df_plot['Attendance_Y0_Baseline']\n)\n\n# 4. Get the *key outcome* from Year 1 (the first post-relegation season)\ndf_y1_outcome = df_final[\n    df_final['Year_vs_Relegation'] == 1\n][['Relegation_Event_ID', 'Year_End_Outcome']].rename(columns={'Year_End_Outcome': 'Outcome_Group'})\n\n# 5. Merge this outcome group onto the whole plot dataset\ndf_plot = pd.merge(df_plot, df_y1_outcome, on='Relegation_Event_ID', how='left')\n\n\n# 5.5: IMPUTE 2024-25 OUTCOMES ---\n# The Y+1 outcome for the 2023-24 cohort is NA. We impute it manually.\nprint(\"Imputing outcomes for 2023-24 cohort...\")\n\n# Define our imputations based on likely 2024-25 season-end performance\nimpute_map = {\n    'Burnley 2023-24': 'Promoted',\n    'Sheffield United 2023-24': 'Survived', # Assuming playoffs = Survived\n    'Luton Town 2023-24': 'Relegated'\n}\n\n# Apply the imputation\n# This finds rows where Outcome_Group is NA and maps the Event ID to our new value\ndf_plot['Outcome_Group'] = df_plot['Outcome_Group'].fillna(\n    df_plot['Relegation_Event_ID'].map(impute_map)\n)\nprint(\"Imputation complete.\")\n\n# 6. Convert Pct_Change to a percentage number (e.g., 0.05 -&gt; 5)\ndf_plot['Pct_Change_vs_Y0_Display'] = df_plot['Pct_Change_vs_Y0'] * 100\n\n# 7. Calculate Per-Game metrics on the fly\ndf_plot['Goals_For_Per_Game'] = df_plot['Goals_For_History'] / df_plot['Games_Played_History']\ndf_plot['Points_Per_Game'] = df_plot['Points_History'] / df_plot['Games_Played_History']\n\n# 8. Define the FINAL anomaly list\n# We are KEEPING Wimbledon, as it's a valid case study.\nanomaly_events = [\n    'Middlesbrough 1992-93', # Rebuild\n    'Sunderland 1996-97',    # New stadium\n    'Leicester City 2001-02', # New stadium\n    'Bolton Wanderers 1995-96'  # New stadium (in Y+2)\n]\n\n# 9. Create the FINAL filtered DataFrame for plotting\ndf_plot_filtered = df_plot[~df_plot['Relegation_Event_ID'].isin(anomaly_events)]\nprint(f\"Removed {len(df_plot) - len(df_plot_filtered)} total data points for structural anomalies.\")\n\n# 10. Create the cleaner plot labels\nlabel_map = {\n    'Promoted': 'Promoted (Back in PL)',\n    'Survived': 'Survived (Still in Champ)',\n    'Relegated': 'Relegated (Down to L1)'\n}\ndf_plot['Plot_Group_Label'] = df_plot['Outcome_Group'].map(label_map)\ndf_plot_filtered['Plot_Group_Label'] = df_plot_filtered['Outcome_Group'].map(label_map)\n\nprint(\"--- Analysis data is ready. ---\")"
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#full-copy-paste-csv-creation-script",
    "href": "posts/too-messy-to-melt/index.html#full-copy-paste-csv-creation-script",
    "title": "Too Messy to Melt",
    "section": "Full copy-paste CSV creation script",
    "text": "Full copy-paste CSV creation script\nimport pandas as pd\nimport numpy as np\n### You may need to install thefuzz\npip install thefuzz\nfrom thefuzz import process\n\n### Step 1 — Load the wide spreadsheet and clean attendance columns\n\nattendance_cols = [c for c in df_wide.columns if \"Attendance\" in c]\nfor col in attendance_cols:\n    df_wide[col] = df_wide[col].astype(str).str.replace(',', '').replace('COVID', pd.NA).replace('nan', pd.NA)\n    df_wide[col] = pd.to_numeric(df_wide[col], errors='coerce')\n\n### Step 2 — Load standings data (for auditing + enrichment)\n\ntry:\n    # Load 'season' as string to be safe\n    df_history = pd.read_csv('../../assets/files/datasets/standings.csv', dtype={'season': str})\n\n    # --- Load patch file and combine ---\n    try:\n        df_patch = pd.read_csv('../../assets/files/datasets/standings24_25.csv', dtype={'season': str})\n        # Append patch data to history data\n        df_history = pd.concat([df_history, df_patch], ignore_index=True)\n        print(\"Step 2a: Loaded and applied 'standings24_25.csv'.\")\n    except FileNotFoundError:\n        print(\"Step 2a: 'standings24_25.csv' not found. Skipping patch.\")\n    # --- End new patch logic ---\n\n    print(\"Step 2b: Loaded historical data for auditing.\")\n\n    # Create the cleaned df_positions here for later use\n    df_positions = df_history.rename(columns={\n        'team_name': 'Team',\n        'season': 'Season',\n        'position': 'Position_History',\n        'played': 'Games_Played_History',\n        'wins': 'Wins_History',\n        'goals_for': 'Goals_For_History',\n        'goals_against': 'Goals_Against_History',\n        'points': 'Points_History',\n        'tier': 'Tier_History'\n    })[['Team', 'Season', 'Position_History', 'Games_Played_History', 'Wins_History',\n        'Goals_For_History', 'Goals_Against_History', 'Points_History', 'Tier_History']]\n\n    # Convert new history columns to numeric\n    numeric_cols = ['Position_History', 'Games_Played_History', 'Wins_History',\n                    'Goals_For_History', 'Goals_Against_History', 'Points_History', 'Tier_History']\n    for col in numeric_cols:\n        df_positions[col] = pd.to_numeric(df_positions[col], errors='coerce')\n\n### Step 3 — Audit team names (fuzzy matching)\n\nteams_in_wide_df = set(df_wide['Relegated Team'].astype(str).unique())\n    teams_in_history_df = set(df_positions['Team'].astype(str).unique())\n\n    unmatched_teams = teams_in_wide_df.difference(teams_in_history_df)\n\n    # Create an empty map to build automatically\n    auto_team_name_map = {}\n\n    if unmatched_teams:\n        print(\"--- AUDIT: TEAM NAME MISMATCHES FOUND ---\")\n        print(\"The following teams from your file do not match the history file.\")\n        print(\"Attempting to build an automatic mapping...\")\n\n        # Loop through each unique unmatched team and find the best match\n        for team in sorted(unmatched_teams):\n            # process.extractOne returns a tuple: (best_match, score)\n            suggestion = process.extractOne(team, teams_in_history_df)\n\n            # Auto-map spaces, asterisks, and high-confidence matches\n            if suggestion[1] &gt; 85:\n                print(f\"  - Auto-mapping: \\\"{team}\\\" -&gt; \\\"{suggestion[0]}\\\" (Score: {suggestion[1]})\")\n                auto_team_name_map[team] = suggestion[0]\n            else:\n                # Don't map low-confidence or junk data\n                if team not in ['nan', 'TEAM', 'Relegated Team']:\n                    print(\n                        f\"  - WARNING: \\\"{team}\\\" has no confident match. (Best: \\\"{suggestion[0]}\\\" at {suggestion[1]}%)\")\n                    print(f\"    -&gt; Please add a fix for \\\"{team}\\\" to 'manual_overrides_map' in Step 4.\")\n\n        print(\"---------------------------------------------\")\n    else:\n        print(\"--- AUDIT: TEAM NAMES OK ---\")\n        print(\"All team names in your file match the history file.\")\n\nexcept FileNotFoundError:\n    print(\"Error: '../../assets/files/datasets/standings.csv' not found. Skipping audit and enrichment.\")\n    # Create empty dataframes if file not found\n    df_positions = pd.DataFrame(columns=['Team', 'Season', 'Position_History', 'Games_Played_History',\n                                         'Wins_History', 'Goals_For_History', 'Goals_Against_History',\n                                         'Points_History', 'Tier_History'])\n    auto_team_name_map = {}\n\n### Step 4 — Standardize team names (auto-map + manual overrides)\n\nmanual_overrides_map = {\n    \"Man Utd\": \"Manchester United\",\n    \"Man City\": \"Manchester City\",\n    \"Spurs\": \"Tottenham Hotspur\",\n    \"QPR\": \"Queens Park Rangers\",\n    \"Wolves\": \"Wolverhampton Wanderers\",\n    \"Sheff Utd\": \"Sheffield United\",\n    \"Sheff Wed\": \"Sheffield Wednesday\",\n    \"Nott'm Forest\": \"Nottingham Forest\",\n    \"Notts County\": \"Nottingham Forest\"\n    # e.g., if audit warns about \"Bradford\", add:\n    # \"Bradford\": \"Bradford City\",\n}\n# Combine the auto-generated map with the manual overrides\n# This is where we combine the two dictionaries.\n# The 'manual_overrides_map' will overwrite any conflicting keys from 'auto_team_name_map'.\nfinal_team_map = {**auto_team_name_map, **manual_overrides_map}\n\ndf_wide['Relegated Team'] = df_wide['Relegated Team'].replace(final_team_map)\nprint(\"Step 4: Standardized 'Relegated Team' names using auto-mapping and manual overrides.\")\n# --- 4.5. FILTERING STEP ---\n# Now that names are mapped, we can filter out junk rows that didn't get mapped\nteams_in_history_df = set(df_positions['Team'].astype(str).unique())\ndf_wide = df_wide[df_wide['Relegated Team'].isin(teams_in_history_df)]\nprint(\"Step 4.5: Filtered out junk rows (e.g., 'nan', 'TEAM').\")\n\n### Step 5 — Create a stable event key (Relegation_Event_ID)\n\ndf_wide['Relegation_Event_ID'] = df_wide['Relegated Team'] + ' ' + df_wide['Season']\nprint(\"Step 5: Created 'Relegation_Event_ID'.\")\n\n### Step 6 — Convert wide → tidy (safe slices + concat)\n\n## Helper function to create each slice\ndef make_slice(df, team_col, season_col, att_col, year_vs):\n    # --- Check if att_col exists, otherwise use pd.NA ---\n    # This makes the function robust for the missing Y3 attendance\n    if att_col not in df.columns:\n        # Create a temporary column of NAs if the attendance col doesn't exist\n        df = df.assign(Attendance_tmp=pd.NA) \n    else:\n        # If the col *does* exist, rename it\n        df = df.rename(columns={att_col: \"Attendance_tmp\"})\n        \n    slice_df = df.rename(columns={\n        team_col: \"Team\",\n        season_col: \"Season_tmp\"\n    }).assign(Year_vs_Relegation=year_vs)\n\n    # Select and rename final columns\n    slice_df = slice_df[['Relegation_Event_ID', 'Team', 'Season_tmp', 'Attendance_tmp', 'Year_vs_Relegation']].copy()\n    slice_df.columns = ['Relegation_Event_ID', 'Team', 'Season', 'Attendance', 'Year_vs_Relegation']\n\n    return slice_df\n\n# Create slices (Only up to Year 2)\nslice_minus1 = make_slice(df_wide, \"Relegated Team\", \"Year Before\", \"Year Before Att\", -1)\nslice_0      = make_slice(df_wide, \"Relegated Team\", \"Season\", \"Attendance\", 0)\nslice_1      = make_slice(df_wide, \"Relegated Team\", \"Year After\", \"Attendance year after\", 1)\nslice_2      = make_slice(df_wide, \"Relegated Team\", \"2 years after\", \"Attendance 2 years after\", 2)\n\n# Concatenate slices safely\ndf_tidy = pd.concat([slice_minus1, slice_0, slice_1, slice_2], ignore_index=True)\n\nprint(\"Step 6: Data has been 'tidied' successfully!\")\n\n### Step 7 — Standardize season keys (YYYY-YY)\n\n# --- HELPER FUNCTION 1 ---\ndef format_season(season_str):\n    \"\"\"Converts '1991-1992' to '1991-92' and leaves '1992-93' as is.\"\"\"\n    if pd.isna(season_str):\n        return pd.NA\n    parts = str(season_str).split('-')\n    if len(parts) == 2:\n        if len(parts[1]) == 4:  # Format is '1991-1992'\n            return f\"{parts[0]}-{parts[1][-2:]}\"\n        else:  # Format is '1992-93'\n            return season_str\n    return season_str  # Return as-is if not in expected format\n\n# --- HELPER FUNCTION 2 ---\ndef increment_season(season_str):\n    \"\"\"Converts a season string like '1995-96' to '1996-97'.\"\"\"\n    if pd.isna(season_str):\n        return pd.NA\n    try:\n        start_year = int(season_str.split('-')[0])\n        next_start_year = start_year + 1\n        \n        # Handle the '1999-00' case\n        if next_start_year == 1999:\n            return \"1999-00\"\n        \n        next_end_year_short = str(next_start_year + 1)[-2:] # e.g., 97\n        return f\"{next_start_year}-{next_end_year_short}\"\n    except Exception as e:\n        print(f\"Error incrementing season '{season_str}': {e}\")\n        return pd.NA\n\n# Apply the formatting\ndf_tidy['Season'] = df_tidy['Season'].apply(format_season)\nprint(\"Step 7: Standardized 'Season' key to 'YYYY-YY' format (e.g., '1992-93').\")\n\n### Step 7.5 — Temporary Year +3 rows (outcome extraction only)\n\nprint(\"Step 7.5: Generating temporary Year 3 rows for outcome calculation...\")\n\n# 1. Find all Year 2 rows\ndf_y2_rows = df_tidy[df_tidy['Year_vs_Relegation'] == 2].copy()\n\n# 2. Transform them into Year 3 rows\ndf_y2_rows['Year_vs_Relegation'] = 3\ndf_y2_rows['Attendance'] = pd.NA # Attendance data is not needed\ndf_y2_rows['Season'] = df_y2_rows['Season'].apply(increment_season)\n\n# 3. Concatenate these helper rows back onto the main tidy dataframe\ndf_tidy = pd.concat([df_tidy, df_y2_rows], ignore_index=True)\nprint(\"Step 7.5: Temporary Year 3 rows created and added.\")\n\n### Step 8 — Enrich tidy data with standings (raw totals)\n\nif not df_positions.empty:\n    # --- Upgrade the history file's 'Season' column ---\n    season_numeric = pd.to_numeric(df_positions['Season'], errors='coerce').dropna()\n    season_end_year = (season_numeric + 1).astype(int).astype(str).str.zfill(4).str[-2:]\n    df_positions.loc[season_numeric.index, 'Season'] = season_numeric.astype(int).astype(str) + '-' + season_end_year\n    print(\"Step 8a: Upgraded history file 'Season' key.\")\n\n    # --- MODIFICATION ---\n    # We are NO LONGER calculating per-game metrics here.\n    # We are ONLY merging the raw values.\n    df_positions_merge = df_positions[[\n        'Team', 'Season', 'Position_History', 'Tier_History',\n        'Games_Played_History', 'Wins_History', 'Goals_For_History', \n        'Goals_Against_History', 'Points_History'\n    ]]\n    # --- END MODIFICATION ---\n\n    # --- Merge the data ---\n    print(\"Step 8b: Merging tidy data with position data...\")\n    df_final = pd.merge(\n        df_tidy,\n        df_positions_merge,  # Use the merge-ready dataframe with raw columns\n        on=['Team', 'Season'],\n        how='left'\n    )\n    df_final['Position'] = df_final['Position_History']\n    df_final['Tier'] = df_final['Tier_History']\n    print(\"Step 8: Data enriched. 'df_final' created and 'Tier' column added.\")\n\nelse:\n    print(\"Step 8: Skipping merge as 'standings.csv' was not loaded.\")\n    df_final = df_tidy.copy() \n    # Add empty columns\n    for col in ['Position', 'Tier', 'Games_Played_History', 'Wins_History', 'Goals_For_History', 'Goals_Against_History', 'Points_History']:\n        df_final[col] = pd.NA\n\n### Step 8.5 — Compute Year_End_Outcome from tier transitions\nprint(\"Step 8.5: Calculating 'Year_End_Outcome' based on precise timeline...\")\n\n# 1. Calculate the Tier Change (Tier_Next_Year - Tier_Current_Year)\ndf_final['Tier_Next_Year'] = df_final.groupby('Relegation_Event_ID')['Tier'].shift(-1)\ndf_final['Tier_Change'] = df_final['Tier_Next_Year'] - df_final['Tier']\n\n# 2. Map the Tier Change to the Outcome Label\ndef map_tier_change_to_outcome(row):\n    \"\"\"Maps the outcome based on the user's exact timeline definition.\"\"\"\n    \n    year_vs_relegation = row['Year_vs_Relegation'] \n    current_tier = row['Tier']\n    tier_change = row['Tier_Change']\n\n    # --- 1. Handle Year -1 (Based on CURRENT Tier) ---\n    if year_vs_relegation == -1:\n        if current_tier == 1:\n            return 'Survived'\n        if current_tier == 2:\n            return 'Promoted'\n        return pd.NA\n\n    # --- 2. Handle Year 0 (The Relegation Event) ---\n    if year_vs_relegation == 0:\n        return 'Relegated'\n\n    # --- 3. Handle Year +1 and +2 (Based on TIER CHANGE) ---\n    if year_vs_relegation in [1, 2]:\n        if pd.isna(tier_change):\n            return pd.NA \n        \n        if tier_change == -1:\n            return 'Promoted'\n        if tier_change == 0:\n            return 'Survived'\n        if tier_change == 1:\n            return 'Relegated'\n        \n        return pd.NA\n\n    return pd.NA # Catches Y3 row\n\n# Apply the function\ndf_final['Year_End_Outcome'] = df_final.apply(map_tier_change_to_outcome, axis=1)\nprint(\"Step 8.5: 'Year_End_Outcome' column successfully created.\")\n\n### Step 9 — Finalize schema and export  \n\nprint(\"Step 9: Polishing final data...\")\n\n# --- MODIFICATION: Added all _History columns ---\nfinal_columns = [\n    'Relegation_Event_ID', 'Team', 'Season', 'Tier',\n    'Position', 'Attendance', 'Year_vs_Relegation', 'Year_End_Outcome',\n    'Games_Played_History', 'Wins_History', 'Goals_For_History', \n    'Goals_Against_History', 'Points_History'\n]\n# --- END MODIFICATION ---\n\n# Ensure final columns exist before slicing\nfor col in final_columns:\n    if col not in df_final.columns:\n        df_final[col] = pd.NA\n\n# --- MODIFICATION: Cast all numeric columns to Int64 ---\nfor col in ['Attendance', 'Position', 'Tier', 'Games_Played_History', 'Wins_History', 'Goals_For_History', 'Goals_Against_History', 'Points_History']:\n    df_final[col] = pd.to_numeric(df_final[col], errors='coerce').astype('Int64')\n# --- END MODIFICATION ---\n\n# --- DROP THE HELPER ROW ---\ndf_final = df_final[df_final['Year_vs_Relegation'] != 3].copy()\n\n# Keep only the final columns and sort\ndf_final = df_final[final_columns].sort_values(by=['Relegation_Event_ID', 'Year_vs_Relegation'])\n\n# Save the final, perfect data to a new CSV in the 'datasets' folder\noutput_path = \"../../assets/files/datasets/perfect_tidy_data.csv\"\ndf_final.to_csv(output_path, index=False)\nimport os\nprint(f\"Step 9: Success! Final table saved to '{output_path}'\")"
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#full-copy-paste-analysis-prep-script",
    "href": "posts/too-messy-to-melt/index.html#full-copy-paste-analysis-prep-script",
    "title": "Too Messy to Melt",
    "section": "Full copy-paste analysis prep script",
    "text": "Full copy-paste analysis prep script\n## From tidy data to analysis-ready tables\nprint(\"--- PREPARING DATA FOR ANALYSIS ---\")\n\n# --- ANALYSIS PREP ---\n# This block creates the 'df_plot' DataFrame for all visualizations\n# 1. Get the baseline attendance (Year 0) for each event\ndf_y0_baseline = df_final[\n    df_final['Year_vs_Relegation'] == 0\n][['Relegation_Event_ID', 'Attendance']].rename(columns={'Attendance': 'Attendance_Y0_Baseline'})\n\n# 2. Merge this baseline back onto the main df\ndf_plot = pd.merge(df_final, df_y0_baseline, on='Relegation_Event_ID', how='left')\n\n# 3. Calculate the Pct Change vs. Year 0 for all years\ndf_plot['Pct_Change_vs_Y0'] = (\n    (df_plot['Attendance'] - df_plot['Attendance_Y0_Baseline']) / \n    df_plot['Attendance_Y0_Baseline']\n)\n\n# 4. Get the *key outcome* from Year 1 (the first post-relegation season)\ndf_y1_outcome = df_final[\n    df_final['Year_vs_Relegation'] == 1\n][['Relegation_Event_ID', 'Year_End_Outcome']].rename(columns={'Year_End_Outcome': 'Outcome_Group'})\n\n# 5. Merge this outcome group onto the whole plot dataset\ndf_plot = pd.merge(df_plot, df_y1_outcome, on='Relegation_Event_ID', how='left')\n\n\n# 5.5: IMPUTE 2024-25 OUTCOMES ---\n# The Y+1 outcome for the 2023-24 cohort is NA. We impute it manually.\nprint(\"Imputing outcomes for 2023-24 cohort...\")\n\n# Define our imputations based on likely 2024-25 season-end performance\nimpute_map = {\n    'Burnley 2023-24': 'Promoted',\n    'Sheffield United 2023-24': 'Survived', # Assuming playoffs = Survived\n    'Luton Town 2023-24': 'Relegated'\n}\n\n# Apply the imputation\n# This finds rows where Outcome_Group is NA and maps the Event ID to our new value\ndf_plot['Outcome_Group'] = df_plot['Outcome_Group'].fillna(\n    df_plot['Relegation_Event_ID'].map(impute_map)\n)\nprint(\"Imputation complete.\")\n\n# 6. Convert Pct_Change to a percentage number (e.g., 0.05 -&gt; 5)\ndf_plot['Pct_Change_vs_Y0_Display'] = df_plot['Pct_Change_vs_Y0'] * 100\n\n# 7. Calculate Per-Game metrics on the fly\ndf_plot['Goals_For_Per_Game'] = df_plot['Goals_For_History'] / df_plot['Games_Played_History']\ndf_plot['Points_Per_Game'] = df_plot['Points_History'] / df_plot['Games_Played_History']\n\n# 8. Define the FINAL anomaly list\n# We are KEEPING Wimbledon, as it's a valid case study.\nanomaly_events = [\n    'Middlesbrough 1992-93', # Rebuild\n    'Sunderland 1996-97',    # New stadium\n    'Leicester City 2001-02', # New stadium\n    'Bolton Wanderers 1995-96'  # New stadium (in Y+2)\n]\n\n# 9. Create the FINAL filtered DataFrame for plotting\ndf_plot_filtered = df_plot[~df_plot['Relegation_Event_ID'].isin(anomaly_events)]\nprint(f\"Removed {len(df_plot) - len(df_plot_filtered)} total data points for structural anomalies.\")\n\n# 10. Create the cleaner plot labels\nlabel_map = {\n    'Promoted': 'Promoted (Back in PL)',\n    'Survived': 'Survived (Still in Champ)',\n    'Relegated': 'Relegated (Down to L1)'\n}\ndf_plot['Plot_Group_Label'] = df_plot['Outcome_Group'].map(label_map)\ndf_plot_filtered['Plot_Group_Label'] = df_plot_filtered['Outcome_Group'].map(label_map)\n\nprint(\"--- Analysis data is ready. ---\")"
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#analysis-prep-script-full-copy-paste-ready",
    "href": "posts/too-messy-to-melt/index.html#analysis-prep-script-full-copy-paste-ready",
    "title": "Too Messy to Melt",
    "section": "Analysis prep script (full, copy-paste ready)",
    "text": "Analysis prep script (full, copy-paste ready)\n## From tidy data to analysis-ready tables\nprint(\"--- PREPARING DATA FOR ANALYSIS ---\")\n\n# --- ANALYSIS PREP ---\n# This block creates the 'df_plot' DataFrame for all visualizations\n# 1. Get the baseline attendance (Year 0) for each event\ndf_y0_baseline = df_final[\n    df_final['Year_vs_Relegation'] == 0\n][['Relegation_Event_ID', 'Attendance']].rename(columns={'Attendance': 'Attendance_Y0_Baseline'})\n\n# 2. Merge this baseline back onto the main df\ndf_plot = pd.merge(df_final, df_y0_baseline, on='Relegation_Event_ID', how='left')\n\n# 3. Calculate the Pct Change vs. Year 0 for all years\ndf_plot['Pct_Change_vs_Y0'] = (\n    (df_plot['Attendance'] - df_plot['Attendance_Y0_Baseline']) / \n    df_plot['Attendance_Y0_Baseline']\n)\n\n# 4. Get the *key outcome* from Year 1 (the first post-relegation season)\ndf_y1_outcome = df_final[\n    df_final['Year_vs_Relegation'] == 1\n][['Relegation_Event_ID', 'Year_End_Outcome']].rename(columns={'Year_End_Outcome': 'Outcome_Group'})\n\n# 5. Merge this outcome group onto the whole plot dataset\ndf_plot = pd.merge(df_plot, df_y1_outcome, on='Relegation_Event_ID', how='left')\n\n\n# 5.5: IMPUTE 2024-25 OUTCOMES ---\n# The Y+1 outcome for the 2023-24 cohort is NA. We impute it manually.\nprint(\"Imputing outcomes for 2023-24 cohort...\")\n\n# Define our imputations based on likely 2024-25 season-end performance\nimpute_map = {\n    'Burnley 2023-24': 'Promoted',\n    'Sheffield United 2023-24': 'Survived', # Assuming playoffs = Survived\n    'Luton Town 2023-24': 'Relegated'\n}\n\n# Apply the imputation\n# This finds rows where Outcome_Group is NA and maps the Event ID to our new value\ndf_plot['Outcome_Group'] = df_plot['Outcome_Group'].fillna(\n    df_plot['Relegation_Event_ID'].map(impute_map)\n)\nprint(\"Imputation complete.\")\n\n# 6. Convert Pct_Change to a percentage number (e.g., 0.05 -&gt; 5)\ndf_plot['Pct_Change_vs_Y0_Display'] = df_plot['Pct_Change_vs_Y0'] * 100\n\n# 7. Calculate Per-Game metrics on the fly\ndf_plot['Goals_For_Per_Game'] = df_plot['Goals_For_History'] / df_plot['Games_Played_History']\ndf_plot['Points_Per_Game'] = df_plot['Points_History'] / df_plot['Games_Played_History']\n\n# 8. Define the FINAL anomaly list\n# We are KEEPING Wimbledon, as it's a valid case study.\nanomaly_events = [\n    'Middlesbrough 1992-93', # Rebuild\n    'Sunderland 1996-97',    # New stadium\n    'Leicester City 2001-02', # New stadium\n    'Bolton Wanderers 1995-96'  # New stadium (in Y+2)\n]\n\n# 9. Create the FINAL filtered DataFrame for plotting\ndf_plot_filtered = df_plot[~df_plot['Relegation_Event_ID'].isin(anomaly_events)]\nprint(f\"Removed {len(df_plot) - len(df_plot_filtered)} total data points for structural anomalies.\")\n\n# 10. Create the cleaner plot labels\nlabel_map = {\n    'Promoted': 'Promoted (Back in PL)',\n    'Survived': 'Survived (Still in Champ)',\n    'Relegated': 'Relegated (Down to L1)'\n}\ndf_plot['Plot_Group_Label'] = df_plot['Outcome_Group'].map(label_map)\ndf_plot_filtered['Plot_Group_Label'] = df_plot_filtered['Outcome_Group'].map(label_map)\n\nprint(\"--- Analysis data is ready. ---\")"
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#csv-creation-script-full-copy-paste",
    "href": "posts/too-messy-to-melt/index.html#csv-creation-script-full-copy-paste",
    "title": "Too Messy to Melt",
    "section": "CSV creation script (full copy-paste)",
    "text": "CSV creation script (full copy-paste)\nimport pandas as pd\nimport numpy as np\n### You may need to install thefuzz\npip install thefuzz\nfrom thefuzz import process\n\n### Step 1 — Load the wide spreadsheet and clean attendance columns\n\nattendance_cols = [c for c in df_wide.columns if \"Attendance\" in c]\nfor col in attendance_cols:\n    df_wide[col] = df_wide[col].astype(str).str.replace(',', '').replace('COVID', pd.NA).replace('nan', pd.NA)\n    df_wide[col] = pd.to_numeric(df_wide[col], errors='coerce')\n\n### Step 2 — Load standings data (for auditing + enrichment)\n\ntry:\n    # Load 'season' as string to be safe\n    df_history = pd.read_csv('../../assets/files/datasets/standings.csv', dtype={'season': str})\n\n    # --- Load patch file and combine ---\n    try:\n        df_patch = pd.read_csv('../../assets/files/datasets/standings24_25.csv', dtype={'season': str})\n        # Append patch data to history data\n        df_history = pd.concat([df_history, df_patch], ignore_index=True)\n        print(\"Step 2a: Loaded and applied 'standings24_25.csv'.\")\n    except FileNotFoundError:\n        print(\"Step 2a: 'standings24_25.csv' not found. Skipping patch.\")\n    # --- End new patch logic ---\n\n    print(\"Step 2b: Loaded historical data for auditing.\")\n\n    # Create the cleaned df_positions here for later use\n    df_positions = df_history.rename(columns={\n        'team_name': 'Team',\n        'season': 'Season',\n        'position': 'Position_History',\n        'played': 'Games_Played_History',\n        'wins': 'Wins_History',\n        'goals_for': 'Goals_For_History',\n        'goals_against': 'Goals_Against_History',\n        'points': 'Points_History',\n        'tier': 'Tier_History'\n    })[['Team', 'Season', 'Position_History', 'Games_Played_History', 'Wins_History',\n        'Goals_For_History', 'Goals_Against_History', 'Points_History', 'Tier_History']]\n\n    # Convert new history columns to numeric\n    numeric_cols = ['Position_History', 'Games_Played_History', 'Wins_History',\n                    'Goals_For_History', 'Goals_Against_History', 'Points_History', 'Tier_History']\n    for col in numeric_cols:\n        df_positions[col] = pd.to_numeric(df_positions[col], errors='coerce')\n\n### Step 3 — Audit team names (fuzzy matching)\n\nteams_in_wide_df = set(df_wide['Relegated Team'].astype(str).unique())\n    teams_in_history_df = set(df_positions['Team'].astype(str).unique())\n\n    unmatched_teams = teams_in_wide_df.difference(teams_in_history_df)\n\n    # Create an empty map to build automatically\n    auto_team_name_map = {}\n\n    if unmatched_teams:\n        print(\"--- AUDIT: TEAM NAME MISMATCHES FOUND ---\")\n        print(\"The following teams from your file do not match the history file.\")\n        print(\"Attempting to build an automatic mapping...\")\n\n        # Loop through each unique unmatched team and find the best match\n        for team in sorted(unmatched_teams):\n            # process.extractOne returns a tuple: (best_match, score)\n            suggestion = process.extractOne(team, teams_in_history_df)\n\n            # Auto-map spaces, asterisks, and high-confidence matches\n            if suggestion[1] &gt; 85:\n                print(f\"  - Auto-mapping: \\\"{team}\\\" -&gt; \\\"{suggestion[0]}\\\" (Score: {suggestion[1]})\")\n                auto_team_name_map[team] = suggestion[0]\n            else:\n                # Don't map low-confidence or junk data\n                if team not in ['nan', 'TEAM', 'Relegated Team']:\n                    print(\n                        f\"  - WARNING: \\\"{team}\\\" has no confident match. (Best: \\\"{suggestion[0]}\\\" at {suggestion[1]}%)\")\n                    print(f\"    -&gt; Please add a fix for \\\"{team}\\\" to 'manual_overrides_map' in Step 4.\")\n\n        print(\"---------------------------------------------\")\n    else:\n        print(\"--- AUDIT: TEAM NAMES OK ---\")\n        print(\"All team names in your file match the history file.\")\n\nexcept FileNotFoundError:\n    print(\"Error: '../../assets/files/datasets/standings.csv' not found. Skipping audit and enrichment.\")\n    # Create empty dataframes if file not found\n    df_positions = pd.DataFrame(columns=['Team', 'Season', 'Position_History', 'Games_Played_History',\n                                         'Wins_History', 'Goals_For_History', 'Goals_Against_History',\n                                         'Points_History', 'Tier_History'])\n    auto_team_name_map = {}\n\n### Step 4 — Standardize team names (auto-map + manual overrides)\n\nmanual_overrides_map = {\n    \"Man Utd\": \"Manchester United\",\n    \"Man City\": \"Manchester City\",\n    \"Spurs\": \"Tottenham Hotspur\",\n    \"QPR\": \"Queens Park Rangers\",\n    \"Wolves\": \"Wolverhampton Wanderers\",\n    \"Sheff Utd\": \"Sheffield United\",\n    \"Sheff Wed\": \"Sheffield Wednesday\",\n    \"Nott'm Forest\": \"Nottingham Forest\",\n    \"Notts County\": \"Nottingham Forest\"\n    # e.g., if audit warns about \"Bradford\", add:\n    # \"Bradford\": \"Bradford City\",\n}\n# Combine the auto-generated map with the manual overrides\n# This is where we combine the two dictionaries.\n# The 'manual_overrides_map' will overwrite any conflicting keys from 'auto_team_name_map'.\nfinal_team_map = {**auto_team_name_map, **manual_overrides_map}\n\ndf_wide['Relegated Team'] = df_wide['Relegated Team'].replace(final_team_map)\nprint(\"Step 4: Standardized 'Relegated Team' names using auto-mapping and manual overrides.\")\n# --- 4.5. FILTERING STEP ---\n# Now that names are mapped, we can filter out junk rows that didn't get mapped\nteams_in_history_df = set(df_positions['Team'].astype(str).unique())\ndf_wide = df_wide[df_wide['Relegated Team'].isin(teams_in_history_df)]\nprint(\"Step 4.5: Filtered out junk rows (e.g., 'nan', 'TEAM').\")\n\n### Step 5 — Create a stable event key (Relegation_Event_ID)\n\ndf_wide['Relegation_Event_ID'] = df_wide['Relegated Team'] + ' ' + df_wide['Season']\nprint(\"Step 5: Created 'Relegation_Event_ID'.\")\n\n### Step 6 — Convert wide → tidy (safe slices + concat)\n\n## Helper function to create each slice\ndef make_slice(df, team_col, season_col, att_col, year_vs):\n    # --- Check if att_col exists, otherwise use pd.NA ---\n    # This makes the function robust for the missing Y3 attendance\n    if att_col not in df.columns:\n        # Create a temporary column of NAs if the attendance col doesn't exist\n        df = df.assign(Attendance_tmp=pd.NA) \n    else:\n        # If the col *does* exist, rename it\n        df = df.rename(columns={att_col: \"Attendance_tmp\"})\n        \n    slice_df = df.rename(columns={\n        team_col: \"Team\",\n        season_col: \"Season_tmp\"\n    }).assign(Year_vs_Relegation=year_vs)\n\n    # Select and rename final columns\n    slice_df = slice_df[['Relegation_Event_ID', 'Team', 'Season_tmp', 'Attendance_tmp', 'Year_vs_Relegation']].copy()\n    slice_df.columns = ['Relegation_Event_ID', 'Team', 'Season', 'Attendance', 'Year_vs_Relegation']\n\n    return slice_df\n\n# Create slices (Only up to Year 2)\nslice_minus1 = make_slice(df_wide, \"Relegated Team\", \"Year Before\", \"Year Before Att\", -1)\nslice_0      = make_slice(df_wide, \"Relegated Team\", \"Season\", \"Attendance\", 0)\nslice_1      = make_slice(df_wide, \"Relegated Team\", \"Year After\", \"Attendance year after\", 1)\nslice_2      = make_slice(df_wide, \"Relegated Team\", \"2 years after\", \"Attendance 2 years after\", 2)\n\n# Concatenate slices safely\ndf_tidy = pd.concat([slice_minus1, slice_0, slice_1, slice_2], ignore_index=True)\n\nprint(\"Step 6: Data has been 'tidied' successfully!\")\n\n### Step 7 — Standardize season keys (YYYY-YY)\n\n# --- HELPER FUNCTION 1 ---\ndef format_season(season_str):\n    \"\"\"Converts '1991-1992' to '1991-92' and leaves '1992-93' as is.\"\"\"\n    if pd.isna(season_str):\n        return pd.NA\n    parts = str(season_str).split('-')\n    if len(parts) == 2:\n        if len(parts[1]) == 4:  # Format is '1991-1992'\n            return f\"{parts[0]}-{parts[1][-2:]}\"\n        else:  # Format is '1992-93'\n            return season_str\n    return season_str  # Return as-is if not in expected format\n\n# --- HELPER FUNCTION 2 ---\ndef increment_season(season_str):\n    \"\"\"Converts a season string like '1995-96' to '1996-97'.\"\"\"\n    if pd.isna(season_str):\n        return pd.NA\n    try:\n        start_year = int(season_str.split('-')[0])\n        next_start_year = start_year + 1\n        \n        # Handle the '1999-00' case\n        if next_start_year == 1999:\n            return \"1999-00\"\n        \n        next_end_year_short = str(next_start_year + 1)[-2:] # e.g., 97\n        return f\"{next_start_year}-{next_end_year_short}\"\n    except Exception as e:\n        print(f\"Error incrementing season '{season_str}': {e}\")\n        return pd.NA\n\n# Apply the formatting\ndf_tidy['Season'] = df_tidy['Season'].apply(format_season)\nprint(\"Step 7: Standardized 'Season' key to 'YYYY-YY' format (e.g., '1992-93').\")\n\n### Step 7.5 — Temporary Year +3 rows (outcome extraction only)\n\nprint(\"Step 7.5: Generating temporary Year 3 rows for outcome calculation...\")\n\n# 1. Find all Year 2 rows\ndf_y2_rows = df_tidy[df_tidy['Year_vs_Relegation'] == 2].copy()\n\n# 2. Transform them into Year 3 rows\ndf_y2_rows['Year_vs_Relegation'] = 3\ndf_y2_rows['Attendance'] = pd.NA # Attendance data is not needed\ndf_y2_rows['Season'] = df_y2_rows['Season'].apply(increment_season)\n\n# 3. Concatenate these helper rows back onto the main tidy dataframe\ndf_tidy = pd.concat([df_tidy, df_y2_rows], ignore_index=True)\nprint(\"Step 7.5: Temporary Year 3 rows created and added.\")\n\n### Step 8 — Enrich tidy data with standings (raw totals)\n\nif not df_positions.empty:\n    # --- Upgrade the history file's 'Season' column ---\n    season_numeric = pd.to_numeric(df_positions['Season'], errors='coerce').dropna()\n    season_end_year = (season_numeric + 1).astype(int).astype(str).str.zfill(4).str[-2:]\n    df_positions.loc[season_numeric.index, 'Season'] = season_numeric.astype(int).astype(str) + '-' + season_end_year\n    print(\"Step 8a: Upgraded history file 'Season' key.\")\n\n    # --- MODIFICATION ---\n    # We are NO LONGER calculating per-game metrics here.\n    # We are ONLY merging the raw values.\n    df_positions_merge = df_positions[[\n        'Team', 'Season', 'Position_History', 'Tier_History',\n        'Games_Played_History', 'Wins_History', 'Goals_For_History', \n        'Goals_Against_History', 'Points_History'\n    ]]\n    # --- END MODIFICATION ---\n\n    # --- Merge the data ---\n    print(\"Step 8b: Merging tidy data with position data...\")\n    df_final = pd.merge(\n        df_tidy,\n        df_positions_merge,  # Use the merge-ready dataframe with raw columns\n        on=['Team', 'Season'],\n        how='left'\n    )\n    df_final['Position'] = df_final['Position_History']\n    df_final['Tier'] = df_final['Tier_History']\n    print(\"Step 8: Data enriched. 'df_final' created and 'Tier' column added.\")\n\nelse:\n    print(\"Step 8: Skipping merge as 'standings.csv' was not loaded.\")\n    df_final = df_tidy.copy() \n    # Add empty columns\n    for col in ['Position', 'Tier', 'Games_Played_History', 'Wins_History', 'Goals_For_History', 'Goals_Against_History', 'Points_History']:\n        df_final[col] = pd.NA\n\n### Step 8.5 — Compute Year_End_Outcome from tier transitions\nprint(\"Step 8.5: Calculating 'Year_End_Outcome' based on precise timeline...\")\n\n# 1. Calculate the Tier Change (Tier_Next_Year - Tier_Current_Year)\ndf_final['Tier_Next_Year'] = df_final.groupby('Relegation_Event_ID')['Tier'].shift(-1)\ndf_final['Tier_Change'] = df_final['Tier_Next_Year'] - df_final['Tier']\n\n# 2. Map the Tier Change to the Outcome Label\ndef map_tier_change_to_outcome(row):\n    \"\"\"Maps the outcome based on the user's exact timeline definition.\"\"\"\n    \n    year_vs_relegation = row['Year_vs_Relegation'] \n    current_tier = row['Tier']\n    tier_change = row['Tier_Change']\n\n    # --- 1. Handle Year -1 (Based on CURRENT Tier) ---\n    if year_vs_relegation == -1:\n        if current_tier == 1:\n            return 'Survived'\n        if current_tier == 2:\n            return 'Promoted'\n        return pd.NA\n\n    # --- 2. Handle Year 0 (The Relegation Event) ---\n    if year_vs_relegation == 0:\n        return 'Relegated'\n\n    # --- 3. Handle Year +1 and +2 (Based on TIER CHANGE) ---\n    if year_vs_relegation in [1, 2]:\n        if pd.isna(tier_change):\n            return pd.NA \n        \n        if tier_change == -1:\n            return 'Promoted'\n        if tier_change == 0:\n            return 'Survived'\n        if tier_change == 1:\n            return 'Relegated'\n        \n        return pd.NA\n\n    return pd.NA # Catches Y3 row\n\n# Apply the function\ndf_final['Year_End_Outcome'] = df_final.apply(map_tier_change_to_outcome, axis=1)\nprint(\"Step 8.5: 'Year_End_Outcome' column successfully created.\")\n\n### Step 9 — Finalize schema and export  \n\nprint(\"Step 9: Polishing final data...\")\n\n# --- MODIFICATION: Added all _History columns ---\nfinal_columns = [\n    'Relegation_Event_ID', 'Team', 'Season', 'Tier',\n    'Position', 'Attendance', 'Year_vs_Relegation', 'Year_End_Outcome',\n    'Games_Played_History', 'Wins_History', 'Goals_For_History', \n    'Goals_Against_History', 'Points_History'\n]\n# --- END MODIFICATION ---\n\n# Ensure final columns exist before slicing\nfor col in final_columns:\n    if col not in df_final.columns:\n        df_final[col] = pd.NA\n\n# --- MODIFICATION: Cast all numeric columns to Int64 ---\nfor col in ['Attendance', 'Position', 'Tier', 'Games_Played_History', 'Wins_History', 'Goals_For_History', 'Goals_Against_History', 'Points_History']:\n    df_final[col] = pd.to_numeric(df_final[col], errors='coerce').astype('Int64')\n# --- END MODIFICATION ---\n\n# --- DROP THE HELPER ROW ---\ndf_final = df_final[df_final['Year_vs_Relegation'] != 3].copy()\n\n# Keep only the final columns and sort\ndf_final = df_final[final_columns].sort_values(by=['Relegation_Event_ID', 'Year_vs_Relegation'])\n\n# Save the final, perfect data to a new CSV in the 'datasets' folder\noutput_path = \"../../assets/files/datasets/perfect_tidy_data.csv\"\ndf_final.to_csv(output_path, index=False)\nimport os\nprint(f\"Step 9: Success! Final table saved to '{output_path}'\")"
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#csv-creation-script-full-copy-paste-ready",
    "href": "posts/too-messy-to-melt/index.html#csv-creation-script-full-copy-paste-ready",
    "title": "Too Messy to Melt",
    "section": "CSV creation script (full copy-paste ready)",
    "text": "CSV creation script (full copy-paste ready)\nimport pandas as pd\nimport numpy as np\n### You may need to install thefuzz\npip install thefuzz\nfrom thefuzz import process\n\n### Step 1 — Load the wide spreadsheet and clean attendance columns\n\nattendance_cols = [c for c in df_wide.columns if \"Attendance\" in c]\nfor col in attendance_cols:\n    df_wide[col] = df_wide[col].astype(str).str.replace(',', '').replace('COVID', pd.NA).replace('nan', pd.NA)\n    df_wide[col] = pd.to_numeric(df_wide[col], errors='coerce')\n\n### Step 2 — Load standings data (for auditing + enrichment)\n\ntry:\n    # Load 'season' as string to be safe\n    df_history = pd.read_csv('../../assets/files/datasets/standings.csv', dtype={'season': str})\n\n    # --- Load patch file and combine ---\n    try:\n        df_patch = pd.read_csv('../../assets/files/datasets/standings24_25.csv', dtype={'season': str})\n        # Append patch data to history data\n        df_history = pd.concat([df_history, df_patch], ignore_index=True)\n        print(\"Step 2a: Loaded and applied 'standings24_25.csv'.\")\n    except FileNotFoundError:\n        print(\"Step 2a: 'standings24_25.csv' not found. Skipping patch.\")\n    # --- End new patch logic ---\n\n    print(\"Step 2b: Loaded historical data for auditing.\")\n\n    # Create the cleaned df_positions here for later use\n    df_positions = df_history.rename(columns={\n        'team_name': 'Team',\n        'season': 'Season',\n        'position': 'Position_History',\n        'played': 'Games_Played_History',\n        'wins': 'Wins_History',\n        'goals_for': 'Goals_For_History',\n        'goals_against': 'Goals_Against_History',\n        'points': 'Points_History',\n        'tier': 'Tier_History'\n    })[['Team', 'Season', 'Position_History', 'Games_Played_History', 'Wins_History',\n        'Goals_For_History', 'Goals_Against_History', 'Points_History', 'Tier_History']]\n\n    # Convert new history columns to numeric\n    numeric_cols = ['Position_History', 'Games_Played_History', 'Wins_History',\n                    'Goals_For_History', 'Goals_Against_History', 'Points_History', 'Tier_History']\n    for col in numeric_cols:\n        df_positions[col] = pd.to_numeric(df_positions[col], errors='coerce')\n\n### Step 3 — Audit team names (fuzzy matching)\n\nteams_in_wide_df = set(df_wide['Relegated Team'].astype(str).unique())\n    teams_in_history_df = set(df_positions['Team'].astype(str).unique())\n\n    unmatched_teams = teams_in_wide_df.difference(teams_in_history_df)\n\n    # Create an empty map to build automatically\n    auto_team_name_map = {}\n\n    if unmatched_teams:\n        print(\"--- AUDIT: TEAM NAME MISMATCHES FOUND ---\")\n        print(\"The following teams from your file do not match the history file.\")\n        print(\"Attempting to build an automatic mapping...\")\n\n        # Loop through each unique unmatched team and find the best match\n        for team in sorted(unmatched_teams):\n            # process.extractOne returns a tuple: (best_match, score)\n            suggestion = process.extractOne(team, teams_in_history_df)\n\n            # Auto-map spaces, asterisks, and high-confidence matches\n            if suggestion[1] &gt; 85:\n                print(f\"  - Auto-mapping: \\\"{team}\\\" -&gt; \\\"{suggestion[0]}\\\" (Score: {suggestion[1]})\")\n                auto_team_name_map[team] = suggestion[0]\n            else:\n                # Don't map low-confidence or junk data\n                if team not in ['nan', 'TEAM', 'Relegated Team']:\n                    print(\n                        f\"  - WARNING: \\\"{team}\\\" has no confident match. (Best: \\\"{suggestion[0]}\\\" at {suggestion[1]}%)\")\n                    print(f\"    -&gt; Please add a fix for \\\"{team}\\\" to 'manual_overrides_map' in Step 4.\")\n\n        print(\"---------------------------------------------\")\n    else:\n        print(\"--- AUDIT: TEAM NAMES OK ---\")\n        print(\"All team names in your file match the history file.\")\n\nexcept FileNotFoundError:\n    print(\"Error: '../../assets/files/datasets/standings.csv' not found. Skipping audit and enrichment.\")\n    # Create empty dataframes if file not found\n    df_positions = pd.DataFrame(columns=['Team', 'Season', 'Position_History', 'Games_Played_History',\n                                         'Wins_History', 'Goals_For_History', 'Goals_Against_History',\n                                         'Points_History', 'Tier_History'])\n    auto_team_name_map = {}\n\n### Step 4 — Standardize team names (auto-map + manual overrides)\n\nmanual_overrides_map = {\n    \"Man Utd\": \"Manchester United\",\n    \"Man City\": \"Manchester City\",\n    \"Spurs\": \"Tottenham Hotspur\",\n    \"QPR\": \"Queens Park Rangers\",\n    \"Wolves\": \"Wolverhampton Wanderers\",\n    \"Sheff Utd\": \"Sheffield United\",\n    \"Sheff Wed\": \"Sheffield Wednesday\",\n    \"Nott'm Forest\": \"Nottingham Forest\",\n    \"Notts County\": \"Nottingham Forest\"\n    # e.g., if audit warns about \"Bradford\", add:\n    # \"Bradford\": \"Bradford City\",\n}\n# Combine the auto-generated map with the manual overrides\n# This is where we combine the two dictionaries.\n# The 'manual_overrides_map' will overwrite any conflicting keys from 'auto_team_name_map'.\nfinal_team_map = {**auto_team_name_map, **manual_overrides_map}\n\ndf_wide['Relegated Team'] = df_wide['Relegated Team'].replace(final_team_map)\nprint(\"Step 4: Standardized 'Relegated Team' names using auto-mapping and manual overrides.\")\n# --- 4.5. FILTERING STEP ---\n# Now that names are mapped, we can filter out junk rows that didn't get mapped\nteams_in_history_df = set(df_positions['Team'].astype(str).unique())\ndf_wide = df_wide[df_wide['Relegated Team'].isin(teams_in_history_df)]\nprint(\"Step 4.5: Filtered out junk rows (e.g., 'nan', 'TEAM').\")\n\n### Step 5 — Create a stable event key (Relegation_Event_ID)\n\ndf_wide['Relegation_Event_ID'] = df_wide['Relegated Team'] + ' ' + df_wide['Season']\nprint(\"Step 5: Created 'Relegation_Event_ID'.\")\n\n### Step 6 — Convert wide → tidy (safe slices + concat)\n\n## Helper function to create each slice\ndef make_slice(df, team_col, season_col, att_col, year_vs):\n    # --- Check if att_col exists, otherwise use pd.NA ---\n    # This makes the function robust for the missing Y3 attendance\n    if att_col not in df.columns:\n        # Create a temporary column of NAs if the attendance col doesn't exist\n        df = df.assign(Attendance_tmp=pd.NA) \n    else:\n        # If the col *does* exist, rename it\n        df = df.rename(columns={att_col: \"Attendance_tmp\"})\n        \n    slice_df = df.rename(columns={\n        team_col: \"Team\",\n        season_col: \"Season_tmp\"\n    }).assign(Year_vs_Relegation=year_vs)\n\n    # Select and rename final columns\n    slice_df = slice_df[['Relegation_Event_ID', 'Team', 'Season_tmp', 'Attendance_tmp', 'Year_vs_Relegation']].copy()\n    slice_df.columns = ['Relegation_Event_ID', 'Team', 'Season', 'Attendance', 'Year_vs_Relegation']\n\n    return slice_df\n\n# Create slices (Only up to Year 2)\nslice_minus1 = make_slice(df_wide, \"Relegated Team\", \"Year Before\", \"Year Before Att\", -1)\nslice_0      = make_slice(df_wide, \"Relegated Team\", \"Season\", \"Attendance\", 0)\nslice_1      = make_slice(df_wide, \"Relegated Team\", \"Year After\", \"Attendance year after\", 1)\nslice_2      = make_slice(df_wide, \"Relegated Team\", \"2 years after\", \"Attendance 2 years after\", 2)\n\n# Concatenate slices safely\ndf_tidy = pd.concat([slice_minus1, slice_0, slice_1, slice_2], ignore_index=True)\n\nprint(\"Step 6: Data has been 'tidied' successfully!\")\n\n### Step 7 — Standardize season keys (YYYY-YY)\n\n# --- HELPER FUNCTION 1 ---\ndef format_season(season_str):\n    \"\"\"Converts '1991-1992' to '1991-92' and leaves '1992-93' as is.\"\"\"\n    if pd.isna(season_str):\n        return pd.NA\n    parts = str(season_str).split('-')\n    if len(parts) == 2:\n        if len(parts[1]) == 4:  # Format is '1991-1992'\n            return f\"{parts[0]}-{parts[1][-2:]}\"\n        else:  # Format is '1992-93'\n            return season_str\n    return season_str  # Return as-is if not in expected format\n\n# --- HELPER FUNCTION 2 ---\ndef increment_season(season_str):\n    \"\"\"Converts a season string like '1995-96' to '1996-97'.\"\"\"\n    if pd.isna(season_str):\n        return pd.NA\n    try:\n        start_year = int(season_str.split('-')[0])\n        next_start_year = start_year + 1\n        \n        # Handle the '1999-00' case\n        if next_start_year == 1999:\n            return \"1999-00\"\n        \n        next_end_year_short = str(next_start_year + 1)[-2:] # e.g., 97\n        return f\"{next_start_year}-{next_end_year_short}\"\n    except Exception as e:\n        print(f\"Error incrementing season '{season_str}': {e}\")\n        return pd.NA\n\n# Apply the formatting\ndf_tidy['Season'] = df_tidy['Season'].apply(format_season)\nprint(\"Step 7: Standardized 'Season' key to 'YYYY-YY' format (e.g., '1992-93').\")\n\n### Step 7.5 — Temporary Year +3 rows (outcome extraction only)\n\nprint(\"Step 7.5: Generating temporary Year 3 rows for outcome calculation...\")\n\n# 1. Find all Year 2 rows\ndf_y2_rows = df_tidy[df_tidy['Year_vs_Relegation'] == 2].copy()\n\n# 2. Transform them into Year 3 rows\ndf_y2_rows['Year_vs_Relegation'] = 3\ndf_y2_rows['Attendance'] = pd.NA # Attendance data is not needed\ndf_y2_rows['Season'] = df_y2_rows['Season'].apply(increment_season)\n\n# 3. Concatenate these helper rows back onto the main tidy dataframe\ndf_tidy = pd.concat([df_tidy, df_y2_rows], ignore_index=True)\nprint(\"Step 7.5: Temporary Year 3 rows created and added.\")\n\n### Step 8 — Enrich tidy data with standings (raw totals)\n\nif not df_positions.empty:\n    # --- Upgrade the history file's 'Season' column ---\n    season_numeric = pd.to_numeric(df_positions['Season'], errors='coerce').dropna()\n    season_end_year = (season_numeric + 1).astype(int).astype(str).str.zfill(4).str[-2:]\n    df_positions.loc[season_numeric.index, 'Season'] = season_numeric.astype(int).astype(str) + '-' + season_end_year\n    print(\"Step 8a: Upgraded history file 'Season' key.\")\n\n    # --- MODIFICATION ---\n    # We are NO LONGER calculating per-game metrics here.\n    # We are ONLY merging the raw values.\n    df_positions_merge = df_positions[[\n        'Team', 'Season', 'Position_History', 'Tier_History',\n        'Games_Played_History', 'Wins_History', 'Goals_For_History', \n        'Goals_Against_History', 'Points_History'\n    ]]\n    # --- END MODIFICATION ---\n\n    # --- Merge the data ---\n    print(\"Step 8b: Merging tidy data with position data...\")\n    df_final = pd.merge(\n        df_tidy,\n        df_positions_merge,  # Use the merge-ready dataframe with raw columns\n        on=['Team', 'Season'],\n        how='left'\n    )\n    df_final['Position'] = df_final['Position_History']\n    df_final['Tier'] = df_final['Tier_History']\n    print(\"Step 8: Data enriched. 'df_final' created and 'Tier' column added.\")\n\nelse:\n    print(\"Step 8: Skipping merge as 'standings.csv' was not loaded.\")\n    df_final = df_tidy.copy() \n    # Add empty columns\n    for col in ['Position', 'Tier', 'Games_Played_History', 'Wins_History', 'Goals_For_History', 'Goals_Against_History', 'Points_History']:\n        df_final[col] = pd.NA\n\n### Step 8.5 — Compute Year_End_Outcome from tier transitions\nprint(\"Step 8.5: Calculating 'Year_End_Outcome' based on precise timeline...\")\n\n# 1. Calculate the Tier Change (Tier_Next_Year - Tier_Current_Year)\ndf_final['Tier_Next_Year'] = df_final.groupby('Relegation_Event_ID')['Tier'].shift(-1)\ndf_final['Tier_Change'] = df_final['Tier_Next_Year'] - df_final['Tier']\n\n# 2. Map the Tier Change to the Outcome Label\ndef map_tier_change_to_outcome(row):\n    \"\"\"Maps the outcome based on the user's exact timeline definition.\"\"\"\n    \n    year_vs_relegation = row['Year_vs_Relegation'] \n    current_tier = row['Tier']\n    tier_change = row['Tier_Change']\n\n    # --- 1. Handle Year -1 (Based on CURRENT Tier) ---\n    if year_vs_relegation == -1:\n        if current_tier == 1:\n            return 'Survived'\n        if current_tier == 2:\n            return 'Promoted'\n        return pd.NA\n\n    # --- 2. Handle Year 0 (The Relegation Event) ---\n    if year_vs_relegation == 0:\n        return 'Relegated'\n\n    # --- 3. Handle Year +1 and +2 (Based on TIER CHANGE) ---\n    if year_vs_relegation in [1, 2]:\n        if pd.isna(tier_change):\n            return pd.NA \n        \n        if tier_change == -1:\n            return 'Promoted'\n        if tier_change == 0:\n            return 'Survived'\n        if tier_change == 1:\n            return 'Relegated'\n        \n        return pd.NA\n\n    return pd.NA # Catches Y3 row\n\n# Apply the function\ndf_final['Year_End_Outcome'] = df_final.apply(map_tier_change_to_outcome, axis=1)\nprint(\"Step 8.5: 'Year_End_Outcome' column successfully created.\")\n\n### Step 9 — Finalize schema and export  \n\nprint(\"Step 9: Polishing final data...\")\n\n# --- MODIFICATION: Added all _History columns ---\nfinal_columns = [\n    'Relegation_Event_ID', 'Team', 'Season', 'Tier',\n    'Position', 'Attendance', 'Year_vs_Relegation', 'Year_End_Outcome',\n    'Games_Played_History', 'Wins_History', 'Goals_For_History', \n    'Goals_Against_History', 'Points_History'\n]\n# --- END MODIFICATION ---\n\n# Ensure final columns exist before slicing\nfor col in final_columns:\n    if col not in df_final.columns:\n        df_final[col] = pd.NA\n\n# --- MODIFICATION: Cast all numeric columns to Int64 ---\nfor col in ['Attendance', 'Position', 'Tier', 'Games_Played_History', 'Wins_History', 'Goals_For_History', 'Goals_Against_History', 'Points_History']:\n    df_final[col] = pd.to_numeric(df_final[col], errors='coerce').astype('Int64')\n# --- END MODIFICATION ---\n\n# --- DROP THE HELPER ROW ---\ndf_final = df_final[df_final['Year_vs_Relegation'] != 3].copy()\n\n# Keep only the final columns and sort\ndf_final = df_final[final_columns].sort_values(by=['Relegation_Event_ID', 'Year_vs_Relegation'])\n\n# Save the final, perfect data to a new CSV in the 'datasets' folder\noutput_path = \"../../assets/files/datasets/perfect_tidy_data.csv\"\ndf_final.to_csv(output_path, index=False)\nimport os\nprint(f\"Step 9: Success! Final table saved to '{output_path}'\")"
  },
  {
    "objectID": "posts/vignettes/index.html",
    "href": "posts/vignettes/index.html",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "",
    "text": "Football credits the taker of a penalty, not the player who won it. That’s why we end up with nicknames like Penaldo. In fact, the BBC even stirred the pot when they captioned him ‘Misstiano Penaldo’ after he missed a penalty against Slovenia in 2024.\nIn this post, I look back in time to see: what would goal totals look like if penalties were “allocated” back to the players who won them?. And I also plan to build out a pipeline for current season statistics, so every penalty winner gets their fair share of the credit.\nWhat’s the justification for this? There are a few.\nOne is that specialist penalty takers don’t actually have penalty success ratios that are significantly above the average player. [point on roadmap - hypothesis testing this claim] This rebutes the argument that penalty takers deserve their goals because they are exceptional at taking penalties. No, most players are between\nSecond is that penalties are taking over the game, and it drives me crazy. If we look back through the history backs, we can see how inflated this has made goalscoring stats. For example, the average penalty ratio for the Pichici, Golden Boot and Capocannoniere follows this trendline. The influence of penalties has completely exploded statlines. There are vastly more penalties in the game today. See plot below. And I don’t see that changing with VAR in the picture and the murkiness of handball rules.\nThe least we can do is to start giving credit where it’s due. Timo Wener is a case in point. Much-maligned throughout his Chelsea career, his debut season’s 2020-21 statline is actually pretty impressive when you peel back the penalties. He won 5 penalties in the Premier League and scored 6 non-penalty goals. He also racked up 8 assists. If he took the penalties he won at a rate of 0.757 success (the historical average), then he’d have 9.79 goals. Add in his 8 assists (I will discuss expected assists but let’s park that for now) and he’s up to 17.79 goal contributions from 2602 minutes, which is a goal contribution every 146.2 minutes. That’s better than Chelsea’s talisman and FIFA Team of the Year inclusion Cole Palmer during the 2024/25 season. Palmer notched 11 non-penalty goals and won 1 penalty, so we give him another 0.757. With 8 assists that makes 19.757 goal contributions in 3191 minutes of play, which is 161.5. Of course, these are my metrics. Their ‘real’ metrics are actually 138.7 for Palmer and 185.9 for Werner.\nThird, I would genuinely like to see penalty winners have to take the penalties they won. It’s complicated in football because you have to assign the winner of the penalty. Though I have proposals for this. Nevertheless, it works in basketball.\nDid you know Raheem Sterling and Shaquille O’Neal have a lot in common?\nRaheem is the PL’s greatest ever winner of penalties - with 26. Raheem is also one of the PL’s greatest ever goalscorers; with 123 goals, he ranks 20th all-time. Meanwhile, Shaq is one of basketball’s greatest ever free throw foul-drawers. He ranks 4th all-time:\nSource: https://www.basketball-reference.com/leaders/fta_career.html\nBut Shaq and Raheem are also historically bad at converting the chances their drawn fouls create. O’Neal only succeeded with 52% of his attempts. In Premier League play, Sterling has converted 43%. That is abysmal considering the average success rate in the Premier League era is 78.9%.\nDespite Shaq’s poor shooting from the free throw line, those points nevertheless helped him rack up the points. He is the 9th-highest scoring player in NBA history. Where would he rank if Kobe Bryant got to take all of Shaq’s fouls?\nShaq wouldn’t fall quite as far as you might think because he was so terrible at converting free throws. Neverthelss, if Kobe took all his fouls, people would foul him less but it would also make NBA scoring contests very dull. The same players would always top the statlines. Just like in football. Harry Kane has been excellent for Bayern Munich. But some of the hyperbole around his goalscoring is overblown. When you have Leroy Sane and Jamal Musiala dribbling at defenders, you will win an extraordinary volume of penalties. And sure enough, Harry ended 2024/25 way out in front of the Bundesliga scoring charts with 26 goals. But he’s not first if you take away everyone’s penalties. That would be Patrick Schick (20), then Serhou Guirassy (18), then Harry (17), just ahead of Jonathan Burkardt (16) - who most people outside Germany have never heard of.\nDespite Sterling winning lots of penalties, he very rarely gets to take them. He has only taken 7 in the Premier League; typically, the ball was whipped away from him by Steven Gerrard (33 PL penalties converted at a rate of 80.5%), or Sergio Aguero (27 PL penalties scored for 81.82% success). Raheem currently ranks 30 in the all-time PL scoring charts with 123 goals. If he took all those penalties, where would he rank? And why stop there? Unfortunately, I don’t have PkWon data further back than 2016/17; otherwise, Alan Shearer’s PL goals record would be under threat from Andy Cole. Only 1 of Cole’s 187 PL goals came from the spot. Whereas 58 of Shearer’s 260 came from the spot. That’s a 15 goal buffer. But Cole won a lot of penalties. Nevertheless, we’re going to rewrite the record books as much as possible.\nIf we use Raheem’s non-penalty goals as a base (120) then add the only penalties he would be entitled to take - 26 - then work out his PwxG, or Penalties won to expected goals, he’d have scored 26 * 0.43 more goals or 11.18. Now on 131, he’d jump above Son, Anelka, Robbie Keane and Jimmy Floyd Hasselbaink (all of whom took their fair share of penalties) and he’d sit in 16th on 134 PL goals, just behind Jamie Vardy. Oh wait, hasn’t Jamie Vardy scored 27 penalties? But he only won 23 of them. So shouldn’t his G-PK+xPwg be 27 * 0.82 based on his PL penalty success rate? He’s only entitled to 22 penalty goals. So he loses 4 and he’s down to 139 PL goals.\nIt’s enough for Vardy to hang onto 15th place, but you can see where this is going.\nUnfortunately, I don’t have PkWon data further than 2016/17; otherwise, Alan Shearer’s PL goals record would be under serious threat from Andy Cole. Only 1 of Cole’s 187 PL goals came from the spot. Whereas 58 of Shearer’s 260 came from the spot. And Cole won a lot of penalties. Nevertheless, we’re going to rewrite the record books as much as possible.\nSo what is this? - For now it’s a Power BI demo dashboard that uses scraped data (see my guide to the ScraperFC pacakage) to let you explore the effects of PKWon at a single-season, single-comp level. But there’s a lot more to come.\nRoadmap: - Add an API source for missing competitions (e.g., Champions League) and use cross-source checks. This is also necessary because FBref data is not designed for public projects. - Make the pipeline refreshable (weekly cadence) with validation + documentation - Rebuild the dashboard layer (likely Tableau later via MSc module or Streamlit or Shiny for Python)\nThis is both:"
  },
  {
    "objectID": "posts/vignettes/index.html#the-question",
    "href": "posts/vignettes/index.html#the-question",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "The question",
    "text": "The question\nIf penalties were allocated to the player who won them, how much would goal totals and rankings change?\nI focus on Premier League-era data where PkWon is tracked: - Penalty kicks won (PkWon) comes from FBref. - For this first version, the goal is not “perfect truth”—it’s a transparent, testable metric you can disagree with."
  },
  {
    "objectID": "posts/vignettes/index.html#a-simple-metric-xpwg",
    "href": "posts/vignettes/index.html#a-simple-metric-xpwg",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "A simple metric: xPwG",
    "text": "A simple metric: xPwG\nI use two quantities:\n\nPkWon = penalties won\nxPwG = expected goals from penalties a player won (allocated back to them)\n\nThen: - G - PK + xPwG = non-penalty goals + expected goals from penalties won\nIn the simplest version, xPwG = PkWon × conversion_rate.\nI also use a slightly more nuanced approach later (positional assumptions / bootstrapped league averages), but the key idea stays the same:\nreward the player who generated the penalty with an expected-goals value rather than giving them the full “goal” automatically."
  },
  {
    "objectID": "posts/vignettes/index.html#quick-example-sterling-vs-vardy",
    "href": "posts/vignettes/index.html#quick-example-sterling-vs-vardy",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Quick example: Sterling vs Vardy",
    "text": "Quick example: Sterling vs Vardy\n(Keep your table here.)\n\nKey - PkWon = penalty kicks won\n- xPwG = expected goals from those penalties\n- G - PK + xPwG = non-penalty goals + xPwG\n\nThis already hints at the broader point: some players “feast” on penalties others created, while some creators don’t get the credit."
  },
  {
    "objectID": "posts/vignettes/index.html#methodology-short-readable",
    "href": "posts/vignettes/index.html#methodology-short-readable",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Methodology (short, readable)",
    "text": "Methodology (short, readable)\n\nData\n\nSource: FBref\nScope: PL seasons where PkWon exists (FBref only goes back to 2016/17 for PL PkWon)\n\n\n\nPenalty conversion assumptions\nTo estimate xPwG, I use competition-level conversion rates from my penalty dataset (PL, La Liga, UCL, international shootouts).\n(Keep your conversion-rate tables here.)\n\n\nWhy not just give them the full goals?\nBecause this is a counterfactual allocation problem: - we don’t know who would take penalties under a different rule - so xPwG is a conservative way to allocate credit while acknowledging uncertainty"
  },
  {
    "objectID": "posts/vignettes/index.html#dashboard-prototype",
    "href": "posts/vignettes/index.html#dashboard-prototype",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Dashboard (prototype)",
    "text": "Dashboard (prototype)\nThis dashboard is a demo layer over the current dataset and metric definitions.\nKnown limitations today: - currently scoped to a single season/competition in places - some interactions are still being tuned (cross-filter behaviour)"
  },
  {
    "objectID": "posts/vignettes/index.html#roadmap-pipeline-reliability",
    "href": "posts/vignettes/index.html#roadmap-pipeline-reliability",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Roadmap (pipeline + reliability)",
    "text": "Roadmap (pipeline + reliability)\nI’m treating this as a pipeline project, not just a one-off analysis. Here’s the plan:\n\nPhase 1 — Extend coverage (data completeness)\n\nAdd missing competitions (e.g., UCL) via a football API\nStandardize competition + season keys\nCreate consistent “fact” grains (player×team×comp×season)\n\n\n\nPhase 2 — Validation + repeatability (data trust)\n\nCross-source checks (API vs scrape): row counts, key uniqueness, spot checks\nData freshness and completeness checks\nDocument metric logic + assumptions clearly (so it’s reviewable)\n\n\n\nPhase 3 — Refresh + product layer (usable outputs)\n\nScheduled refresh (weekly)\nPublish outputs through:\n\na dashboard layer (Power BI now; Tableau rebuild planned later), and/or\na lightweight Streamlit explorer for exports"
  },
  {
    "objectID": "posts/vignettes/index.html#notes-limitations",
    "href": "posts/vignettes/index.html#notes-limitations",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Notes / limitations",
    "text": "Notes / limitations\n\nPkWon availability limits historical scope.\nMetric choices (e.g., conversion rates by position) are assumptions, not facts.\nThis is meant to be transparent: you can see the logic and disagree with it."
  },
  {
    "objectID": "posts/vignettes/index.html#methodology",
    "href": "posts/vignettes/index.html#methodology",
    "title": "The Winner Takes It All (Project Map with Power BI Dashboard)",
    "section": "Methodology",
    "text": "Methodology\nThe methods for calculating conversion rates for each player and allocating an xPwG get a little more exacting for my actual analysis. All of that awaits in the methodology. And then we’ll be ee who the best players really were from a goal contributions perspective seeing who the best goalscorers really are if if we get rid of ball-snatching penalty-takers.\nNot much to say on the data. It’s the 200 highest-scoring players in the Premier League for 2022/23 and a bunch of goalscoring metrics. It all comes from FBref, and this project is possible because they have a PKwon metric - they log who is responsible for winning each penalty. FBref only has this data for the Premier League as far back as the 2016/17 season. My tally from Raheem Sterling includes earlier years - I guess that data exists somewhere because Opta has an article about it. But I don’t have those numbers. Anyway, for La Liga, FBref have it untl 2015/16.\nI’ve created a metric for this. It’s not catchy, so bear with me.\n\nxPwG\nxPwG, or Expected penalties won leading to goals, needs some unpacking. I have assigned a value of 0.75% to each penalty. Why?\n\nPenalty Conversion Rates\nFor another project - No Fear At That Age - I compiled penalty data from:\n\nEvery normal time penalty taken in the Premier League - in other words, since the 1992/1993 season\nEvery normal time penalty taken in the Champions League since the 1999/2000 season\nEvery normal time penalty taken in La Liga since the 1999/2000 season\n\nFor this project, I am adding: - Every penalty taken in the shootout of a major international tournament.\nInteresting that I have 7 less years from La Liga than the Premier League, but 64 more penalties.\n\nThe club data was taken from FBref while the international shootout data comes from RSSSF\n\n\n\n\nLeague\nTotal Penalties\n\n\n\n\nPremier League\n2892\n\n\nLa Liga\n2956\n\n\nChampions League\n925\n\n\nInt. Shootouts\n1907\n\n\nTotal\n6773\n\n\n\nAnd when it comes to conversion rates, all three leagues are roughly equivalent:\n\n\n\nCompetition\nConversion Rate (%)\n\n\n\n\nClub Comps\n77.99\n\n\nChampions League\n77.19\n\n\nPremier League\n78.84\n\n\nLa Liga\n77.40\n\n\nInt. Shootouts\n73.52\n\n\n\nUnsurprisingly, the international shootouts have worse conversion. Players are more nervous and many penalty takers are non-specialist; i.e. they don’t take penalties for their club sides.\nHypothetically, if this new rule really came into place, then the specialist penalty takers would necessarily be the players who are most likely to win penalties - that is, attacking players. The data backs this up.\nThose players could assume they will win their fair share, whereas defensive players wouldn’t. Specialisation would have to fall in line accordingly. Therefore, I will propose assigning a conversion rate based on player positions. To Do: Get this into SQL so I can join datasets for each year and group by position. In addition, I need to group by position for penalty taking success. Note: I will do a mini dashboard piece about success rate by position.\nUnfortunately, I haven’t added positional data for the datasets I downloaded. For wingers and forwards I will assign a value based on the specialists’ average: - 78%. For everyone else the value will be based on a middle ground between specialists in club comps and the pressure cooker penalty shootout success rate - that middle ground is roughly 75.75%.\nThis means that an attacking midfield or forward player who wins a penalty will be treated a specialist and assigned 0.78 expected goals. Everyone else will get 0.7575 expected goals.\nLet’s take an example. In 2023/24 Anthony Gordon won an extraordinary 6 penalties for Newcastle. As a winger, he gets a 0.78 expected goals value. That means his xPwG is 0.78*6, or 4.68 goals.\nOn the other hand, Jarrad Branthwaite won 1 penalty for Everton. He is a defender, so he gets 0.7575*1 for an xPwG of 0.7575 goals.\n\n\n\nG-PK+xPwg\nIf we now take Anthony Gordon’s non-penalty goals - 11 - and add his xPwG we get his G-PK+xPwg: 11+4.68. If Anthony Gordon took the penalties he won in 2023/24 we could expect him to score 15.68 goals.\nIn my analysis to come, I will also deploy xAG - expected Assists Leading to Goals. This is not a stat of my own invention and it’s a close cousin of expected assists. I will quote the NY Times on this: &gt;“Where expected assists (xA) considers all passes and the probability that they may ultimately lead to a scoring chance, xAG solely focuses on the passes that directly contribute to an expected goal.”\nmake sidebar: Shaq was so bad at shooting when 15 feet from the basket - a little over two Shaq’s laid head to toe to head to toe - that a new tactic was invented: ‘Hack-a-Shaq’. The idea was that if you simply fouled Shaq and put him at the free throw line, he would likely score less points - 1 from his 2 free throw attempts - than if you took the risk of letting the play continue because he’d probably manage to pivot and dunk for 2 points. So, if teams knew Kobe was stepping up with his 83.7% shooting then Shaq would have been hacked a heck of a lot less.\n\n\n\n\n\n⚙️ Upcoming Table Fixes # Feature Description / Action Priority 1 Minutes-weighted fairness rule for unattributed penalties Use player-minutes share to distribute team-level unattributed penalties fairly across players. 🔴 High 2 Revert to assists (no xAG) for 2016/17 Replace xAG values with raw assists in Hall of Fame tables for 2016/17 (xAG not tracked that year). 🟠 Medium 3 SQL short_name column for teams Add short_name field in dimteam to prevent text wrapping for long team names (e.g., “Borussia Mönchengladbach”). 🔴 High 4 Adaptive PKW weighting by conversion rate Weight PKW by player conversion rate (pens_scored / pens_attempted), default 0.757 if no attempts exist. 🟠 Medium\n🚀 Upcoming Features # Feature Description / Action Priority 5 Add UEFA Champions League 24/25 scraping feature Extend scraper to include UCL 2024/25 data and integrate into the main pipeline. 🔴 High 6 Tooltip linking unattributed PKWon info Add hover tooltips linking to unattributed PKWon reference table (superseded by standalone visual). 🟢 Low 7 Reset bookmark (unfiltered state) Configure a Reset button to restore default slicers via bookmarks. 🔴 High 8 Fix Hall of Fame visuals’ row-click response Adjust interactions / DAX filters so Hall of Fame cards ignore table-row selections. 🟠 Medium 9 Conditional formatting for awards Add Ballon d’Or 🟡 and Golden Boy 👦 flags with icon-based formatting (superseded by dedicated award page). 🟢 Low 10 Create and integrate SQL views for Power BI Create 4 SQL views (v_player_team_comp_season, v_player_team_comp, v_player_comp_season, v_player_overall) and link them into Power BI. 🔴 High 11 Standalone visualisations (outside dashboards) Build exportable visuals (trend lines, scatter plots, radar charts) for blog / static use. 🟠 Medium 12 Ballon d’Or comparison page Add a Power BI page comparing Ballon d’Or-winning seasons — metrics for winners, runners-up, and non-winners. 🔴 High 13 Scrape current season data for all comps (CL, PL, La Liga, Serie A, Bundesliga, Ligue 1) 🟠 High 13 Live build for current season (CI/CD) GitHub Actions workflow to run scraper daily, clean / load into DB, and refresh Power BI dataset automatically. 🟠 Medium 14 Fully automated Plotly Dash + embed Long-term goal: Dash app that fetches live data and regenerates visuals automatically — no Power BI refresh needed. 🟠 Medium 15 Re-scrape FBref for np expected goals data and add ratio of npgoals to npxg as calculated column 🟠 High\n🧭 Upcoming Documentation # Feature Description / Action Priority 15 Documentation & rationale layer Add detailed project docs (weighting rules, schema design, analytical logic, Power BI implementation, reproducibility). Includes sections A–E (Weighting Logic, Data Model, Analytical Design, Power BI Implementation, Reproducibility). 🔴 High 16 Pull Request: scraperfc (CL 24/25) Submit a PR to the scraperfc package adding UCL 24/25 support and update documentation accordingly (public-facing technical note). 🟢 Low\n\nv_player_team_comp_season\n\nGrain: one row per Player × Team × Competition × Season (atomic fact). Columns (typical):\nKeys: player_id, team_id, comp_id, season_id\nAdditives: minutes, goals, non_penalty_goals, penalties_won, pens_scored, pens_attempted, xAG, assists …\nOptionally: starts, subs_on, cards_y/r\nNo pre-aggregation other than data cleaning.\nUse in Power BI (pages it facilitates):\nPlayer Season Detail (drill-through from any summary): season-by-season line/table for a player within a team+comp.\nBallon d’Or Comparison page (winner vs runners-up vs notable seasons → needs true per-season rows).\nLeague Defaults Reference (join by comp_id, season_id to show league-season constants).\nAny time series visual (season on X-axis).\nTypical visuals: season table; season KPI strip; per-season trend lines (NPG, PKWon, xAG). Example measures: per-90 (divide by minutes/90), season ranks within comp.\n\nv_player_team_comp\n\nGrain: one row per Player × Team × Competition (aggregated across all seasons). Columns: same additive metrics summed across seasons: SUM(minutes) AS minutes, SUM(goals) AS goals, SUM(non_penalty_goals) AS npg, SUM(penalties_won) AS pkwon, SUM(pens_scored) AS pens_scored, …\nUse in Power BI (pages it facilitates):\nClub Career by Competition (e.g., Aubameyang at Arsenal in EPL vs UCL totals).\nRoll of Honour / “Best Stints” (top multi-season stints by comp).\nTable of Player–Team–Comp combos (clean 1 line per combo; prevents duplicate seasons).\nTypical visuals: tables ranked by NPG, PKWon, Goals; bar charts comparing comps for a player’s stint at a club. Example measures: %GoalsFromPens, NPG + PKWon*rate at stint level.\n\nv_player_comp_season\n\nGrain: one row per Player × Competition × Season (aggregated across teams). Columns: additives summed across teams in that season (handles mid-season transfers): SUM(minutes), SUM(goals), SUM(npg), SUM(pkwon), SUM(pens_scored), …\nUse in Power BI (pages it facilitates):\nSeason Dossiers by Competition (e.g., “Messi in 2018/19 UCL” even if multiple teams; common for players changing clubs).\nBallon d’Or Comparison (winner + runners-up often compared at competition-season level).\nLeague Tables of a Season (top scorers/creators in EPL 2021/22).\nTypical visuals: year slicer + comp slicer → ranked season table; season radar for a single comp. Example measures: season ranks within comp, league-specific unattributed share lookups.\n\nv_player_overall\n\nGrain: one row per Player (career totals across all teams, competitions, seasons). Columns: global sums: SUM(minutes), SUM(goals), SUM(npg), SUM(pkwon), SUM(pens_scored), SUM(xAG), SUM(assists) …\nUse in Power BI (pages it facilitates):\nCareer Leaderboards (global top lists).\nPlayer Finder / Similarity starting point (overall vectors).\nAward Winners Overview (career totals side-by-side).\nTypical visuals: top-N tables, scatter (career NPG vs xAG), profile cards. Example measures: career per-90, career penalty reliance, career conversion."
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#dataset-scope",
    "href": "posts/too-messy-to-melt/index.html#dataset-scope",
    "title": "Too Messy to Melt",
    "section": "Dataset Scope",
    "text": "Dataset Scope\nAll Premier League relegations with usable attendance data. This means Covid seasons are excluded. Each Premier League relegation event is represented across a consistent four-season window and includes league performance as well as attendance figures. Data is on a per-season basis, not per-match. - Year -1: Season before relegation\n- Year 0: Relegation season (Premier League)\n- Year +1: First post-relegation season\n- Year +2: Second post-relegation season\nA temporary Year +3 is generated programmatically only to determine the Year +2 season outcome (Promoted / Survived / Relegated). After outcome extraction, the Year +3 rows are dropped.\nGranularity is one row per team × season × relegation event. So one relegation event (e.g., Burnley 2023-24) is represented by four rows (Year -1 through Year +2)."
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#data-dictionary-final-dataset",
    "href": "posts/too-messy-to-melt/index.html#data-dictionary-final-dataset",
    "title": "Too Messy to Melt",
    "section": "Data dictionary (final dataset)",
    "text": "Data dictionary (final dataset)\n\nIdentifiers and structure\n\n\n\n\n\n\n\n\nColumn\nType\nDescription\n\n\n\n\nRelegation_Event_ID\nstring\nUnique ID for a relegation event (\"{Team} {Season}\")\n\n\nTeam\nstring\nStandardized club name (matches standings naming)\n\n\nSeason\nstring\nSeason in YYYY-YY format (e.g., 2002-03)\n\n\nYear_vs_Relegation\nint\nRelative season index: -1, 0, 1, 2\n\n\n\n\n\nAttendance\n\n\n\n\n\n\n\n\nColumn\nType\nDescription\n\n\n\n\nAttendance\nint (nullable)\nAverage home league attendance. Missing where unusable (e.g. COVID).\n\n\n\n\n\nLeague status and outcome\n\n\n\n\n\n\n\n\nColumn\nType\nDescription\n\n\n\n\nTier\nint (nullable)\nLeague tier (1 = top flight, 2 = Championship, etc.)\n\n\nPosition\nint (nullable)\nFinal league position\n\n\nYear_End_Outcome\nstring\nPromoted, Survived, or Relegated\n\n\n\n\n\nRaw season performance totals (from standings)\n\n\n\nColumn\nType\nDescription\n\n\n\n\nGames_Played_History\nint (nullable)\nLeague matches played\n\n\nWins_History\nint (nullable)\nLeague wins\n\n\nGoals_For_History\nint (nullable)\nLeague goals scored\n\n\nGoals_Against_History\nint (nullable)\nLeague goals conceded\n\n\nPoints_History\nint (nullable)\nLeague points total"
  },
  {
    "objectID": "posts/too-messy-to-melt/index.html#data-dictionary",
    "href": "posts/too-messy-to-melt/index.html#data-dictionary",
    "title": "Too Messy to Melt",
    "section": "Data dictionary",
    "text": "Data dictionary\n\nIdentifiers and structure\n\n\n\n\n\n\n\n\nColumn\nType\nDescription\n\n\n\n\nRelegation_Event_ID\nstring\nUnique ID for a relegation event (\"{Team} {Season}\")\n\n\nTeam\nstring\nStandardized club name (matches standings naming)\n\n\nSeason\nstring\nSeason in YYYY-YY format (e.g., 2002-03)\n\n\nYear_vs_Relegation\nint\nRelative season index: -1, 0, 1, 2\n\n\n\n\n\nAttendance\n\n\n\n\n\n\n\n\nColumn\nType\nDescription\n\n\n\n\nAttendance\nint (nullable)\nAverage home league attendance. Missing where unusable (e.g. COVID).\n\n\n\n\n\nLeague status and outcome\n\n\n\n\n\n\n\n\nColumn\nType\nDescription\n\n\n\n\nTier\nint (nullable)\nLeague tier (1 = top flight, 2 = Championship, etc.)\n\n\nPosition\nint (nullable)\nFinal league position\n\n\nYear_End_Outcome\nstring\nPromoted, Survived, or Relegated\n\n\n\n\n\nRaw season performance totals\n\n\n\nColumn\nType\nDescription\n\n\n\n\nGames_Played_History\nint (nullable)\nLeague matches played\n\n\nWins_History\nint (nullable)\nLeague wins\n\n\nGoals_For_History\nint (nullable)\nLeague goals scored\n\n\nGoals_Against_History\nint (nullable)\nLeague goals conceded\n\n\nPoints_History\nint (nullable)\nLeague points total"
  },
  {
    "objectID": "posts/winner-takes-them-all/index.html",
    "href": "posts/winner-takes-them-all/index.html",
    "title": "The Winner Takes Them All (Project Map with Power BI Dashboard)",
    "section": "",
    "text": "Football credits the taker of a penalty, not the player who won it. That’s why we end up with nicknames like “Penaldo”. A BBC caption - “Misstiano Penaldo” - even went viral after CR7 missed against Slovenia in 2024.\nThis project asks a simple counterfactual:\nWhat would happen if penalties were allocated back to the players who won them? How would that change the way we look at player statlines across seasons, careers or during Balon d’Or discussons?\nAnd why not just give them the full goals? Because this is a counterfactual allocation problem, we have to account for the possibility that they would miss. So my made-up metric is Expected Goals from Penalties Won (xGpw), which is currently fixed at 0.757 for every player, though I do plan to tweak this. Explanation of all that to follow.\nSo far, the workflow is:\nThis isn’t intended as a one-off analysis — it’s a pipeline project. Long-term, I plan to transition this pipeline to a paid football API to ensure scalability and commercial compliance. The data I scraped is just for my experimentation with the above workflow. In future, I intend to make a Shiny dashboard that automatically refreshes data, and fully explorable by site visitors. I will periodically publish small vignettes based on my own exploration."
  },
  {
    "objectID": "posts/winner-takes-them-all/index.html#dashboard-prototype",
    "href": "posts/winner-takes-them-all/index.html#dashboard-prototype",
    "title": "The Winner Takes Them All (Project Map with Power BI Dashboard)",
    "section": "Dashboard (prototype)",
    "text": "Dashboard (prototype)\nHere is a small prototype I made in Power Bi.\n\nKnown limitations (current dashboard)\n\nThis can only be filtered to a single-season / single-competition grain as I have encountered issues with my DAX measures.\nCross-filter interactions can be annoying (table clicks affecting cards in ways I don’t want)"
  }
]